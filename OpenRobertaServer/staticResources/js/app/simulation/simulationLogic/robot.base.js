var __awaiter=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(r,n){function s(t){try{h(o.next(t))}catch(t){n(t)}}function a(t){try{h(o.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}h((o=o.apply(t,e||[])).next())}))},__generator=this&&this.__generator||function(t,e){var i,o,r,n,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(a){return function(h){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;n&&(n=0,a[0]&&(s=0)),s;)try{if(i=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,h])}}};define(["require","exports","jquery","util.roberta","blockly","simulation.types"],(function(t,e,i,o,r){Object.defineProperty(e,"__esModule",{value:!0}),e.SelectionListener=e.RobotFactory=e.RobotBase=void 0;var n=function(){function t(t,e,i,o,r){this.debug=!1,this._selected=!1,this.lastSelected=!1,this.imgList=[],this.drawPriority=-1,this.labelPriority=-1,this.id=t,this.configuration=e,this.interpreter=i,this.name=o,this.time=0,this.addMouseEvents(),this.mySelectionListener=r,this.remover=this.mySelectionListener.add(this.handleNewSelection.bind(this)),0===this.id&&(this.lastSelected=!0)}return Object.defineProperty(t.prototype,"interpreter",{get:function(){return this._interpreter},set:function(t){this._interpreter=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"configuration",{get:function(){return this._configuration},set:function(t){this._configuration=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mobile",{get:function(){return this._mobile},set:function(t){this._mobile=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this._time},set:function(t){this._time=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selected",{get:function(){return this._selected},set:function(t){this._selected=t,t&&this.mySelectionListener.fire(this)},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this.removeMouseEvents(),this.selected=!1,this.mySelectionListener.remove(this.remover)},t.prototype.draw=function(t,e){var i=this;this.lastSelected&&this.drawLabel(e);var o=this;t.save(),this.mobile&&(t.translate(o.pose.x,o.pose.y),t.rotate(o.pose.theta));var r=[];if(Object.keys(this).forEach((function(t){i[t]&&i[t].draw&&r.push(i[t])}),this),r.sort((function(t,e){return t.drawPriority-e.drawPriority})).forEach((function(e){e.draw(t,i)}),this),this.selected&&this.mobile){var n=[{x:Math.round(this.chassis.frontRight.x),y:Math.round(this.chassis.frontRight.y)},{x:Math.round(this.chassis.backRight.x),y:Math.round(this.chassis.backRight.y)},{x:Math.round(this.chassis.backLeft.x),y:Math.round(this.chassis.backLeft.y)},{x:Math.round(this.chassis.frontLeft.x),y:Math.round(this.chassis.frontLeft.y)}];for(var s in n)t.beginPath(),t.lineWidth=2,t.shadowBlur=0,t.strokeStyle="gray",t.arc(n[s].x,n[s].y,5,0,2*Math.PI),t.fillStyle="black",t.stroke(),t.fill(),t.closePath()}t.restore()},t.prototype.getLabel=function(){throw new Error("Method not implemented.")},t.prototype.replaceState=function(t){this.interpreter=t},t.prototype.reset=function(){for(var t in this){if(this[t]&&this[t].reset)this[t].reset()}},t.prototype.updateActions=function(t,e,i){for(var o in i&&(this.time+=e),this){if(this[o]&&this[o].updateAction)this[o].updateAction(this,e,i)}},t.prototype.updateSensors=function(t,e,i,o,r,n,s){var a=this.interpreter.getRobotBehaviour().hardwareState.sensors;for(var h in this)this[h]&&this[h].updateSensor&&this[h].updateSensor(t,e,this,a,i,o,r,n,s)},t.prototype.removeMouseEvents=function(){i("#robotLayer").off(".R"+this.id)},t.prototype.addMouseEvents=function(){var t=i("#robotLayer");t.on("mousedown.R"+this.id+" touchstart.R"+this.id,this.handleMouseDown.bind(this)),t.on("mousemove.R"+this.id+" touchmove.R"+this.id,this.handleMouseMove.bind(this)),t.on("mouseup.R"+this.id+" touchend.R"+this.id+"mouseout.R"+this.id+"touchcancel.R"+this.id,this.handleMouseOutUp.bind(this)),t.on("keydown.R"+this.id,this.handleKeyEvent.bind(this))},t.prototype.drawLabel=function(t){var e=this,n=i("#systemValuesView");i("#systemValuesView > div:not(:first-child)").remove(),n.append("<div><label>FPS</label><span>"+o.round(1/t,0)+"</span></div>"),n.append("<div><label>"+r.Msg.SENSOR_TIME+"</label><span>"+o.round(this.time,3)+"s</span></div>"),this.mobile&&(n.append("<div><label>Robot X</label><span>"+o.round(this.pose.x/3,1)+"</span></div>"),n.append("<div><label>Robot Y</label><span>"+o.round(this.pose.y/3,1)+"</span></div>"),n.append("<div><label>Robot θ</label><span>"+o.round(this.pose.getThetaInDegree(),0)+"°</span></div>"));var s=i("#timerValuesView"),a=i("#headingTwo");this.timer?(a.show(),s.html(""),s.append(this.timer.getLabel())):a.hide();var h=i("#sensorValuesView");h.html("");var u=[];Object.keys(this).forEach((function(t){e[t]&&e[t].getLabel&&"timer"!==t&&u.push(e[t])}),this),u.sort((function(t,e){return t.labelPriority-e.labelPriority})).forEach((function(t){h.append(t.getLabel())}),this);var l=this.interpreter.getVariables(),c=i("#variableValuesView");if(c.html(""),Object.keys(l).length>0)for(var f in l){var d=l[f][0];o.addVariableValue(c,f,d)}},t.colorRange=["#000000","#0056a6","#00642f","#532115","#585858","#b30006","#f7e307"],t}();e.RobotBase=n;var s=function(){function e(){}return e.createRobots=function(o,r,n,s,a){return __awaiter(this,void 0,void 0,(function(){var h,u,l;return __generator(this,(function(c){switch(c.label){case 0:return i("#simRobotContent").html(""),i("#simRobot").show(),h="robot."+a.toLowerCase(),[4,new Promise((function(e,i){t([h],e,i)}))];case 1:return u=c.sent(),l=[],o.some((function(t,o){if(o>9)return alert("The maximum number of robots that can be simulated at the same time is 10. The number of robots exceeding this number is not simulated!"),{robots:l,robotClass:u};var a=new u.default(o,r[o],t,n[o],s);if(o>0){if(a.chassis.geom.color="rgb("+e.colorsAdmissible[o-1].join(", ")+")",o<=4){var h=o*(l[0].chassis.geom.w+40);a.pose.x+=h}else{h=(o-5)*(l[0].chassis.geom.w+40);a.pose.x+=h,a.pose.y+=150}a.initialPose.x=a.pose.x,a.initialPose.y=a.pose.y,a.initialPose.theta=a.pose.theta,a.chassis.transformNewPose(a.pose,a.chassis)}else i("#brick0").show(),i("#robotLabel").remove(),i("#robotIndex").remove();l.push(a)})),[2,{robots:l,robotClass:u}]}}))}))},e.colorsAdmissible=[[57,55,139],[252,105,180],[143,164,2],[51,184,202],[144,133,186],[235,106,10],[186,204,30],[242,148,0],[0,90,148]],e}();e.RobotFactory=s;var a=function(){function t(){var t=this;this.listeners=[],this.clean=function(){t.listeners=[]}}return t.prototype.add=function(t){var e=this;if(t instanceof Function){this.listeners.push(t);var i=!1;return function(){return!i&&(i=!0,e.remove(t))}}throw new Error("Indicated listener action is not function type.")},t.prototype.fire=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.listeners.length;++i){var o=this.listeners[i];o.apply(o,t)}},t.prototype.remove=function(t){for(var e=0;e<this.listeners.length;++e)if(t===this.listeners[e])return this.listeners.splice(e,1),!0;return!1},t}();e.SelectionListener=a}));
//# sourceMappingURL=robot.base.js.map
//# sourceMappingURL=robot.base.js.map
