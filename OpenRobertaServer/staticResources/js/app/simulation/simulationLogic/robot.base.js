var __awaiter=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(o,n){function s(e){try{h(r.next(e))}catch(e){n(e)}}function a(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}h((r=r.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var i,r,o,n,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(a){return function(h){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;n&&(n=0,a[0]&&(s=0)),s;)try{if(i=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,h])}}};define(["require","exports","jquery","util.roberta","blockly","simulation.types"],(function(e,t,i,r,o){Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionListener=t.RobotFactory=t.RobotBase=void 0;var n=function(){function e(e,t,i,r,o){this.debug=!1,this._selected=!1,this.lastSelected=!1,this.imgList=[],this.drawPriority=-1,this.labelPriority=-1,this.id=e,this.configuration=t,this.interpreter=i,this.name=r,this.time=0,this.addMouseEvents(),this.mySelectionListener=o,this.remover=this.mySelectionListener.add(this.handleNewSelection.bind(this)),0===this.id&&(this.lastSelected=!0)}return Object.defineProperty(e.prototype,"interpreter",{get:function(){return this._interpreter},set:function(e){this._interpreter=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"configuration",{get:function(){return this._configuration},set:function(e){this._configuration=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mobile",{get:function(){return this._mobile},set:function(e){this._mobile=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return this._time},set:function(e){this._time=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(e){this._selected=e,e&&this.mySelectionListener.fire(this)},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this.removeMouseEvents(),this.selected=!1,this.mySelectionListener.remove(this.remover)},e.prototype.draw=function(e,t){var i=this;this.lastSelected&&this.drawLabel(t);var r=this;e.save(),this.mobile&&(e.translate(r.pose.x,r.pose.y),e.rotate(r.pose.theta));var o=[];if(Object.keys(this).forEach((function(e){i[e]&&i[e].draw&&o.push(i[e])}),this),o.sort((function(e,t){return e.drawPriority-t.drawPriority})).forEach((function(t){t.draw(e,i)}),this),this.selected&&this.mobile){var n=[{x:Math.round(this.chassis.frontRight.x),y:Math.round(this.chassis.frontRight.y)},{x:Math.round(this.chassis.backRight.x),y:Math.round(this.chassis.backRight.y)},{x:Math.round(this.chassis.backLeft.x),y:Math.round(this.chassis.backLeft.y)},{x:Math.round(this.chassis.frontLeft.x),y:Math.round(this.chassis.frontLeft.y)}];for(var s in n)e.beginPath(),e.lineWidth=2,e.shadowBlur=0,e.strokeStyle="gray",e.arc(n[s].x,n[s].y,5,0,2*Math.PI),e.fillStyle="black",e.stroke(),e.fill(),e.closePath()}e.restore()},e.prototype.getLabel=function(){throw new Error("Method not implemented.")},e.prototype.replaceState=function(e){this.interpreter=e},e.prototype.reset=function(){for(var e in this){if(this[e]&&this[e].reset)this[e].reset()}},e.prototype.updateActions=function(e,t,i){for(var r in i&&(this.time+=t),this){if(this[r]&&this[r].updateAction)this[r].updateAction(this,t,i)}},e.prototype.updateSensors=function(e,t,i,r,o,n){var s=this.interpreter.getRobotBehaviour().hardwareState.sensors;for(var a in this)this[a]&&this[a].updateSensor&&this[a].updateSensor(e,t,this,s,i,r,o,n)},e.prototype.removeMouseEvents=function(){i("#robotLayer").off(".R"+this.id)},e.prototype.addMouseEvents=function(){var e=i("#robotLayer");e.on("mousedown.R"+this.id+" touchstart.R"+this.id,this.handleMouseDown.bind(this)),e.on("mousemove.R"+this.id+" touchmove.R"+this.id,this.handleMouseMove.bind(this)),e.on("mouseup.R"+this.id+" touchend.R"+this.id+"mouseout.R"+this.id+"touchcancel.R"+this.id,this.handleMouseOutUp.bind(this)),e.on("keydown.R"+this.id,this.handleKeyEvent.bind(this))},e.prototype.drawLabel=function(e){var t=this,n=i("#systemValuesView");i("#systemValuesView > div:not(:first-child)").remove(),n.append("<div><label>FPS</label><span>"+r.round(1/e,0)+"</span></div>"),n.append("<div><label>"+o.Msg.SENSOR_TIME+"</label><span>"+r.round(this.time,3)+"s</span></div>"),this.mobile&&(n.append("<div><label>Robot X</label><span>"+r.round(this.pose.x/3,1)+"</span></div>"),n.append("<div><label>Robot Y</label><span>"+r.round(this.pose.y/3,1)+"</span></div>"),n.append("<div><label>Robot θ</label><span>"+r.round(this.pose.getThetaInDegree(),0)+"°</span></div>"));var s=i("#timerValuesView"),a=i("#headingTwo");this.timer?(a.show(),s.html(""),s.append(this.timer.getLabel())):a.hide();var h=i("#sensorValuesView");h.html("");var u=[];Object.keys(this).forEach((function(e){t[e]&&t[e].getLabel&&"timer"!==e&&u.push(t[e])}),this),u.sort((function(e,t){return e.labelPriority-t.labelPriority})).forEach((function(e){h.append(e.getLabel())}),this);var l=this.interpreter.getVariables(),c=i("#variableValuesView");if(c.html(""),Object.keys(l).length>0)for(var f in l){var d=l[f][0];r.addVariableValue(c,f,d)}var p=i("#neuronValuesView");p.html("");var b=this.interpreter.neuralNetwork;if(b){var y=b.getOutputNames();Object.keys(y).length>0&&y.forEach((function(e){var t=b.getOutputNeuronVal(e);r.addVariableValue(p,e,t)})),i("#headingFive").parent().show()}else i("#headingFive").parent().hide()},e.colorRange=["#000000","#0056a6","#00642f","#532115","#585858","#b30006","#f7e307"],e}();t.RobotBase=n;var s=function(){function t(){}return t.createRobots=function(r,o,n,s,a){return __awaiter(this,void 0,void 0,(function(){var h,u,l;return __generator(this,(function(c){switch(c.label){case 0:return i("#simRobotContent").html(""),i("#simRobot").show(),h="robot."+a.toLowerCase(),[4,new Promise((function(t,i){e([h],t,i)}))];case 1:return u=c.sent(),l=[],r.some((function(e,r){if(r>9)return alert("The maximum number of robots that can be simulated at the same time is 10. The number of robots exceeding this number is not simulated!"),{robots:l,robotClass:u};var a=new u.default(r,o[r],e,n[r],s);if(r>0){if(a.chassis.geom.color="rgb("+t.colorsAdmissible[r-1].join(", ")+")",r<=4){var h=r*(l[0].chassis.geom.w+40);a.pose.x+=h}else{h=(r-5)*(l[0].chassis.geom.w+40);a.pose.x+=h,a.pose.y+=150}a.initialPose.x=a.pose.x,a.initialPose.y=a.pose.y,a.initialPose.theta=a.pose.theta,a.chassis.transformNewPose(a.pose,a.chassis)}else i("#brick0").show(),i("#robotLabel").remove(),i("#robotIndex").remove();l.push(a)})),[2,{robots:l,robotClass:u}]}}))}))},t.colorsAdmissible=[[57,55,139],[252,105,180],[143,164,2],[51,184,202],[144,133,186],[235,106,10],[186,204,30],[242,148,0],[0,90,148]],t}();t.RobotFactory=s;var a=function(){function e(){var e=this;this.listeners=[],this.clean=function(){e.listeners=[]}}return e.prototype.add=function(e){var t=this;if(e instanceof Function){this.listeners.push(e);var i=!1;return function(){return!i&&(i=!0,t.remove(e))}}throw new Error("Indicated listener action is not function type.")},e.prototype.fire=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=0;i<this.listeners.length;++i){var r=this.listeners[i];r.apply(r,e)}},e.prototype.remove=function(e){for(var t=0;t<this.listeners.length;++t)if(e===this.listeners[t])return this.listeners.splice(t,1),!0;return!1},e}();t.SelectionListener=a}));
//# sourceMappingURL=robot.base.js.map
//# sourceMappingURL=robot.base.js.map
