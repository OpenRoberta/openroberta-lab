var __extends=this&&this.__extends||function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function s(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(s.prototype=o.prototype,new s)}}();define(["require","exports","robot.base","jquery","util.roberta","simulation.math","simulation.roberta","robot.sensors"],(function(t,e,o,s,i,r,n,a){Object.defineProperty(e,"__esModule",{value:!0}),e.RobotBaseMobile=e.Pose=void 0;var h=function(){function t(t,e,o){this.x=t,this.xOld=t,this.y=e,this.yOld=e,this.theta=o||0}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this.xOld=this._x,this._x=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this.yOld=this._y,this._y=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"theta",{get:function(){return this._theta},set:function(t){this._theta=(t+2*Math.PI)%(2*Math.PI)},enumerable:!1,configurable:!0}),t.prototype.getThetaInDegree=function(){return this._theta*(180/Math.PI)},t}();e.Pose=h;var p=function(t){function e(e,o,s,i,r,n){var a=t.call(this,e,o,s,i,r)||this;return a._hasTrail=!1,a._thetaDiff=0,a.isDown=!1,a.observers=[],a.imgList=["simpleBackground","drawBackground","robertaBackground","rescueBackground","blank","mathBackground"],a.mouse={x:-5,y:0,rx:0,ry:0,r:30},a.mobile=!0,a.pose=n||new h(150,150,0),a.initialPose=n||new h(150,150,0),a.configure(o),a}return __extends(e,t),Object.defineProperty(e.prototype,"hasTrail",{get:function(){return this._hasTrail},set:function(t){this._hasTrail=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pose",{get:function(){return this._pose},set:function(t){this._pose=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"initialPose",{get:function(){return this._initialPose},set:function(t){this._initialPose=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"thetaDiff",{get:function(){return this._thetaDiff},set:function(t){this._thetaDiff=t},enumerable:!1,configurable:!0}),e.prototype.handleKeyEvent=function(t){if(this.selected){switch(t.stopImmediatePropagation(),t.key){case"ArrowUp":this.pose.x+=Math.cos(this.pose.theta),this.pose.y+=Math.sin(this.pose.theta),t.preventDefault(),t.stopPropagation();break;case"ArrowLeft":var e=Math.PI/180;this.pose.theta-=e,Object.keys(this).filter((function(t){return t instanceof a.GyroSensorExt})).forEach((function(t){return t.angleValue-=r.toDegree(e)})),t.preventDefault(),t.stopPropagation();break;case"ArrowDown":this.pose.x-=Math.cos(this.pose.theta),this.pose.y-=Math.sin(this.pose.theta),t.preventDefault(),t.stopPropagation();break;case"ArrowRight":var o=Math.PI/180;this.pose.theta+=o,Object.keys(this).filter((function(t){return t instanceof a.GyroSensorExt})).forEach((function(t){return t.angleValue+=r.toDegree(o)})),t.preventDefault(),t.stopPropagation()}this.initialPose=new h(this.pose.x,this.pose.y,this.pose.theta)}},e.prototype.handleMouseDown=function(t){r.transform(this.pose,this.mouse),t&&!t.startX&&i.extendMouseEvent(t,n.SimulationRoberta.Instance.scale,s("#robotLayer"));var e=t,o=e.startX-this.mouse.rx,a=e.startY-this.mouse.ry;this.isDown=o*o+a*a<this.mouse.r*this.mouse.r,this.isDown&&(t.stopImmediatePropagation(),s("#robotLayer").css("cursor","pointer"),this.selected||(this.selected=!0))},e.prototype.handleMouseMove=function(t){r.transform(this.pose,this.mouse),t&&!t.startX&&i.extendMouseEvent(t,n.SimulationRoberta.Instance.scale,s("#robotLayer"));var e=t,o=e.startX-this.mouse.rx,a=e.startY-this.mouse.ry;o*o+a*a<this.mouse.r*this.mouse.r&&(s("#robotLayer").css("cursor","pointer"),s("#robotLayer").data("hovered",!0),this.selected&&t.stopImmediatePropagation()),this.isDown&&this.selected&&(this.pose.xOld=this.pose.x,this.pose.yOld=this.pose.y,this.pose.x+=o,this.pose.y+=a,this.mouse.rx+=o,this.mouse.ry+=a,this.chassis.transformNewPose(this.pose,this.chassis),this.initialPose=new h(this.pose.x,this.pose.y,this.pose.theta))},e.prototype.handleMouseOutUp=function(t){this.isDown&&(s("#robotLayer").css("cursor","auto"),t.stopImmediatePropagation(),this.isDown=!1)},e.prototype.handleNewSelection=function(t){t===this?(s("#brick"+this.id).show(),s("#robotIndex option[value="+this.id+"]").prop("selected",!0),s("#robotIndex").css("background-color",this.chassis.geom.color),this.lastSelected=!0):(this.selected=!1,this.isDown=!1,t instanceof o.RobotBase&&(s("#brick"+this.id).hide(),this.lastSelected=!1))},e.prototype.resetPose=function(){this.pose=new h(this.initialPose.x,this.initialPose.y,this.initialPose.theta)},e.prototype.drawTrail=function(t,e,o,s){this.hasTrail&&(t.beginPath(),t.lineCap="round",t.lineWidth=o,t.strokeStyle=s,t.moveTo(this.pose.xOld,this.pose.yOld),t.lineTo(this.pose.x,this.pose.y),t.stroke(),e.beginPath(),e.lineCap="round",e.lineWidth=o,e.strokeStyle=s,e.moveTo(this.pose.xOld,this.pose.yOld),e.lineTo(this.pose.x,this.pose.y),e.stroke(),this.pose.xOld=this.pose.x,this.pose.yOld=this.pose.y)},e.prototype.updateActions=function(e,o,s){t.prototype.updateActions.call(this,e,o,s),s&&this.notifyObservers()},e.prototype.addObserver=function(t){this.observers.push(t)},e.prototype.notifyObservers=function(){for(var t=0,e=this.observers;t<e.length;t++){e[t].update(this)}},e.prototype.removeObserver=function(t){var e=this.observers.findIndex((function(e){return t===e}));-1!==e&&this.observers.splice(e,1)},e}(o.RobotBase);e.RobotBaseMobile=p}));
//# sourceMappingURL=robot.base.mobile.js.map
//# sourceMappingURL=robot.base.mobile.js.map
