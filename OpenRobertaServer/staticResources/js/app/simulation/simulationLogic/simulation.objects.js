var __extends=this&&this.__extends||function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}(),__spreadArray=this&&this.__spreadArray||function(t,e,s){if(s||2===arguments.length)for(var i,r=0,o=e.length;r<o;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};define(["require","exports","jquery","util.roberta","simulation.roberta","simulation.math"],(function(t,e,s,i,r,o){Object.defineProperty(e,"__esModule",{value:!0}),e.RcjSimulationLabel=e.Ground=e.TriangleSimulationObject=e.CircleSimulationObject=e.MarkerSimulationObject=e.RectangleSimulationObject=e.SimObjectShape=e.SimObjectType=e.SimObjectFactory=e.BaseSimulationObject=void 0;var h=function(){function t(t,e,s,i,r){this.SHIFT=1,this.MIN_SIZE_OBJECT=10,this._movable=!1,this.isDown=!1,this.mouseOldX=0,this.mouseOldY=0,this._selected=!1,this.myId=t,this.myScene=e,this.mySelectionListener=s,this.remover=this.mySelectionListener.add(this.handleNewSelection.bind(this)),this.type=i,r?this.color=r:i===n.Obstacle?this.color="#33B8CA":this.color="#FBED00",this.addMouseEvents()}return Object.defineProperty(t.prototype,"selected",{get:function(){return this._selected},set:function(t){this._selected=t,t&&(this.mySelectionListener.fire(this),this.type!==n.Marker&&this.myScene.sim.enableChangeObjectButtons())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t,this._hsv=o.hexToHsv(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hsv",{get:function(){return this._hsv},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"movable",{get:function(){return this._movable},set:function(t){this._movable=t},enumerable:!1,configurable:!0}),t.prototype.addMouseEvents=function(){var t=s("#robotLayer");t.on("mousedown."+this.myId+" touchstart."+this.myId,this.handleMouseDown.bind(this)),t.on("mousemove."+this.myId+" touchmove."+this.myId,this.handleMouseMove.bind(this)),t.on("mouseup."+this.myId+" touchend."+this.myId+"mouseout."+this.myId+"touchcancel."+this.myId,this.handleMouseOutUp.bind(this)),t.on("keydown."+this.myId,this.handleKeyEvent.bind(this))},t.prototype.removeMouseEvents=function(){s("#robotLayer").off("."+this.myId)},t.prototype.handleNewSelection=function(t){t!==this&&this.selected&&(this.selected=!1,this.isDown=!1,this.corners.forEach((function(t){return t.isDown=!1})),this.myScene.sim.disableChangeObjectButtons(),this.redraw())},t.prototype.getTolerance=function(){return 100},t.prototype.handleMouseOutUp=function(t){this.selected&&(t.stopImmediatePropagation(),this.isDown=!1,this.corners.forEach((function(t){return t.isDown=!1})),this.redraw())},t.prototype.destroy=function(){this.removeMouseEvents(),this.selected=!1,this.mySelectionListener.remove(this.remover),this.myScene.sim.disableChangeObjectButtons()},t.prototype.redraw=function(){switch(this.type){case n.ColorArea:this.myScene.redrawColorAreas=!0;break;case n.Obstacle:this.myScene.redrawObstacles=!0;break;case n.Marker:this.myScene.redrawMarkers=!0}},t}();e.BaseSimulationObject=h;var n,a,c=function(){function t(){}return t.getSimObject=function(t,e,s,i,r,o,h,n){for(var c=[],p=8;p<arguments.length;p++)c[p-8]=arguments[p];switch(i){case a.Rectangle:return new(l.bind.apply(l,__spreadArray([void 0,t,e,s,r,o,h,n],c,!1)));case a.Triangle:return new(d.bind.apply(d,__spreadArray([void 0,t,e,s,r,o,h,n],c,!1)));case a.Circle:return new(u.bind.apply(u,__spreadArray([void 0,t,e,s,r,o,h,n],c,!1)));case a.Marker:return new y(t,e,s,r,o)}},t.copy=function(e){var s=e.myScene.uniqueObjectId;return e instanceof l?t.getSimObject.apply(t,__spreadArray([s,e.myScene,e.mySelectionListener,a.Rectangle,e.type,{x:-1e3,y:-1e3},null,e.color],[e.w,e.h],!1)):e instanceof d?t.getSimObject.apply(t,__spreadArray([s,e.myScene,e.mySelectionListener,a.Triangle,e.type,{x:-1e3,y:-1e3},null,e.color],[e.ax,e.ay,e.bx,e.by,e.cx,e.cy],!1)):e instanceof u?t.getSimObject.apply(t,__spreadArray([s,e.myScene,e.mySelectionListener,a.Circle,e.type,{x:-1e3,y:-1e3},null,e.color],[e.r],!1)):void 0},t}();e.SimObjectFactory=c,function(t){t.Obstacle="OBSTACLE",t.ColorArea="COLORAREA",t.Passiv="PASSIV",t.Marker="MARKER"}(n=e.SimObjectType||(e.SimObjectType={})),function(t){t.Rectangle="RECTANGLE",t.Triangle="TRIANGLE",t.Circle="CIRCLE",t.Marker="MARKER"}(a=e.SimObjectShape||(e.SimObjectShape={}));var l=function(t){function e(e,s,i,r,o,h,n){for(var a=[],c=7;c<arguments.length;c++)a[c-7]=arguments[c];var l=t.call(this,e,s,i,r,n)||this;return l.w=100,l.h=100,l.theta=0,l.corners=[],l.x=o.x,l.y=o.y,h&&(l.w=h/9,l.h=h/9),2==a.length&&(l.w=a[0],l.h=a[1]),"string"!=typeof n&&(l._img=n),l.updateCorners(),l}return __extends(e,t),Object.defineProperty(e.prototype,"img",{get:function(){return this._img},set:function(t){this._img=t},enumerable:!1,configurable:!0}),e.prototype.draw=function(t,e){switch(t.save(),e.save(),t.fillStyle=this.color,this.type){case n.Obstacle:t.shadowColor="#3e3e3e",t.shadowOffsetY=5,t.shadowOffsetX=5,t.shadowBlur=5,t.globalCompositeOperation="lighten",this._img?t.drawImage(this._img,this.x,this.y,this.w,this.h):t.fillRect(this.x,this.y,this.w,this.h);break;case n.ColorArea:e.fillStyle=this.color,this._img?(e.drawImage(this._img,this.x,this.y,this.w,this.h),t.drawImage(this._img,this.x,this.y,this.w,this.h)):(e.fillRect(this.x,this.y,this.w,this.h),t.fillRect(this.x,this.y,this.w,this.h))}this.selected&&(t.restore(),t.save(),t.lineWidth=2,t.strokeStyle="gray",t.fillStyle="black",this.corners.forEach((function(e){e.isDown?t.fillStyle="gray":t.fillStyle="black",t.beginPath(),t.arc(e.x,e.y,5,0,2*Math.PI),t.stroke(),t.fill()}))),t.restore(),e.restore()},e.prototype.handleKeyEvent=function(t){if(this.selected){var e=t.key;switch(e){case"ArrowUp":this.y-=this.SHIFT;break;case"ArrowLeft":this.x-=this.SHIFT;break;case"ArrowDown":this.y+=this.SHIFT;break;case"ArrowRight":this.x+=this.SHIFT;break;case"c":if(t.ctrlKey||t.metaKey){this.myScene.uniqueObjectId,a.Rectangle;this.myScene.objectToCopy=c.copy(this),t.preventDefault()}}"Delete"!==e&&"Backspace"!==e&&t.stopImmediatePropagation(),this.updateCorners(),s("#robotLayer").attr("tabindex",0),s("#robotLayer").trigger("focus")}},e.prototype.handleMouseDown=function(t){t&&!t.startX&&i.extendMouseEvent(t,r.SimulationRoberta.Instance.scale,s("#robotLayer"));var e=t;if(this.isDown=this.isMouseOn(e),this.isDown&&(t.stopImmediatePropagation(),this.mouseOldX=e.startX,this.mouseOldY=e.startY),this.isDown&&!this.selected)s("#robotLayer").css("cursor","pointer"),this.selected=!0;else if(this.selected){this.corners.forEach((function(t){t.isDown=i.checkInCircle(e.startX,e.startY,t.x,t.y,15)}));var o=this.corners.map((function(t){return t.isDown})).indexOf(!0);if(o>=0)switch(t.stopImmediatePropagation(),o){case 0:case 2:s("#robotLayer").css("cursor","nwse-resize");break;case 1:case 3:s("#robotLayer").css("cursor","nesw-resize")}}},e.prototype.handleMouseMove=function(t){t&&!t.startX&&i.extendMouseEvent(t,r.SimulationRoberta.Instance.scale,s("#robotLayer"));var e=t,o=e.startX-this.mouseOldX,h=e.startY-this.mouseOldY;this.mouseOldX=e.startX,this.mouseOldY=e.startY;var n=this.corners.map((function(t){return t.isDown})).indexOf(!0);this.isMouseOn(e)&&(s("#robotLayer").css("cursor","pointer"),s("#robotLayer").data("hovered",!0),this.selected&&t.stopImmediatePropagation());for(var a=-1,c=0;c<this.corners.length;c++)if(i.checkInCircle(e.startX,e.startY,this.corners[c].x,this.corners[c].y,15)){a=c;break}if(a>-1&&this.selected)switch(t.stopImmediatePropagation(),a){case 0:case 2:s("#robotLayer").css("cursor","nwse-resize");break;case 1:case 3:s("#robotLayer").css("cursor","nesw-resize")}if(n>=0&&this.selected){if(this.w>=this.MIN_SIZE_OBJECT&&this.h>=this.MIN_SIZE_OBJECT)switch(n){case 0:this.x+=o,this.y+=h,this.w-=o,this.h-=h;break;case 1:this.y+=h,this.w+=o,this.h-=h;break;case 2:this.w+=o,this.h+=h;break;case 3:this.x+=o,this.w-=o,this.h+=h}else this.w<this.MIN_SIZE_OBJECT?(0!=n&&3!=n||(this.x-=this.MIN_SIZE_OBJECT-this.w),this.w=this.MIN_SIZE_OBJECT):this.h<this.MIN_SIZE_OBJECT&&(1!=n&&2!=n||(this.y-=this.MIN_SIZE_OBJECT-this.h),this.h=this.MIN_SIZE_OBJECT);this.updateCorners()}else this.isDown&&(this.x+=o,this.y+=h,this.updateCorners())},e.prototype.getLines=function(){return i.getLinesFromRectangle(this)},e.prototype.moveTo=function(t){this.x=t.x-this.w/2,this.y=t.y-this.h/2,this.updateCorners()},e.prototype.updateCorners=function(){0==this.corners.length?(this.corners[0]={x:this.x,y:this.y,isDown:!1},this.corners[1]={x:this.x+this.w,y:this.y,isDown:!1},this.corners[2]={x:this.x+this.w,y:this.y+this.h,isDown:!1},this.corners[3]={x:this.x,y:this.y+this.h,isDown:!1}):(this.corners[0]={x:this.x,y:this.y,isDown:this.corners[0].isDown},this.corners[1]={x:this.x+this.w,y:this.y,isDown:this.corners[1].isDown},this.corners[2]={x:this.x+this.w,y:this.y+this.h,isDown:this.corners[2].isDown},this.corners[3]={x:this.x,y:this.y+this.h,isDown:this.corners[3].isDown}),this.redraw()},e.prototype.isMouseOn=function(t){return t.startX>this.x&&t.startX<this.x+this.w&&t.startY>this.y&&t.startY<this.y+this.h},e}(h);e.RectangleSimulationObject=l;var y=function(t){function e(e,s,i,r,o){var h=t.call(this,e,s,i,r,o)||this;return h.MARKER_OFFSET=33,h.MARKER_LABEL_OFFSET=40,h.w=36,h.h=36,h.updateCorners(),h}return __extends(e,t),e.prototype.draw=function(t,e){t.save(),t.fillStyle="#ffffff";var i=this.w/12;t.fillRect(this.x-i,this.y-i-1,this.w+2*i,this.h+2*i),t.fillStyle="#000000",t.fillText(String(this.markerId),this.x+this.MARKER_LABEL_OFFSET,this.y+this.h/2),t.font=this.w+"px typicons",t.textAlign="left",t.fillText(window.getComputedStyle(s(".typcn.typcn-"+this.markerId)[0],":before").content.replace(/"/,"").replace(/"/,""),this.x,this.y+this.MARKER_OFFSET),this.selected&&(t.restore(),t.save(),t.lineWidth=2,t.strokeStyle="gray",t.fillStyle="black",this.corners.forEach((function(e){e.isDown?t.fillStyle="gray":t.fillStyle="black",t.beginPath(),t.arc(e.x,e.y,5,0,2*Math.PI),t.stroke(),t.fill()}))),t.restore()},e.prototype.handleMouseDown=function(t){t&&!t.startX&&i.extendMouseEvent(t,r.SimulationRoberta.Instance.scale,s("#robotLayer"));var e=t;this.isDown=this.isMouseOn(e),this.isDown&&(t.stopImmediatePropagation(),this.mouseOldX=e.startX,this.mouseOldY=e.startY),this.isDown&&!this.selected&&(s("#robotLayer").css("cursor","pointer"),this.selected=!0)},e.prototype.handleMouseMove=function(t){t&&!t.startX&&i.extendMouseEvent(t,r.SimulationRoberta.Instance.scale,s("#robotLayer"));var e=t,o=e.startX-this.mouseOldX,h=e.startY-this.mouseOldY;this.mouseOldX=e.startX,this.mouseOldY=e.startY,this.isMouseOn(e)&&(s("#robotLayer").css("cursor","pointer"),s("#robotLayer").data("hovered",!0),this.selected&&t.stopImmediatePropagation()),this.selected&&this.isDown&&(this.x+=o,this.y+=h,this.updateCorners())},e}(l);e.MarkerSimulationObject=y;var u=function(t){function e(e,s,i,r,o,h,n){for(var a=[],c=7;c<arguments.length;c++)a[c-7]=arguments[c];var l=t.call(this,e,s,i,r,n)||this;return l.r=50,l.corners=[],l.collisions=[],l.lastMoveBumped=!1,l.lastMoveBumpedOld=!1,l.observers=[],l.inEvacuationZone=!1,l.x=o.x,l.y=o.y,h&&(l.r=h/18),a.length>=1&&(l.r=a[0]),a.length>=2&&(l.movable=a[1]>0),l.updateCorners(),l}return __extends(e,t),e.prototype.draw=function(t,e){if(t.save(),e.save(),this.type!==n.Obstacle&&this.type!==n.ColorArea||(this.type===n.Obstacle&&(t.shadowColor="#3e3e3e",t.shadowOffsetY=5,t.shadowOffsetX=5,t.shadowBlur=5,t.globalCompositeOperation="lighten"),t.fillStyle=this.color,t.beginPath(),t.arc(this.x,this.y,this.r,0,2*Math.PI),t.fill()),this.type===n.ColorArea&&(e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.r,0,2*Math.PI),e.fill()),this.selected){var s=Math.round(this.x),i=Math.round(this.y),r=Math.round(this.r);t.restore(),t.save(),t.lineWidth=2,t.strokeStyle="gray",t.fillStyle="black",t.beginPath(),t.arc(Math.round(s-r),Math.round(i-r),5,0,2*Math.PI),t.stroke(),t.fill(),t.beginPath(),t.arc(Math.round(s+r),Math.round(i-r),5,0,2*Math.PI),t.stroke(),t.fill(),t.beginPath(),t.arc(Math.round(s-r),Math.round(i+r),5,0,2*Math.PI),t.stroke(),t.fill(),t.beginPath(),t.arc(Math.round(s+r),Math.round(i+r),5,0,2*Math.PI),t.stroke(),t.fill()}t.restore(),e.restore()},e.prototype.handleKeyEvent=function(t){if(this.selected){switch(t.stopImmediatePropagation(),t.key){case"ArrowUp":this.y-=this.SHIFT;break;case"ArrowLeft":this.x-=this.SHIFT;break;case"ArrowDown":this.y+=this.SHIFT;break;case"ArrowRight":this.x+=this.SHIFT}if("c"===t.key&&(t.ctrlKey||t.metaKey)){this.myScene.uniqueObjectId,a.Circle;this.myScene.objectToCopy=c.copy(this),t.preventDefault()}this.updateCorners(),s("#robotLayer").attr("tabindex",0),s("#robotLayer").trigger("focus")}},e.prototype.handleMouseDown=function(t){t&&!t.startX&&i.extendMouseEvent(t,r.SimulationRoberta.Instance.scale,s("#robotLayer"));var e=t;if(this.isDown=i.checkInCircle(e.startX,e.startY,this.x,this.y,this.r),this.isDown&&(t.stopImmediatePropagation(),this.mouseOldX=e.startX,this.mouseOldY=e.startY),this.isDown&&!this.selected)s("#robotLayer").css("cursor","pointer"),this.selected=!0;else if(this.selected&&!this.movable){this.corners.forEach((function(t){t.isDown=i.checkInCircle(e.startX,e.startY,t.x,t.y,15)}));var o=this.corners.map((function(t){return t.isDown})).indexOf(!0);if(o>=0)switch(t.stopImmediatePropagation(),o){case 0:case 2:s("#robotLayer").css("cursor","nwse-resize");break;case 1:case 3:s("#robotLayer").css("cursor","nesw-resize")}}},e.prototype.handleMouseMove=function(t){t&&!t.startX&&i.extendMouseEvent(t,r.SimulationRoberta.Instance.scale,s("#robotLayer"));var e=t,o=e.startX-this.mouseOldX,h=e.startY-this.mouseOldY;this.mouseOldX=e.startX,this.mouseOldY=e.startY;var n=this.corners.map((function(t){return t.isDown})).indexOf(!0);i.checkInCircle(e.startX,e.startY,this.x,this.y,this.r)&&(s("#robotLayer").css("cursor","pointer"),s("#robotLayer").data("hovered",!0),this.selected&&t.stopImmediatePropagation());var a=-1;if(!this.movable)for(var c=0;c<this.corners.length;c++)if(i.checkInCircle(e.startX,e.startY,this.corners[c].x,this.corners[c].y,15)){a=c;break}if(a>-1&&this.selected)switch(t.stopImmediatePropagation(),a){case 0:case 2:s("#robotLayer").css("cursor","nwse-resize");break;case 1:case 3:s("#robotLayer").css("cursor","nesw-resize")}n>=0&&this.selected?(Math.abs(o)>=Math.abs(h)?e.startX<this.x?this.r-=o:this.r+=o:e.startY<this.y?this.r-=h:this.r+=h,this.r=Math.max(this.r,this.MIN_SIZE_OBJECT),this.updateCorners()):this.isDown&&(this.x+=o,this.y+=h,this.updateCorners(),this.movable&&(this.lastMoveBumpedOld=!1,this.lastMoveBumped=!1))},e.prototype.getLines=function(){throw new Error("Should never be called")},e.prototype.moveTo=function(t){this.x=t.x,this.y=t.y,this.updateCorners()},e.prototype.updateCorners=function(){0==this.corners.length?(this.corners[0]={x:this.x-this.r,y:this.y-this.r,isDown:!1},this.corners[1]={x:this.x+this.r,y:this.y-this.r,isDown:!1},this.corners[2]={x:this.x+this.r,y:this.y+this.r,isDown:!1},this.corners[3]={x:this.x-this.r,y:this.y+this.r,isDown:!1}):(this.corners[0]={x:this.x-this.r,y:this.y-this.r,isDown:this.corners[0].isDown},this.corners[1]={x:this.x+this.r,y:this.y-this.r,isDown:this.corners[1].isDown},this.corners[2]={x:this.x+this.r,y:this.y+this.r,isDown:this.corners[2].isDown},this.corners[3]={x:this.x-this.r,y:this.y+this.r,isDown:this.corners[3].isDown}),this.redraw()},e.prototype.getTolerance=function(){return 1.01},e.prototype.moveObstacleTo=function(t){return!!this.movable&&(this.collisions.push(t),!this.lastMoveBumpedOld)},e.prototype.updateSensor=function(t,s,i){if(this.movable){this.lastMoveBumpedOld=this.lastMoveBumped,this.lastMoveBumped=!1;var r=t.getImageData(this.x,this.y,1,1).data;this.inEvacuationZone=r.toString()===[0,0,0,255].toString();var h={x:this.x,y:this.y,r:this.r*this.getTolerance()},n=s.slice(-1)[0],a=o.getMiddleIntersectionCircleRect(h,n,o.getLinesFromRect(n));if(a){var c=o.getDistanceToCircle(a,this);this.collisions.push(c),this.lastMoveBumped=!0}for(var y=0;y<s.length-1;y++){var u=s[y];if(u instanceof l){var d=o.getMiddleIntersectionCircleRect(h,u,u.getLines());if(d){c=o.getDistanceToCircle(d,this);this.collisions.push(c),this.lastMoveBumped=!0}}if(u instanceof e){if(u.myId==this.myId){s.splice(y,1);continue}var p=o.getMiddleIntersectionPointCircles(h,u);if(p){c=o.getDistanceToCircle(p,u);u.movable?(u.moveObstacleTo(c)||(this.lastMoveBumped=!0,this.collisions.push({x:-c.x,y:-c.y})),i.push(u)):(this.lastMoveBumped=!0,this.collisions.push({x:-c.x,y:-c.y}))}}}this.notifyObservers()}},e.prototype.updateAction=function(){var t={x:0,y:0};if(this.collisions.forEach((function(e){t.x+=e.x,t.y+=e.y})),this.collisions.length>0){var e=o.getDotProduct(t,this.lastMove);this.lastMoveBumped?e&&(e<-.9||e&&e>.9)&&this.moveTo({x:this.x+t.x,y:this.y+t.y}):this.moveTo({x:this.x+t.x,y:this.y+t.y})}this.lastMove=t,this.collisions=[]},e.prototype.addObserver=function(t){this.observers.push(t)},e.prototype.notifyObservers=function(){for(var t=0,e=this.observers;t<e.length;t++){e[t].update(this)}},e.prototype.removeObserver=function(t){var e=this.observers.findIndex((function(e){return t===e}));-1!==e&&this.observers.splice(e,1)},e}(h);e.CircleSimulationObject=u;var d=function(t){function e(e,s,i,r,o,h,n){for(var a=[],c=7;c<arguments.length;c++)a[c-7]=arguments[c];var l=t.call(this,e,s,i,r,n)||this;return l.defaultSize=50,l.corners=[],h&&(l.defaultSize=h/18),6==a.length?(l.ax=a[0],l.ay=a[1],l.bx=a[2],l.by=a[3],l.cx=a[4],l.cy=a[5]):(l.ax=o.x-l.defaultSize,l.ay=o.y+l.defaultSize,l.bx=o.x,l.by=o.y-l.defaultSize,l.cx=o.x+l.defaultSize,l.cy=o.y+l.defaultSize),l.updateCorners(),l}return __extends(e,t),e.prototype.draw=function(t,e){t.save(),e.save(),this.type!==n.Obstacle&&this.type!==n.ColorArea||(this.type===n.Obstacle&&(t.shadowColor="#3e3e3e",t.shadowOffsetY=5,t.shadowOffsetX=5,t.shadowBlur=5,t.globalCompositeOperation="lighten"),t.fillStyle=this.color,t.beginPath(),t.moveTo(this.ax,this.ay),t.lineTo(this.bx,this.by),t.lineTo(this.cx,this.cy),t.fill()),this.type===n.ColorArea&&(e.fillStyle=this.color,e.beginPath(),e.moveTo(this.ax,this.ay),e.lineTo(this.bx,this.by),e.lineTo(this.cx,this.cy),e.fill()),this.selected&&(t.restore(),t.save(),t.lineWidth=2,t.strokeStyle="gray",t.fillStyle="black",t.beginPath(),t.arc(Math.round(this.ax),Math.round(this.ay),5,0,2*Math.PI),t.stroke(),t.fill(),t.beginPath(),t.arc(Math.round(this.bx),Math.round(this.by),5,0,2*Math.PI),t.stroke(),t.fill(),t.beginPath(),t.arc(Math.round(this.cx),Math.round(this.cy),5,0,2*Math.PI),t.stroke(),t.fill()),t.restore(),e.restore()},e.prototype.handleKeyEvent=function(t){if(this.selected){switch(t.stopImmediatePropagation(),t.key){case"ArrowUp":this.ay-=this.SHIFT,this.by-=this.SHIFT,this.cy-=this.SHIFT;break;case"ArrowLeft":this.ax-=this.SHIFT,this.bx-=this.SHIFT,this.cx-=this.SHIFT;break;case"ArrowDown":this.ay+=this.SHIFT,this.by+=this.SHIFT,this.cy+=this.SHIFT;break;case"ArrowRight":this.ax+=this.SHIFT,this.bx+=this.SHIFT,this.cx+=this.SHIFT}if("c"===t.key&&(t.ctrlKey||t.metaKey)){this.myScene.uniqueObjectId,a.Triangle;this.myScene.objectToCopy=c.copy(this),t.preventDefault()}this.updateCorners(),s("#robotLayer").attr("tabindex",0),s("#robotLayer").trigger("focus")}},e.prototype.handleMouseDown=function(t){t&&!t.startX&&i.extendMouseEvent(t,r.SimulationRoberta.Instance.scale,s("#robotLayer"));var e=t;if(this.isDown=this.isMouseOn(e),this.isDown&&(t.stopImmediatePropagation(),this.mouseOldX=e.startX,this.mouseOldY=e.startY),this.isDown&&!this.selected)s("#robotLayer").css("cursor","pointer"),s("#robotLayer").data("hovered",!0),this.selected=!0;else if(this.selected){this.corners.forEach((function(t){t.isDown=i.checkInCircle(e.startX,e.startY,t.x,t.y,15)})),this.corners.map((function(t){return t.isDown})).indexOf(!0)>=0&&(t.stopImmediatePropagation(),s("#robotLayer").css("cursor","move"))}},e.prototype.handleMouseMove=function(t){t&&!t.startX&&i.extendMouseEvent(t,r.SimulationRoberta.Instance.scale,s("#robotLayer"));var e=t,o=e.startX-this.mouseOldX,h=e.startY-this.mouseOldY;this.mouseOldX=e.startX,this.mouseOldY=e.startY;var n=this.corners.map((function(t){return t.isDown})).indexOf(!0);this.isMouseOn(e)&&(s("#robotLayer").css("cursor","pointer"),s("#robotLayer").data("hovered",!0),this.selected&&t.stopImmediatePropagation());for(var a=-1,c=0;c<this.corners.length;c++)if(i.checkInCircle(e.startX,e.startY,this.corners[c].x,this.corners[c].y,15)){a=c;break}if(a>-1&&this.selected&&(s("#robotLayer").css("cursor","move"),t.stopImmediatePropagation()),n>=0&&this.selected){switch(n){case 0:this.ax+=o,this.ay+=h;break;case 1:this.bx+=o,this.by+=h;break;case 2:this.cx+=o,this.cy+=h}this.updateCorners()}else this.isDown&&(this.ax+=o,this.ay+=h,this.bx+=o,this.by+=h,this.cx+=o,this.cy+=h,this.updateCorners())},e.prototype.getLines=function(){return[{x1:this.ax,x2:this.bx,y1:this.ay,y2:this.by},{x1:this.bx,x2:this.cx,y1:this.by,y2:this.cy},{x1:this.ax,x2:this.cx,y1:this.ay,y2:this.cy}]},e.prototype.moveTo=function(t){var e=this.ax-t.x,s=this.ay-t.y;this.ax=t.x,this.ay=t.y,this.bx-=e,this.by-=s,this.cx-=e,this.cy-=s,this.updateCorners()},e.prototype.isMouseOn=function(t){var e=Math.floor(Math.abs((this.bx-this.ax)*(this.cy-this.ay)-(this.cx-this.ax)*(this.by-this.ay)));return Math.floor(Math.abs((this.ax-t.startX)*(this.by-t.startY)-(this.bx-t.startX)*(this.ay-t.startY)))+Math.floor(Math.abs((this.bx-t.startX)*(this.cy-t.startY)-(this.cx-t.startX)*(this.by-t.startY)))+Math.floor(Math.abs((this.cx-t.startX)*(this.ay-t.startY)-(this.ax-t.startX)*(this.cy-t.startY)))<=e},e.prototype.updateCorners=function(){0==this.corners.length?(this.corners[0]={x:this.ax,y:this.ay,isDown:!1},this.corners[1]={x:this.bx,y:this.by,isDown:!1},this.corners[2]={x:this.cx,y:this.cy,isDown:!1}):(this.corners[0]={x:this.ax,y:this.ay,isDown:this.corners[0].isDown},this.corners[1]={x:this.bx,y:this.by,isDown:this.corners[1].isDown},this.corners[2]={x:this.cx,y:this.cy,isDown:this.corners[2].isDown}),this.redraw()},e}(h);e.TriangleSimulationObject=d;var p=function(){function t(t,e,s,i){this.x=t,this.y=e,this.w=s,this.h=i}return t.prototype.getLines=function(){return i.getLinesFromRectangle(this)},t.prototype.getTolerance=function(){return 0},t}();e.Ground=p;var f=function(t){function e(e,s,i,r,o,h,n,a){var c=t.call(this,e,s,i,r,{x:90*o+10,y:90*h+10})||this;switch(c.w=90,c.h=90,c.type=r,c.rcjType=n,c.index=String(a),c.rcjType){case"checkPoint":c.color="#FFA500";break;case"start":c.color="#81E881"}return c}return __extends(e,t),e.prototype.draw=function(t,e){t.save(),this.rcjType&&(t.lineWidth=2,t.strokeStyle=this.color,t.strokeRect(this.x,this.y,this.w,this.h)),t.fillText(this.index,this.x+60,this.y+15),t.restore()},e.prototype.handleMouseDown=function(t){},e.prototype.handleMouseMove=function(t){},e}(l);e.RcjSimulationLabel=f}));
//# sourceMappingURL=simulation.objects.js.map
//# sourceMappingURL=simulation.objects.js.map
