var __extends=this&&this.__extends||function(){var t=function(i,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])},t(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function s(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}}();define(["require","exports","robot.base.mobile","interpreter.constants","simulation.math","util.roberta","robot.actuators","simulation.objects","blockly","volume-meter","simulation.roberta"],(function(t,i,e,s,r,a,n,o,h,l,p){Object.defineProperty(i,"__esModule",{value:!0}),i.Txt4CameraSensor=i.CameraSensor=i.OdometrySensor=i.SoundSensorBoolean=i.SoundSensor=i.VolumeMeterSensor=i.TemperatureSensor=i.Rob3rtaInfraredSensor=i.CalliopeLightSensor=i.CompassSensor=i.GestureSensor=i.MbotButton=i.MicrobitPins=i.Pins=i.TouchKeys=i.EV3Keys=i.Keys=i.GyroSensorExt=i.GyroSensor=i.OpticalSensor=i.LightSensor=i.NXTColorSensor=i.ColorSensor=i.RobotinoTouchSensor=i.TapSensor=i.TouchSensor=i.EdisonInfraredSensors=i.RobotinoInfraredSensors=i.ThymioInfraredSensors=i.InfraredSensors=i.MbotInfraredSensor=i.Txt4InfraredSensors=i.ThymioLineSensors=i.LineSensor=i.EdisonInfraredSensor=i.ThymioInfraredSensor=i.InfraredSensor=i.UltrasonicSensor=i.DistanceSensor=i.Timer=void 0;var d=function(){function t(t){this.time=[],this.labelPriority=14;for(var i=0;i<t;i++)this.time[i]=0}return t.prototype.getLabel=function(){for(var t="",i=0;i<this.time.length;i++){t+="<div><label>"+(i+1)+"</label><span>"+(a.round(this.time[i],1)+" s")+"</span></div>"}return t},t.prototype.reset=function(){for(var t in this.time)this.time[t]=0},t.prototype.updateAction=function(t,i,e){if(e){for(var s in this.time)this.time[s]+=i;var r=t.interpreter.getRobotBehaviour().getActionState("timer",!0);if(r)for(var a=1;a<=this.time.length;a++)r[a]&&"reset"==r[a]&&(this.time[a-1]=0)}},t.prototype.updateSensor=function(t,i,e,s,r,a,n){s.timer=s.timer||[];for(var o=0;o<this.time.length;o++)s.timer[o+1]=1e3*this.time[o]},t}();i.Timer=d;var u=function(){function t(t,i,e,s,r){this.color="#FF69B4",this.sensorLabel=!0,this.cx=0,this.cy=0,this.distance=0,this.rx=0,this.ry=0,this.u=[],this.wave=0,this.drawPriority=5,this.port=t,this.labelPriority=Number(this.port.replace("ORT_","")),this.x=i,this.y=e,this.theta=s,this.maxDistance=r,this.maxLength=3*r}return t.prototype.draw=function(t,i){t.restore(),t.save(),t.lineDashOffset=60-this.wave,t.setLineDash([20,40]);for(var e=0;e<this.u.length;e++)t.beginPath(),t.lineWidth=.5,t.strokeStyle="#555555",t.moveTo(this.rx,this.ry),t.lineTo(this.u[e].x,this.u[e].y),t.stroke();this.cx&&this.cy&&(t.beginPath(),t.lineWidth=1,t.strokeStyle="black",t.moveTo(this.rx,this.ry),t.lineTo(this.cx,this.cy),t.stroke()),this.sensorLabel&&(t.translate(this.rx,this.ry),t.rotate(i.pose.theta),t.rotate(this.theta),t.translate(10,0),t.rotate(-this.theta),t.translate(-5,0),t.beginPath(),t.fillStyle="#555555",t.fillText(String(this.port.replace("ORT_","")),0,4)),t.restore(),t.save(),t.translate(i.pose.x,i.pose.y),t.rotate(i.pose.theta)},t.prototype.updateSensor=function(t,i,s,a,h,l,p){if(s instanceof e.RobotBaseMobile){var d=s;r.transform(d.pose,this),a.ultrasonic=a.ultrasonic||{},a.infrared=a.infrared||{},a.ultrasonic[this.port]={},a.infrared[this.port]={},this.cx=null,this.cy=null,this.wave+=60*i,this.wave%=60;var u={x1:this.rx,y1:this.ry,x2:this.rx+this.maxLength*Math.cos(d.pose.theta+this.theta),y2:this.ry+this.maxLength*Math.sin(d.pose.theta+this.theta)},c={x1:this.rx,y1:this.ry,x2:this.rx+this.maxLength*Math.cos(d.pose.theta-Math.PI/8+this.theta),y2:this.ry+this.maxLength*Math.sin(d.pose.theta-Math.PI/8+this.theta)},y={x1:this.rx,y1:this.ry,x2:this.rx+this.maxLength*Math.cos(d.pose.theta-Math.PI/16+this.theta),y2:this.ry+this.maxLength*Math.sin(d.pose.theta-Math.PI/16+this.theta)},b={x1:this.rx,y1:this.ry,x2:this.rx+this.maxLength*Math.cos(d.pose.theta+Math.PI/8+this.theta),y2:this.ry+this.maxLength*Math.sin(d.pose.theta+Math.PI/8+this.theta)},f=[c,y,u,{x1:this.rx,y1:this.ry,x2:this.rx+this.maxLength*Math.cos(d.pose.theta+Math.PI/16+this.theta),y2:this.ry+this.maxLength*Math.sin(d.pose.theta+Math.PI/16+this.theta)},b];this.distance=this.maxLength;for(var x=[this.maxLength,this.maxLength,this.maxLength,this.maxLength,this.maxLength],g=0;g<p.length;g++){var v=p[g];if(!(v instanceof n.ChassisMobile&&v.id==d.id))if(v instanceof o.CircleSimulationObject)for(S=0;S<f.length;S++){I=r.getClosestIntersectionPointCircle(f[S],p[g]);this.checkShortestDistance(I,x,S,f[S])}else for(var M=v.getLines(),m=0;m<M.length;m++)for(var S=0;S<f.length;S++){var I=r.getIntersectionPoint(f[S],M[m]);this.checkShortestDistance(I,x,S,f[S])}}for(g=0;g<f.length;g++)this.u[g]={x:f[g].x2,y:f[g].y2}}else this.distance=0},t.prototype.checkShortestDistance=function(t,i,e,s){if(t){var r=Math.sqrt((t.x-this.rx)*(t.x-this.rx)+(t.y-this.ry)*(t.y-this.ry));r<this.distance&&(this.distance=r,this.cx=t.x,this.cy=t.y),r<i[e]&&(i[e]=r,s.x2=t.x,s.y2=t.y)}},t}();i.DistanceSensor=u;var c=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.getLabel=function(){return"<div><label>"+this.port.replace("ORT_","")+" "+h.Msg.SENSOR_ULTRASONIC+"</label><span>"+a.round(this.distance/3,0)+" cm</span></div>"},i.prototype.updateSensor=function(i,e,s,r,a,n,o){t.prototype.updateSensor.call(this,i,e,s,r,a,n,o);var h=this.distance/3;r.ultrasonic=r.ultrasonic||{},r.ultrasonic[this.port]={},h<this.maxDistance?r.ultrasonic[this.port].distance=h:r.ultrasonic[this.port].distance=this.maxDistance,r.ultrasonic[this.port].presence=!1},i}(u);i.UltrasonicSensor=c;var y=function(t){function i(i,e,s,r,a,n,o){var h=t.call(this,i,e,s,r,a)||this;return h.relative=!0,h.name=o,h.relative=void 0!==n?n:h.relative,h}return __extends(i,t),i.prototype.getLabel=function(){return this.name?"<div><label>"+this.name+" "+h.Msg.SENSOR_INFRARED+"</label><span>"+a.round(this.distance/3,0)+" cm</span></div>":"<div><label>"+this.port.replace("ORT_","")+" "+h.Msg.SENSOR_INFRARED+"</label><span>"+a.round(this.distance/3,0)+" cm</span></div>"},i.prototype.updateSensor=function(i,e,s,r,a,n,o){t.prototype.updateSensor.call(this,i,e,s,r,a,n,o);var h=this.distance/3;r.infrared=r.infrared||{},r.infrared[this.port]={},this.relative?h<this.maxDistance?r.infrared[this.port].distance=100/this.maxDistance*h:r.infrared[this.port].distance=100:h<this.maxDistance?r.infrared[this.port].distance=h:r.infrared[this.port].distance=this.maxDistance,r.infrared[this.port].presence=!1},i}(u);i.InfraredSensor=y;var b=function(t){function i(i,e,s,r,a,n){var o=t.call(this,i,e,s,r,a,!0,n)||this;return o.sensorLabel=!1,o}return __extends(i,t),i.prototype.getLabel=function(){var t=this.distance/3;return t<this.maxDistance?t*=100/this.maxDistance:t=100,t=a.round(t,0),"<div><label>&nbsp;-&nbsp;"+this.name+"</label><span>"+a.round(t,0)+" %</span></div>"},i.prototype.updateSensor=function(i,e,s,r,n,o,h){t.prototype.updateSensor.call(this,i,e,s,r,n,o,h);var l=this.distance/3;r.infrared=r.infrared||{},r.infrared.distance=r.infrared.distance?r.infrared.distance:{},l<this.maxDistance?r.infrared.distance[this.port]=a.round(100/this.maxDistance*l,0):r.infrared.distance[this.port]=100},i}(y);i.ThymioInfraredSensor=b;var f=function(t){function i(i,e,s,r,a,n){var o=t.call(this,i,e,s,r,a,!1,n)||this;return o.sensorLabel=!1,o}return __extends(i,t),i.prototype.getLabel=function(){return"<div><label>&nbsp;-&nbsp;"+this.name+"</label><span>"+(this.distance/3<this.maxDistance)+"</span></div>"},i.prototype.updateSensor=function(i,e,s,r,a,n,o){t.prototype.updateSensor.call(this,i,e,s,r,a,n,o);var h=this.distance/3;r.infrared=r.infrared||{},r.infrared[this.port]=r.infrared[this.port]?r.infrared[this.port]:{},r.infrared[this.port].obstacle=h<this.maxDistance},i}(y);i.EdisonInfraredSensor=f;var x=function(){function t(t,i){this.line=!1,this.light=0,this.drawPriority=4,this.labelPriority=4,this.rx=0,this.ry=0,this.radius=0,this.diameter=0,this.in=[],this.x=t.x,this.y=t.y,this.diameter=i,this.radius=this.diameter/2;for(var e=0;e<this.diameter;e++)for(var s=0;s<this.diameter;s++){var r=e-Math.floor(this.radius),a=s-Math.floor(this.radius);r*r+a*a<=1&&this.in.push(4*(e+s*this.diameter))}}return t.prototype.draw=function(t,i){t.save(),t.beginPath(),t.lineWidth=.1,t.arc(this.x,this.y,this.radius,0,2*Math.PI);var e=this.light/100*255;t.fillStyle="rgb("+e+", "+e+", "+e+")",t.fill(),t.strokeStyle="#000000",t.stroke(),t.restore()},t.prototype.getLabel=function(){return"<div><label>"+h.Msg.SENSOR_INFRARED+"</label></div><div><label>&nbsp;-&nbsp;"+h.Msg.BOTTOM_LEFT+"</label></div><div><label>&nbsp;--&nbsp;"+h.Msg.MODE_LINE+"</label><span>"+this.line+"</span></div><div><label>&nbsp;--&nbsp;"+h.Msg.MODE_LIGHT+"</label><span>"+this.light+"</span></div>"},t.prototype.updateSensor=function(t,i,e,s,n,o,h){var l=e,p={rx:0,ry:0,x:this.x,y:this.y};r.transform(l.pose,p),s.infrared=s.infrared||{};var d=this;!function(t,i){for(var e=0,r=0,h=0,l=n.getImageData(Math.round(i.x-d.radius),Math.round(i.y-d.radius),d.diameter,d.diameter),p=o.getImageData(Math.round(i.x-d.radius),Math.round(i.y-d.radius),d.diameter,d.diameter),u=0;u<=l.data.length;u+=4)if(255===p.data[u+3])for(var c=u;c<u+3;c++)l.data[c]=p.data[c];for(c=0;c<l.data.length;c+=12)for(u=c;u<c+12;u+=4)d.in.indexOf(u)>=0&&(e+=l.data[u],r+=l.data[u+1],h+=l.data[u+2]);var y=l.data.length/4-4,b=((e/=y)+(r/=y)+(h/=y))/3/2.55;d.line=b<50,d.light=a.round(b,0),s.infrared.light=s.infrared.light?s.infrared.light:{},s.infrared.light=d.light,s.infrared.line=s.infrared.line?s.infrared.line:{},s.infrared.line=d.line}(0,{x:p.rx,y:p.ry})},t}();i.LineSensor=x;var g=function(){function t(t){this.drawPriority=4,this.left=new x({x:t.x,y:t.y-3},3),this.right=new x({x:t.x,y:t.y+3},3)}return t.prototype.getLabel=function(){return"<div><label>"+h.Msg.SENSOR_INFRARED+"</label></div><div><label>&nbsp;-&nbsp;"+h.Msg.BOTTOM_LEFT+"</label></div><div><label>&nbsp;--&nbsp;"+h.Msg.MODE_LINE+"</label><span>"+this.left.line+"</span></div><div><label>&nbsp;--&nbsp;"+h.Msg.MODE_LIGHT+"</label><span>"+this.left.light+"</span></div><div><label>&nbsp;-&nbsp;"+h.Msg.BOTTOM_RIGHT+"</label></div><div><label>&nbsp;--&nbsp;"+h.Msg.MODE_LINE+"</label><span>"+this.right.line+"</span></div><div><label>&nbsp;--&nbsp;"+h.Msg.MODE_LIGHT+"</label><span>"+this.right.light+"</span></div>"},t.prototype.updateSensor=function(t,i,e,s,r,a,n,o){this.left.updateSensor(t,i,e,s,r,a,n),this.right.updateSensor(t,i,e,s,r,a,n),this.left.line=this.left.line?1:0,this.right.line=this.right.line?1:0,s.infrared.light={},s.infrared.light.left=this.left.light,s.infrared.light.right=this.right.light,s.infrared.line={},s.infrared.line.left=this.left.line,s.infrared.line.right=this.right.line},t.prototype.draw=function(t,i){this.left.draw(t,i),this.right.draw(t,i)},t}();i.ThymioLineSensors=g;var v=function(){function t(t,i){this.drawPriority=4,this.port=t,this.left=new x({x:i.x,y:i.y-3},3),this.right=new x({x:i.x,y:i.y+3},3)}return t.prototype.getLabel=function(){return"<div><label>"+h.Msg.SENSOR_INFRARED+" "+h.Msg.MODE_LINE+"</label></div><div><label>&nbsp;-&nbsp;"+h.Msg.BOTTOM_LEFT+"</label><span>"+this.left.line+"</span></div><div><label>&nbsp;-&nbsp;"+h.Msg.BOTTOM_RIGHT+"</label><span>"+this.right.line+"</span></div>"},t.prototype.updateSensor=function(t,i,e,s,r,a,n,o){this.left.updateSensor(t,i,e,s,r,a,n),this.right.updateSensor(t,i,e,s,r,a,n),s.infrared={},s.infrared[this.port]={},s.infrared[this.port].left=this.left.line,s.infrared[this.port].right=this.right.line},t.prototype.draw=function(t,i){this.left.draw(t,i),this.right.draw(t,i)},t}();i.Txt4InfraredSensors=v;var M=function(){function t(t,i){this.right={value:0},this.left={value:0},this.drawPriority=4,this.rx=0,this.ry=0,this.dx=5,this.dy=8,this.r=1.5,this.x=i.x,this.y=i.y,this.port=t,this.labelPriority=Number(this.port.replace("ORT_",""))}return t.prototype.draw=function(t,i){t.save(),t.fillStyle="#333",t.rect(this.x,this.y-this.dy/2,this.dx,this.dy),t.fill(),t.beginPath(),t.lineWidth=.1,t.arc(this.x+this.dx/2,this.y-this.dy/4,this.r,0,2*Math.PI),t.fillStyle=this.left.value?"black":"white",t.fill(),t.strokeStyle="black",t.stroke(),t.lineWidth=.5,t.beginPath(),t.lineWidth=.1,t.arc(this.x+this.dx/2,this.y+this.dy/4,this.r,0,2*Math.PI),t.fillStyle=this.right.value?"black":"white",t.fill(),t.strokeStyle="black",t.stroke(),t.beginPath(),t.fillStyle="#555555",t.fillText(String(this.port.replace("ORT_","")),this.x+2,this.y+12),t.restore()},t.prototype.getLabel=function(){return"<div><label>"+this.port.replace("ORT_","")+" "+h.Msg.SENSOR_INFRARED+"</label></div><div><label>&nbsp;-&nbsp;"+h.Msg.LEFT+"</label><span>"+this.left.value+"</span></div><div><label>&nbsp;-&nbsp;"+h.Msg.RIGHT+"</label><span>"+this.right.value+"</span></div>"},t.prototype.updateSensor=function(t,i,e,s,a,n,o){var h=e,l={rx:0,ry:0,x:this.x+this.dx/2,y:this.y-this.dy/4},p={rx:0,ry:0,x:this.x+this.dx/2,y:this.y+this.dy/4};r.transform(h.pose,l),r.transform(h.pose,p),s.infrared=s.infrared||{},s.infrared[this.port]={};var d=this;function u(t,i){for(var e=0,r=0,o=0,h=a.getImageData(Math.round(i.x-3),Math.round(i.y-3),6,6),l=n.getImageData(Math.round(i.x-3),Math.round(i.y-3),6,6),p=0;p<=h.data.length;p+=4)if(255===l.data[p+3])for(var u=p;u<p+3;u++)h.data[u]=l.data[u];var c=[0,4,16,20,24,44,92,116,120,124,136,140];for(u=0;u<h.data.length;u+=24)for(p=u;p<u+24;p+=4)c.indexOf(p)<0&&(e+=h.data[p],r+=h.data[p+1],o+=h.data[p+2]);var y=h.data.length/4-12,b=((e/=y)+(r/=y)+(o/=y))/3/2.55;d[t].value=b<50,s.infrared[d.port][t]=d[t].value}u("left",{x:l.rx,y:l.ry}),u("right",{x:p.rx,y:p.ry})},t}();i.MbotInfraredSensor=M;var m=function(){function t(){this.infraredSensorArray=[],this.configure()}return t.prototype.draw=function(t,i){this.infraredSensorArray.forEach((function(e){return e.draw(t,i)}))},t.prototype.getLabel=function(){var t="<div><label>"+h.Msg.SENSOR_INFRARED+"</label></div>";return this.infraredSensorArray.forEach((function(i){return t+=i.getLabel()})),t},t.prototype.updateSensor=function(t,i,e,s,r,a,n){this.infraredSensorArray.forEach((function(o){return o.updateSensor(t,i,e,s,r,a,n)}))},t}();i.InfraredSensors=m;var S=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.configure=function(){this.infraredSensorArray[0]=new b("0",24*Math.cos(-Math.PI/4),24*Math.sin(-Math.PI/4),-Math.PI/4,14,h.Msg.FRONT_LEFT),this.infraredSensorArray[1]=new b("1",26*Math.cos(-Math.PI/8),26*Math.sin(-Math.PI/8),-Math.PI/8,14,h.Msg.FRONT_LEFT_MIDDLE),this.infraredSensorArray[2]=new b("2",26,0,0,14,h.Msg.FRONT_MIDDLE),this.infraredSensorArray[3]=new b("3",26*Math.cos(Math.PI/8),26*Math.sin(Math.PI/8),Math.PI/8,14,h.Msg.FRONT_RIGHT_MIDDLE),this.infraredSensorArray[4]=new b("4",24*Math.cos(Math.PI/4),24*Math.sin(Math.PI/4),Math.PI/4,14,h.Msg.FRONT_RIGHT),this.infraredSensorArray[5]=new b("5",-9,-13,Math.PI,14,h.Msg.BACK_LEFT),this.infraredSensorArray[6]=new b("6",-9,13,Math.PI,14,h.Msg.BACK_RIGHT)},i}(m);i.ThymioInfraredSensors=S;var I=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.configure=function(){this.infraredSensorArray[0]=new y("1",68*Math.cos(0),68*Math.sin(0),0,30,!1),this.infraredSensorArray[1]=new y("2",68*Math.cos(2*-Math.PI/9),68*Math.sin(2*-Math.PI/9),2*-Math.PI/9,30,!1),this.infraredSensorArray[2]=new y("3",68*Math.cos(4*-Math.PI/9),68*Math.sin(4*-Math.PI/9),4*-Math.PI/9,30,!1),this.infraredSensorArray[3]=new y("4",68*Math.cos(6*-Math.PI/9),68*Math.sin(6*-Math.PI/9),6*-Math.PI/9,30,!1),this.infraredSensorArray[4]=new y("5",68*Math.cos(8*-Math.PI/9),68*Math.sin(8*-Math.PI/9),8*-Math.PI/9,30,!1),this.infraredSensorArray[9]=new y("9",68*Math.cos(2*Math.PI/9),68*Math.sin(2*Math.PI/9),2*Math.PI/9,30,!1),this.infraredSensorArray[8]=new y("8",68*Math.cos(4*Math.PI/9),68*Math.sin(4*Math.PI/9),4*Math.PI/9,30,!1),this.infraredSensorArray[7]=new y("7",68*Math.cos(6*Math.PI/9),68*Math.sin(6*Math.PI/9),6*Math.PI/9,30,!1),this.infraredSensorArray[6]=new y("6",68*Math.cos(8*Math.PI/9),68*Math.sin(8*Math.PI/9),8*Math.PI/9,30,!1)},i}(m);i.RobotinoInfraredSensors=I;var B=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.configure=function(){this.infraredSensorArray[1]=new f("LEFT",17,-8,0,3,h.Msg.LEFT),this.infraredSensorArray[0]=new f("FRONT",18,0,0,3,h.Msg.SLOT_FRONT),this.infraredSensorArray[2]=new f("RIGHT",17,8,0,3,h.Msg.RIGHT)},i}(m);i.EdisonInfraredSensors=B;var E=function(){function t(t,i,e,s){this.color="#FF69B4",this.rx=0,this.ry=0,this.value=!1,this.drawPriority=4,this.port=t,this.labelPriority=Number(this.port.replace("ORT_","")),this.x=i,this.y=e,this.color=s||this.color}return t.prototype.draw=function(t,i){t.save(),t.shadowBlur=5,t.shadowColor="black",t.fillStyle=i.chassis.geom.color,this.value?t.fillStyle="red":t.fillStyle=i.chassis.geom.color,t.fillRect(i.chassis.frontLeft.x-3.5,i.chassis.frontLeft.y,3.5,-i.chassis.frontLeft.y+i.chassis.frontRight.y),t.restore()},t.prototype.getLabel=function(){return"<div><label>"+this.port.replace("ORT_","")+" "+h.Msg.SENSOR_TOUCH+"</label><span>"+this.value+"</span></div>"},t.prototype.updateSensor=function(t,i,e,s,r,a,n){s.touch=s.touch||{},s.touch[this.port]=this.value=e.chassis.frontLeft.bumped||e.chassis.frontRight.bumped},t}();i.TouchSensor=E;var P=function(){function t(){}return t.prototype.updateSensor=function(t,i,e,s,r,a,n){s.touch=s.touch||{};var o=e.chassis.frontLeft.bumped||e.chassis.frontRight.bumped||e.chassis.backLeft.bumped||e.chassis.backRight.bumped;s.touch=o?1:0},t}();i.TapSensor=P;var _=function(){function t(){this.bumped=!1,this.drawPriority=4}return t.prototype.getLabel=function(){return"<div><label>"+h.Msg.SENSOR_TOUCH+"</label><span>"+this.bumped+"</span></div>"},t.prototype.updateSensor=function(t,i,e,s,r,a,n){s.touch=s.touch||{},s.touch=this.bumped=e.chassis.bumpedAngle.length>0},t}();i.RobotinoTouchSensor=_;var R=function(){function t(t,i,e,s,r,a){this.color="grey",this.colorValue="NONE",this.lightValue=0,this.rgb=[0,0,0],this.rx=0,this.ry=0,this.drawPriority=6,this.port=t,this.labelPriority=Number(this.port.replace("ORT_","")),this.x=i,this.y=e,this.theta=s,this.r=r,this.color=a||this.color}return t.prototype.draw=function(t,i){t.save(),t.beginPath(),t.arc(this.x,this.y,this.r,0,2*Math.PI),t.fillStyle=this.color,t.fill(),t.strokeStyle="black",t.stroke(),t.translate(this.x,this.y),t.beginPath(),t.fillStyle="#555555",t.fillText(this.port,-12,4),t.restore()},t.prototype.getLabel=function(){return"<div><label>"+this.port.replace("ORT_","")+" "+h.Msg.SENSOR_COLOUR+"</label></div><div><label>&nbsp;-&nbsp;"+h.Msg.MODE_COLOUR+'</label><span style="margin-left:6px; width: 20px; border-style:solid; border-width:thin; background-color:'+this.color+'">&nbsp;</span></div><div><label>&nbsp;-&nbsp;'+h.Msg.MODE_LIGHT+"</label><span>"+a.round(this.lightValue,0)+" %</span></div>"},t.prototype.updateSensor=function(t,i,e,s,n,o){s.color=s.color||{},s.light=s.light||{},s.color[this.port]={},s.light[this.port]={},r.transform(e.pose,this);var h=0,l=0,p=0,d=Math.round(this.rx-3),u=Math.round(this.ry-3);try{for(var c=n.getImageData(d,u,6,6),y=o.getImageData(d,u,6,6),b=0;b<=c.data.length;b+=4)if(255===y.data[b+3])for(var f=b;f<b+3;f++)c.data[f]=y.data[f];var x=[0,4,16,20,24,44,92,116,120,124,136,140];for(f=0;f<c.data.length;f+=24)for(b=f;b<f+24;b+=4)x.indexOf(b)<0&&(h+=c.data[b],l+=c.data[b+1],p+=c.data[b+2]);var g=c.data.length/4-12;h/=g,l/=g,p/=g,this.colorValue=r.getColor(r.rgbToHsv(h,l,p)),this.rgb=[a.round(h,0),a.round(l,0),a.round(p,0)],"NONE"===this.colorValue?this.color="grey":this.color=this.colorValue.toString().toLowerCase(),this.lightValue=(h+l+p)/3/2.55}catch(t){}s.color[this.port].colorValue=this.colorValue,s.color[this.port].colour=this.colorValue,s.color[this.port].light=this.lightValue,s.color[this.port].rgb=this.rgb,s.color[this.port].ambientlight=0},t}();i.ColorSensor=R;var L=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.ledColor="",i}return __extends(i,t),i.prototype.updateAction=function(t,i,e){var s=t.interpreter.getRobotBehaviour().getActionState("leds",!0);if(s&&s[this.port]){var r=s[this.port];switch(r.mode){case"off":this.ledColor="";break;case"on":this.ledColor=r.color.toUpperCase()}}},i.prototype.draw=function(t,i){t.save(),t.beginPath(),t.arc(this.x,this.y,this.r,0,2*Math.PI),t.fillStyle=this.color,t.fill(),t.strokeStyle="black",t.stroke(),t.translate(this.x,this.y),t.beginPath(),t.fillStyle="#555555",t.fillText(this.port,-12,4),t.restore(),this.ledColor&&(t.fillStyle=this.ledColor,t.beginPath(),t.arc(this.x,this.y,this.r/2,0,2*Math.PI),t.fill())},i.prototype.reset=function(){this.ledColor=""},i}(R);i.NXTColorSensor=L;var O=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.draw=function(t,i){t.save(),t.beginPath(),t.arc(this.x,this.y,this.r,0,2*Math.PI);var e=parseInt(String(2.55*this.lightValue),10).toString(16);t.fillStyle="#"+e+e+e,t.fill(),t.strokeStyle="black",t.stroke(),t.translate(this.x,this.y),t.beginPath(),t.fillStyle="#555555",t.fillText(this.port,-12,4),t.restore()},i.prototype.getLabel=function(){return"<div><label>"+this.port.replace("ORT_","")+" "+h.Msg.SENSOR_LIGHT+"</label></div><div><label>&nbsp;-&nbsp;"+h.Msg.MODE_LIGHT+"</label><span>"+a.round(this.lightValue,0)+" %</span></div>"},i}(R);i.LightSensor=O;var D=function(t){function i(i,e,s,r,a,n,o){var h=t.call(this,e.replace("DI","").toString(),s,r,a,n)||this;return h.name=i,h}return __extends(i,t),i.prototype.getLabel=function(){return"<div><label>"+this.name+" "+h.Msg.SENSOR_OPTICAL+"</label></div><div><label>&nbsp;-&nbsp;"+h.Msg.MODE_OPENING+"</label><span>"+this.light+"</span></div><div><label>&nbsp;-&nbsp;"+h.Msg.MODE_CLOSING+"</label><span>"+!this.light+"</span></div>"},i.prototype.draw=function(t,i){t.save(),t.beginPath(),t.arc(this.x,this.y,this.r,0,2*Math.PI),t.fillStyle=this.color,t.fill(),t.strokeStyle="black",t.stroke(),t.translate(this.x,this.y),t.beginPath(),t.fillStyle="#555555",t.fillText(this.name,8,4),t.restore()},i.prototype.updateSensor=function(i,e,r,a,n,o){t.prototype.updateSensor.call(this,i,e,r,a,n,o),this.lightValue=this.lightValue>50?100:0,this.light=0!=this.lightValue,this.color=0==this.lightValue?"black":"white",a.optical=a.optical||{},a.optical[this.name]={},a.optical[this.name][s.OPENING]=this.light,a.optical[this.name][s.CLOSING]=!this.light},i}(O);i.OpticalSensor=D;var A=function(){function t(){this.angleValue=0,this.rateValue=0}return t.prototype.getLabel=function(){return"<div><label>"+h.Msg.SENSOR_GYRO+"</label><span>"+a.round(this.angleValue,0)+" °</span></div>"},t.prototype.reset=function(){this.angleValue=0,this.rateValue=0},t.prototype.updateAction=function(t,i,e){},t.prototype.updateSensor=function(t,i,e,s,r,a,n){},t}();i.GyroSensor=A;var T=function(t){function i(i,e,s,r){var a=t.call(this)||this;return a.color="#000000",a.port=i,a.x=e,a.y=s,a.theta=r,a}return __extends(i,t),i.prototype.getLabel=function(){return"<div><label>"+this.port.replace("ORT_","")+" "+h.Msg.SENSOR_GYRO+"</label><span>"+a.round(this.angleValue,0)+" °</span></div>"},i.prototype.updateAction=function(t,i,e){var s=t.interpreter.getRobotBehaviour().getActionState("gyroReset",!1);s&&s[this.port]&&(t.interpreter.getRobotBehaviour().getActionState("gyroReset",!0),this.reset())},i.prototype.updateSensor=function(t,i,e,s,a,n,o){s.gyro=s.gyro||{},s.gyro[this.port]={},this.angleValue+=r.toDegree(e.thetaDiff),s.gyro[this.port].angle=this.angleValue,this.rateValue=i*r.toDegree(e.thetaDiff),s.gyro[this.port].rate=this.rateValue},i}(A);i.GyroSensorExt=T;var w=function(){function t(){this.keys={}}return t.prototype.getLabel=function(){return""},t}();i.Keys=w;var N=function(t){function i(i,e){var s=t.call(this)||this;for(var r in i)s.keys[i[r].name]=i[r];return s}return __extends(i,t),i.prototype.updateSensor=function(t,i,e,s,r,a,n){for(var o in s.buttons={},s.buttons.any=!1,s.buttons.Reset=!1,this.keys)s.buttons[o]=!0===this.keys[o].value,s.buttons.any=s.buttons.any||this.keys[o].value},i}(w);i.EV3Keys=N;var k=function(t){function i(i,e,s){var r=t.call(this)||this;for(var a in r.color2Keys={},r.$touchLayer=$("#robotLayer"),r.isDown=!1,r.id=e,r.$touchLayer=s||r.$touchLayer,i)r.keys[i[a].port]=i[a];return i.forEach((function(t){t.touchColors.forEach((function(i){r.color2Keys[i]=[t.port]}))})),r.addMouseEvents(e),r}return __extends(i,t),i.prototype.handleMouseDown=function(t){var i=this;t&&!t.startX&&a.extendMouseEvent(t,p.SimulationRoberta.Instance.scale,this.$touchLayer);var e=t;if(this.lastMousePosition={x:e.startX,y:e.startY},void 0!==this.uCtx){var s=this.uCtx.getImageData(this.lastMousePosition.x,this.lastMousePosition.y,1,1).data;this.lastMouseColor=a.RGBAToHexA([s[0],s[1],s[2],s[3]])}this.isDown=!0;var r=this.color2Keys[this.lastMouseColor];r&&r.length>0&&(this.$touchLayer.data("hovered",!0),this.$touchLayer.css("cursor","pointer"),t.stopImmediatePropagation(),r.forEach((function(t){i.keys[t].value=!0})))},i.prototype.handleMouseMove=function(t){t&&!t.startX&&a.extendMouseEvent(t,p.SimulationRoberta.Instance.scale,this.$touchLayer);var i=t;if(this.lastMousePosition={x:i.startX,y:i.startY},void 0!==this.uCtx){var e=this.uCtx.getImageData(this.lastMousePosition.x,this.lastMousePosition.y,1,1).data;this.lastMouseColor=a.RGBAToHexA([e[0],e[1],e[2],e[3]])}var s=this.color2Keys[this.lastMouseColor];s&&s.length>0&&(this.$touchLayer.data("hovered",!0),this.$touchLayer.css("cursor","pointer"),t.stopImmediatePropagation())},i.prototype.handleMouseOutUp=function(t){for(var i in this.keys)this.keys[i].value=!1;this.isDown=!1},i.prototype.updateSensor=function(t,i,e,s,r,a,n){for(var o in void 0===this.uCtx&&(this.uCtx=r),s.buttons={},this.keys)s.buttons[o]=!0===this.keys[o].value},i.prototype.addMouseEvents=function(t){this.$touchLayer.on("mousedown.R"+t+" touchstart.R"+t,this.handleMouseDown.bind(this)),this.$touchLayer.on("mousemove.R"+t+" touchmove.R"+t,this.handleMouseMove.bind(this)),this.$touchLayer.on("mouseup.R"+t+" touchend.R"+t+" mouseout.R"+t+" touchcancel.R"+t,this.handleMouseOutUp.bind(this))},i}(w);i.TouchKeys=k;var C=function(t){function i(i,e,s,r){var a=t.call(this,i,e)||this,n=$("#mbedButtons");return a.transP=s,a.groundP=r,i.forEach((function(t){if("TOUCH"!==t.type){var i=1023;n.append('<label for="rangePin'+t.port+'" style="margin: 12px 8px 8px 0" lkey="Blockly.Msg.SENSOR_PIN">'+h.Msg.SENSOR_PIN+" "+t.name+"</label>"),"DIGITAL_PIN"===t.type&&(i=1),n.append('<input type="text" value="0" style="margin-bottom: 8px;margin-top: 12px; min-width: 45px; width: 45px; display: inline-block; border: 1px solid #333; border-radius: 2px; text-align: right; float: right; padding: 0" id="rangePin'+t.port+'" name="rangePin'+t.port+'" class="range" />'),n.append('<div style="margin:8px 0;"><input id="sliderPin'+t.port+'" type="range" min="0" max="'+i+'" value="0" step="1" /></div>'),j($("#sliderPin"+t.port),$("#rangePin"+t.port),a.keys[t.port],"typeValue",{min:0,max:i})}})),a}return __extends(i,t),i.prototype.draw=function(t,i){for(var e in this.keys){var s=this.keys[e];switch(s.type){case"TOUCH":s.value&&(t.fillStyle=s.color,t.beginPath(),t.arc(s.x,s.y,s.r,0,2*Math.PI),t.fill(),this.groundP&&(t.fillStyle="red",t.beginPath(),t.arc(this.groundP.x,this.groundP.y,25,0,2*Math.PI),t.fill()));break;case"DIGITAL_PIN":t.fillStyle=s.color,t.beginPath(),t.save();var r=s.x+this.transP.x,a=s.y+this.transP.y;t.translate(r,a),t.save(),t.rotate(Math.PI/2),t.font="bold 100px Roboto",t.fillText("< ",0,0),t.restore(),t.font="20px Courier",t.fillText("⊓",-16,16),t.fillText(s.typeValue,50,16),t.restore();break;case"ANALOG_PIN":t.fillStyle=s.color,t.beginPath(),t.save();r=s.x+this.transP.x,a=s.y+this.transP.y;t.translate(r,a),t.save(),t.rotate(Math.PI/2),t.font="bold 100px Roboto",t.fillText("< ",0,0),t.restore(),t.font="20px Courier",t.fillText("∿",-16,16),t.fillText(s.typeValue,50,16),t.restore()}}},i.prototype.updateSensor=function(t,i,e,s,r,a,n){for(var o in void 0===this.uCtx&&(this.uCtx=r),this.keys)s["pin"+o]={},s["pin"+o].pressed=!0===this.keys[o].value,s["pin"+o].analog=s["pin"+o].digital=this.keys[o].typeValue},i}(k);i.Pins=C;var U=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.draw=function(t,i){for(var e in this.keys){var s=this.keys[e];switch(s.type){case"TOUCH":s.value&&(t.fillStyle=s.color,t.beginPath(),t.fillStyle="green",t.beginPath(),t.fillRect(s.x,s.y,s.r,s.r),t.fill(),t.fillStyle="red",t.beginPath(),t.arc(this.groundP.x,this.groundP.y,36,0,2*Math.PI),t.fill());break;case"DIGITAL_PIN":t.fillStyle=s.color,t.beginPath(),t.save();var r=s.x+this.transP.x,a=s.y+this.transP.y;t.translate(r,a),t.save(),t.rotate(Math.PI/2),t.font="bold 100px Roboto",t.fillText("< ",0,0),t.restore(),t.font="20px Courier",t.fillText("⊓",-16,16),t.fillText(s.typeValue,50,16),t.restore();break;case"ANALOG_PIN":t.fillStyle=s.color,t.beginPath(),t.save();r=s.x+this.transP.x,a=s.y+this.transP.y;t.translate(r,a),t.save(),t.rotate(Math.PI/2),t.font="bold 100px Roboto",t.fillText("< ",0,0),t.restore(),t.font="20px Courier",t.fillText("∿",-16,16),t.fillText(s.typeValue,50,16),t.restore()}}},i}(C);i.MicrobitPins=U;var G=function(t){function i(i,e){return t.call(this,i,e,$("#brick"+e))||this}return __extends(i,t),i.prototype.handleMouseDown=function(t){var i=this;t&&!t.startX&&a.extendMouseEvent(t,1,this.$touchLayer);var e=t;this.lastMousePosition={x:e.startX,y:e.startY};var s=this.$touchLayer.get(0).getContext("2d").getImageData(this.lastMousePosition.x,this.lastMousePosition.y,1,1).data;this.lastMouseColor=a.RGBAToHexA([s[0],s[1],s[2],s[3]]),this.isDown=!0;var r=this.color2Keys[this.lastMouseColor];r&&r.length>0&&(this.$touchLayer.data("hovered",!0),this.$touchLayer.css("cursor","pointer"),t.stopImmediatePropagation(),r.forEach((function(t){i.keys[t].value=!0})))},i.prototype.handleMouseMove=function(t){t&&!t.startX&&a.extendMouseEvent(t,1,this.$touchLayer);var i=t;this.lastMousePosition={x:i.startX,y:i.startY};var e=this.color2Keys[this.lastMouseColor],s=this.$touchLayer.get(0).getContext("2d").getImageData(this.lastMousePosition.x,this.lastMousePosition.y,1,1).data;this.lastMouseColor=a.RGBAToHexA([s[0],s[1],s[2],s[3]]),e&&e.length>0?(this.$touchLayer.data("hovered",!0),this.$touchLayer.css("cursor","pointer"),t.stopImmediatePropagation()):this.$touchLayer.data().hovered?this.$touchLayer.data("hovered",!1):this.$touchLayer.css("cursor","move")},i.prototype.updateSensor=function(t,i,e,s,r,a,n){for(var o in s.buttons={},this.keys)s.buttons[o]=!0===this.keys[o].value},i}(k);i.MbotButton=G;var F=function(){function t(){this.gesture={up:!0},this.labelPriority=10,$("#mbedButtons").append('<label style="margin: 12px 8px 8px 0" lkey="Blockly.Msg.SENSOR_GESTURE">'+h.Msg.SENSOR_GESTURE+'</label><label class="btn simbtn active" lkey="Blockly.Msg.SENSOR_GESTURE_UP"><input type="radio" id="up" name="options" autocomplete="off">'+h.Msg.SENSOR_GESTURE_UP+'</label><label class="btn simbtn" lkey="Blockly.Msg.SENSOR_GESTURE_DOWN"><input type="radio" id="down" name="options" autocomplete="off" >'+h.Msg.SENSOR_GESTURE_DOWN+'</label><label class="btn simbtn" lkey="Blockly.Msg.SENSOR_GESTURE_FACE_DOWN"><input type="radio" id="face_down" name="options" autocomplete="off" >'+h.Msg.SENSOR_GESTURE_FACE_DOWN+'</label><label class="btn simbtn" lkey="Blockly.Msg.SENSOR_GESTURE_FACE_UP"><input type="radio" id="face_up" name="options" autocomplete="off" >'+h.Msg.SENSOR_GESTURE_FACE_UP+'</label><label class="btn simbtn" lkey="Blockly.Msg.SENSOR_GESTURE_SHAKE"><input type="radio" id="shake" name="options" autocomplete="off" >'+h.Msg.SENSOR_GESTURE_SHAKE+'</label><label class="btn simbtn" lkey="Blockly.Msg.SENSOR_GESTURE_FREEFALL"><input type="radio" id="freefall" name="options" autocomplete="off" >'+h.Msg.SENSOR_GESTURE_FREEFALL+"</label>");var t=this;$('input[name="options"]').on("change",(function(i){t.gesture={},t.gesture[i.currentTarget.id]=!0}))}return t.prototype.getLabel=function(){return"<div><label>"+h.Msg.SENSOR_GESTURE+"</label><span>"+h.Msg["SENSOR_GESTURE_"+Object.getOwnPropertyNames(this.gesture)[0].toUpperCase()]+"</span></div>"},t.prototype.updateSensor=function(t,i,e,s,r,a,n){s.gesture={};var o=Object.getOwnPropertyNames(this.gesture)[0];s.gesture[o]=this.gesture[o]},t}();i.GestureSensor=F;var V=function(){function t(){this.degree=0,this.labelPriority=11,$("#mbedButtons").append('<div><label for="rangeCompass" lkey="Blockly.Msg.SENSOR_COMPASS" style="margin: 12px 8px 8px 0">'+h.Msg.SENSOR_COMPASS+'</label><input class="range" id="rangeCompass" name="rangeCompass" style="margin-bottom: 8px;margin-top: 12px; min-width: 45px; width: 45px; display: inline-block; border: 1px solid #333; border-radius: 2px; text-align: right; float: right; padding: 0" type="text" value="0" /></div><div style="margin:8px 0; "><input id="sliderCompass" max="360" min="0" step="5" type="range" value="0" /></div>'),j($("#sliderCompass"),$("#rangeCompass"),this,"degree",{min:0,max:360})}return t.prototype.getLabel=function(){return"<div><label>"+h.Msg.SENSOR_COMPASS+"</label><span>"+this.degree+" °</span></div>"},t.prototype.updateSensor=function(t,i,e,s,r,a,n){s.compass={},s.compass.angle=this.degree},t}();i.CompassSensor=V;var H=function(){function t(){this.dx=60,this.dy=60,this.lightLevel=0,this.x=342,this.y=546,this.labelPriority=12,$("#mbedButtons").append('<div><label for="rangeLight" style="margin: 12px 8px 8px 0" lkey="Blockly.Msg.SENSOR_LIGHT">'+h.Msg.SENSOR_LIGHT+'</label><input type="text" value="0" style="margin-bottom: 8px;margin-top: 12px; min-width: 45px; width: 45px; display: inline-block; border: 1px solid #333; border-radius: 2px; text-align: right; float: right; padding: 0;" id="rangeLight" name="rangeLight" class="range" /></div><div style="margin:8px 0; "><input id="sliderLight" type="range" min="0" max="100" value="0" /></div>'),j($("#sliderLight"),$("#rangeLight"),this,"lightLevel",{min:0,max:100})}return t.prototype.draw=function(t,i){t.save(),t.beginPath(),t.fillStyle="#ffffff",t.globalAlpha=this.lightLevel/500,t.rect(this.x-this.dx/2,this.y+this.dy/2,5*this.dx,-5*this.dy),t.fill(),t.globalAlpha=1,t.restore()},t.prototype.getLabel=function(){return"<div><label>"+h.Msg.SENSOR_LIGHT+"</label><span>"+this.lightLevel+" %</span></div>"},t.prototype.updateSensor=function(t,i,e,s,r,a,n){s.light={},s.light.ambientlight=this.lightLevel},t}();i.CalliopeLightSensor=H;var X=function(){function t(){this.dx=60,this.dy=60,this.lightLevel=0,this.x=342,this.y=546,this.labelPriority=12,$("#mbedButtons").append('<div><label for="rangeLight" style="margin: 12px 8px 8px 0" lkey="Blockly.Msg.SENSOR_INFRARED">'+h.Msg.SENSOR_INFRARED+'</label><input type="text" value="0" style="margin-bottom: 8px;margin-top: 12px; min-width: 45px; width: 45px; display: inline-block; border: 1px solid #333; border-radius: 2px; text-align: right; float: right; padding: 0;" id="rangeLight" name="rangeLight" class="range" /></div><div style="margin:8px 0; "><input id="sliderLight" type="range" min="0" max="1023" value="0" /></div>'),j($("#sliderLight"),$("#rangeLight"),this,"lightLevel",{min:0,max:1023})}return t.prototype.getLabel=function(){return"<div><label>"+h.Msg.SENSOR_INFRARED+"</label><span>"+this.lightLevel+"</span></div>"},t.prototype.updateSensor=function(t,i,e,s,r,a,n){s.light={},s.light.ambientlight=this.lightLevel,s.light.reflected=this.lightLevel},t}();i.Rob3rtaInfraredSensor=X;var K=function(){function t(){this.degree=20,this.labelPriority=13,$("#mbedButtons").append('<div><label for="rangeTemperature" style="margin: 12px 8px 8px 0" lkey="Blockly.Msg.SENSOR_TEMPERATURE">'+h.Msg.SENSOR_TEMPERATURE+'</label><input type="text" value="0" style="margin-bottom: 8px;margin-top: 12px; min-width: 45px; width: 45px; display: inline-block; border: 1px solid #333; border-radius: 2px; text-align: right; float: right; padding: 0;" id="rangeTemperature" name="rangeTemperature" class="range" /></div><div style="margin:8px 0; "><input id="sliderTemperature" type="range" min="-25" max="75" value="0" step="1" /></div>'),j($("#sliderTemperature"),$("#rangeTemperature"),this,"degree",{min:-15,max:75})}return t.prototype.getLabel=function(){return"<div><label>"+h.Msg.SENSOR_TEMPERATURE+"</label><span>"+this.degree+" °</span></div>"},t.prototype.updateSensor=function(t,i,e,s,r,a,n){s.temperature={},s.temperature.value=this.degree},t}();i.TemperatureSensor=K;var q=function(){function t(t){this.labelPriority=16,this.volume=0,void 0===window.navigator.mediaDevices&&(window.navigator.mediaDevices={}),this.webAudio=t.webAudio,window.navigator.mediaDevices.getUserMedia=navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var i=this;try{navigator.mediaDevices.getUserMedia({audio:{mandatory:{googEchoCancellation:"false",googAutoGainControl:"false",googNoiseSuppression:"false",googHighpassFilter:"false"},optional:[]}}).then((function(t){var e=i.webAudio.context.createMediaStreamSource(t);i.sound=l.createAudioMeter(i.webAudio.context),e.connect(i.sound)}),(function(){console.log("Sorry, but there is no microphone available on your system")}))}catch(t){console.log("Sorry, but there is no microphone available on your system")}}return t.prototype.getLabel=function(){return"<div><label>"+h.Msg.SENSOR_SOUND+"</label><span>"+a.round(this.volume,0)+" %</span></div>"},t.prototype.updateSensor=function(t,i,e,s,r,n,o){this.volume=this.sound?a.round(100*this.sound.volume,0):0,s.sound={},s.sound.volume=this.volume},t}();i.VolumeMeterSensor=q;var Y=function(t){function i(i,e){var s=t.call(this,i)||this;return s.theta=0,s.x=0,s.y=0,s.port=e,s.labelPriority=Number(s.port.replace("ORT_","")),s}return __extends(i,t),i.prototype.getLabel=function(){return"<div><label>"+this.port.replace("ORT_","")+" "+h.Msg.SENSOR_SOUND+"</label><span>"+a.round(this.volume,0)+" %</span></div>"},i.prototype.updateSensor=function(t,i,e,s,r,n,o){this.volume=this.sound?a.round(100*this.sound.volume,0):0,s.sound={},s.sound[this.port]={},s.sound[this.port].volume=this.volume},i}(q);i.SoundSensor=Y;var W=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.getLabel=function(){return"<div><label>"+h.Msg.SENSOR_SOUND+"</label><span>"+(this.volume>25?"true":"false")+"</span></div>"},i.prototype.updateSensor=function(i,e,s,r,a,n,o){t.prototype.updateSensor.call(this,i,e,s,r,a,n,o),r.sound.volume=this.volume>25},i}(q);function j(t,i,e,s,r){t.on("mousedown touchstart",(function(t){t.stopPropagation()})),t.on("input change",(function(r){r.preventDefault(),i.val(t.val()),e[s]=Number(t.val()),r.stopPropagation()})),i.on("change",(function(a){a.preventDefault();var n=Number(i.val());i.valid()?(n<r.min?n=r.min:n>r.max&&(n=r.max),i.val(n),t.val(n),e[s]=n):i.val(t.val()),a.stopPropagation()})),i.val(e[s]),t.val(e[s]),$("#mbed-form").validate(),i.rules("add",{messages:{required:!1,number:!1}})}i.SoundSensorBoolean=W;var Q=function(){function t(){this.x=0,this.y=0,this.theta=0,this.labelPriority=7}return t.prototype.getLabel=function(){var t="<div><label>"+h.Msg.SENSOR_ODOMETRY+"</label></div>";return t+="<div><label>&nbsp;-&nbsp;x</label><span>"+a.round(this.x,1)+" cm</span></div>",t+="<div><label>&nbsp;-&nbsp;y</label><span>"+a.round(this.y,1)+" cm</span></div>",t+="<div><label>&nbsp;-&nbsp;θ</label><span>"+a.round(this.theta,0)+" °</span></div>"},t.prototype.reset=function(){this.x=0,this.y=0,this.theta=0},t.prototype.updateSensor=function(t,i,e,a,n,o,h){a.odometry=a.odometry||{},this.theta+=r.toDegree(e.thetaDiff),a.odometry[s.THETA]=this.theta,this.x+=e.chassis.xDiff/3,a.odometry[s.X]=this.x,this.y+=e.chassis.yDiff/3,a.odometry[s.Y]=this.y},t.prototype.updateAction=function(t,i,e){if(e){var r=t.interpreter.getRobotBehaviour().getActionState("odometry",!0);if(r&&r.reset)switch(r.reset){case s.X:this.x=0;break;case s.Y:this.y=0;break;case s.THETA:this.theta=0;break;case"all":this.reset()}}},t}();i.OdometrySensor=Q;var z=function(){function t(t,i){this.MAX_MARKER_DIST_SQR=202500,this.MAX_CAM_Y=Math.sqrt(this.MAX_MARKER_DIST_SQR),this.MAX_BLOB_DIST_SQR=this.MAX_MARKER_DIST_SQR,this.LINE_RADIUS=60,this.markerEnabled=!0,this.lineEnabled=!0,this.colorEnabled=!0,this.AOV=2*Math.PI/5,this.listOfMarkersFound=[],this.bB={x:0,y:0,w:0,h:0},this.labelPriority=8,this.THRESHOLD=126,this.drawPriority=1,this.x=t.x,this.y=t.y,this.theta=t.theta,this.AOV=i}return t.prototype.updateAction=function(t,i,e){if(e){var s=t.interpreter.getRobotBehaviour().getActionState("colourBlob",!0);s&&(this.colourBlob=s)}this.colourBlob={minHue:0,maxHue:240,minSat:90,maxSat:110,minVal:90,maxVal:110}},t.prototype.draw=function(t,i){t.save(),t.beginPath(),t.strokeStyle="#0000ff",t.beginPath(),t.arc(this.x,this.y,this.MAX_CAM_Y,Math.PI/5,-Math.PI/5,!0),t.arc(this.x,this.y,this.LINE_RADIUS,-Math.PI/5,+Math.PI/5,!1),t.closePath(),t.stroke(),t.restore()},t.prototype.getLabel=function(){var t="";if(this.lineEnabled&&(t+="<div><label>Line Sensor</label><span>"+a.round(this.line,2)+"</span></div>"),this.markerEnabled){t+="<div><label>Marker Sensor</label></div>";for(var i=0;i<this.listOfMarkersFound.length;i++){var e=this.listOfMarkersFound[i];t+="<div><label>&nbsp;-&nbsp;id ",t+=e.markerId,t+="</label><span>[",t+=a.round(e.xDist,0),t+=", ",t+=a.round(e.yDist,0),t+=", ",t+=a.round(e.zDist,0),t+="] cm</span></div>"}}return t},t.prototype.reset=function(){},t.prototype.updateSensor=function(t,i,a,n,o,h,l,p){var d=this,u=a;r.transform(u.pose,this);var c=new e.Pose(this.rx,this.ry,this.theta),y=(a.pose.theta-this.AOV/2+2*Math.PI)%(2*Math.PI),b=(a.pose.theta+this.AOV/2+2*Math.PI)%(2*Math.PI);if(this.markerEnabled){this.listOfMarkersFound=[],p.filter((function(t){if(t.sqrDist=r.getDistance(c,t),t.sqrDist<=d.MAX_MARKER_DIST_SQR){for(var i=[{x:t.x-c.x,y:t.y-c.y},{x:t.x+t.w-c.x,y:t.y-c.y},{x:t.x+t.w-c.x,y:t.y+t.h-c.y},{x:t.x-c.x,y:t.y+t.h-c.y}],e=!0,s=0;s<i.length;s++){var a=(Math.atan2(i[s].y,i[s].x)+2*Math.PI)%(2*Math.PI);if(y<b&&a>y&&a<b||y>b&&(a>y||a<b))d.checkVisibility(u.id,t,l)&&(e=!1);else e=!1}return e}})).forEach((function(t){var i=(Math.atan2(t.y+t.h/2-c.y,t.x+t.w/2-c.x)+2*Math.PI)%(2*Math.PI),e=b;y>e&&(e+=2*Math.PI,i<y&&(i+=2*Math.PI));var s=Math.sqrt(t.sqrDist);t.xDist=((i-y)/(e-y)-.5)*d.AOV*s/3,t.yDist=(s/d.MAX_CAM_Y-.5)*d.MAX_CAM_Y/3,t.zDist=s/3,d.listOfMarkersFound.push(t)})),n.marker={},n.marker[s.INFO]={};for(var f=0;f<16;f++)n.marker[s.INFO][f]=[-1,-1,0];0==this.listOfMarkersFound.length?n.marker[s.ID]=[-1]:(n.marker[s.ID]=this.listOfMarkersFound.map((function(t){return t.markerId})),this.listOfMarkersFound.forEach((function(t){n.marker[s.INFO][t.markerId]=[t.xDist,t.yDist,t.zDist]})))}if(this.lineEnabled){this.line=-1;var x={x:this.LINE_RADIUS*Math.cos(y),y:this.LINE_RADIUS*Math.sin(y)},g={x:this.LINE_RADIUS*Math.cos(b),y:this.LINE_RADIUS*Math.sin(b)},v=Math.atan2(x.y,x.x),M=Math.atan2(g.y,g.x),m=Math.abs(g.y-x.y),S=Math.abs(g.x-x.x),I=void 0;if(this.bB={h:0,w:0,x:0,y:0},m>S)if(x.x>0){this.bB.x=Math.min(x.x,g.x)+this.rx,this.bB.y=Math.min(x.y,g.y)+this.ry,this.bB.w=Math.max(Math.max(x.x,g.x),this.LINE_RADIUS)+this.rx-this.bB.x+1,this.bB.h=-this.bB.y+Math.max(Math.max(x.y,g.y))+this.ry+1,this.constrainBB(o);var B=this.bB&&o.getImageData(this.bB.x,this.bB.y,this.bB.w,this.bB.h),E=this.bB&&h.getImageData(this.bB.x,this.bB.y,this.bB.w,this.bB.h);if(B)for(f=0;f<B.height;f++){var P=this.LINE_RADIUS*this.LINE_RADIUS-(f+this.bB.y-this.ry)*(f+this.bB.y-this.ry),_=4*((L=Math.round(Math.sqrt(P)-(this.bB.x-this.rx)))+f*B.width);if((A=(D=this.getPixelData(E,_,B,I)).redPix)!==(I=D.redPixOld)){var R=Math.atan2(f+this.bB.y-this.ry,L+this.bB.x-this.rx);this.line=(R-v)/(M-v)-.5;break}I=A}}else{this.bB.y=Math.min(x.y,g.y)+this.ry-1,this.bB.x=Math.min(Math.min(x.x,g.x),-this.LINE_RADIUS)+this.rx-1,this.bB.w=Math.max(x.x,g.x)+this.rx-this.bB.x,this.bB.h=-this.bB.y+Math.max(Math.max(x.y,g.y))+this.ry,this.constrainBB(o);B=this.bB&&o.getImageData(this.bB.x,this.bB.y,this.bB.w,this.bB.h),E=this.bB&&h.getImageData(this.bB.x,this.bB.y,this.bB.w,this.bB.h);if(B)for(f=B.height-1;f>0;f--){var L;P=this.LINE_RADIUS*this.LINE_RADIUS-(f+this.bB.y-this.ry)*(f+this.bB.y-this.ry),_=4*((L=Math.round(-Math.sqrt(P)-(this.bB.x-this.rx)))+f*B.width)-4;if((A=(D=this.getPixelData(E,_,B,I)).redPix)!==(I=D.redPixOld)){(R=Math.atan2(f+this.bB.y-this.ry,L+this.bB.x-this.rx))<=0&&(R+=2*Math.PI),v<=0&&(v+=2*Math.PI),M<=0&&(M+=2*Math.PI),this.line=(R-v)/(M-v)-.5;break}I=A}}else if(x.y<0){this.bB.x=Math.min(Math.min(x.x,g.x),this.LINE_RADIUS)+this.rx,this.bB.w=Math.max(x.x,g.x)+this.rx-this.bB.x+1,this.bB.y=Math.min(Math.min(x.y,g.y),-this.LINE_RADIUS)+this.ry,this.bB.h=Math.max(x.y,g.y)+this.ry-this.bB.y+1,this.constrainBB(o);B=this.bB&&o.getImageData(this.bB.x,this.bB.y,this.bB.w+1,this.bB.h+1),E=this.bB&&h.getImageData(this.bB.x,this.bB.y,this.bB.w+1,this.bB.h+1);if(B)for(f=0;f<B.width-1;f++){P=this.LINE_RADIUS*this.LINE_RADIUS-(f+this.bB.x-this.rx)*(f+this.bB.x-this.rx),_=4*(f+(O=Math.round(-Math.sqrt(P)-this.bB.y+this.ry))*B.width);if((A=(D=this.getPixelData(E,_,B,I)).redPix)!==(I=D.redPixOld)){R=Math.atan2(O+this.bB.y-this.ry,f+this.bB.x-this.rx);this.line=-1*((R-M)/(v-M)-.5);break}I=A}}else{this.bB.x=Math.min(Math.min(x.x,g.x),this.LINE_RADIUS)+this.rx,this.bB.w=Math.max(x.x,g.x)+this.rx-this.bB.x+1,this.bB.y=Math.min(x.y,g.y)+this.ry,this.bB.h=Math.max(Math.max(x.y,g.y),this.LINE_RADIUS)+this.ry-this.bB.y+1,this.constrainBB(o);B=this.bB&&o.getImageData(this.bB.x,this.bB.y,this.bB.w,this.bB.h),E=this.bB&&h.getImageData(this.bB.x,this.bB.y,this.bB.w,this.bB.h);if(B)for(f=B.width-1;f>=0;f--){var O,D,A;P=this.LINE_RADIUS*this.LINE_RADIUS-(f+this.bB.x-this.rx)*(f+this.bB.x-this.rx),_=4*(f+(O=Math.round(Math.sqrt(P)-this.bB.y+this.ry)-1)*B.width)-4;if((A=(D=this.getPixelData(E,_,B,I)).redPix)!==(I=D.redPixOld)){R=Math.atan2(O+this.bB.y-this.ry,f+this.bB.x-this.rx);this.line=(R-v)/(M-v)-.5;break}I=A}}n.camera={},n.camera[s.LINE]=this.line}},t.prototype.getPixelData=function(t,i,e,s){if(255===t.data[i+3])for(var r=i;r<i+3;r++)e.data[r]=t.data[r];var a=this.calculatePix(Array.prototype.slice.call(e.data.slice(i,i+3)));return null==s&&(s=a),{redPix:a,redPixOld:s}},t.prototype.calculatePix=function(t){return.299*t[0]+.587*t[1]+.114*t[2]>this.THRESHOLD?255:0},t.prototype.checkVisibility=function(t,i,e){for(var s,a={x1:this.rx,y1:this.ry,x2:i.x,y2:i.y},h=0;h<e.length-1;h++){var l=e[h];if(!(l instanceof n.ChassisMobile&&l.id==t)&&l!==i)if(l instanceof o.CircleSimulationObject){var p=l;if(s=r.getClosestIntersectionPointCircle(a,p))return s}else for(var d=l.getLines(),u=0;u<d.length;u++)if(s=r.getIntersectionPoint(a,d[u]))return s}return null},t.prototype.checkHSVRange=function(t){return!!(this.colourBlob&&t&&t[0]>=this.colourBlob.minHue&&t[0]<=this.colourBlob.maxHue&&t[1]>=this.colourBlob.minSat&&t[1]<=this.colourBlob.maxSat&&t[2]>=this.colourBlob.minVal&&t[2]<=this.colourBlob.maxVal)},t.prototype.constrainBB=function(t){this.bB.x=this.bB.x<0?0:this.bB.x,this.bB.y=this.bB.y<0?0:this.bB.y,(this.bB.x+this.bB.w>t.canvas.width&&(this.bB.w=t.canvas.width-this.bB.x,this.bB.w<1)||this.bB.y+this.bB.h>t.canvas.height&&(this.bB.h=t.canvas.width-this.bB.y,this.bB.h<1))&&(this.bB=null)},t}();i.CameraSensor=z;var Z=function(t){function i(i,e,s){var r=t.call(this,i,e)||this;return r.MAX_CAM_Y=150,r.MAX_BLOB_DIST_SQR=r.MAX_MARKER_DIST_SQR,r.LINE_RADIUS=45,r.THRESHOLD=175,r.p={x:0,y:0,rx:0,ry:0},r.rect={p1:r.p,p2:r.p,p3:r.p,p4:r.p},r.BLOBSIZE=s,r}return __extends(i,t),i.prototype.draw=function(i,e){t.prototype.draw.call(this,i,e),i.save(),i.rotate(-e.pose.theta),i.translate(-e.pose.x,-e.pose.y),i.beginPath(),i.strokeStyle="#00ffff",i.moveTo(this.rect.p1.rx,this.rect.p1.ry),i.lineTo(this.rect.p2.rx,this.rect.p2.ry),i.lineTo(this.rect.p3.rx,this.rect.p3.ry),i.lineTo(this.rect.p4.rx,this.rect.p4.ry),i.lineTo(this.rect.p1.rx,this.rect.p1.ry),i.stroke(),i.restore()},i.prototype.updateSensor=function(t,i,a,n,o,h,l,d){var u=a;r.transform(u.pose,this);new e.Pose(this.rx,this.ry,this.theta);var c=(a.pose.theta-this.AOV/2+2*Math.PI)%(2*Math.PI),y=(a.pose.theta+this.AOV/2+2*Math.PI)%(2*Math.PI);if(n[s.CAMERA]={},this.lineEnabled){var b=function(t,i,e){this.line=100*(t+i),this.lineWidth=Math.abs(Math.round(100*(t-i)));var s=[0,0,0];e.forEach((function(t){s[0]+=t[0],s[1]+=t[1],s[2]+=t[2]})),this.lineColor=[Math.round(s[0]/e.length),Math.round(s[1]/e.length),Math.round(s[2]/e.length)]};this.line=-1,this.lineWidth=0,this.lineColor=[];var f={x:this.LINE_RADIUS*Math.cos(c),y:this.LINE_RADIUS*Math.sin(c)},x={x:this.LINE_RADIUS*Math.cos(y),y:this.LINE_RADIUS*Math.sin(y)},g=Math.atan2(f.y,f.x),v=Math.atan2(x.y,x.x),M=Math.abs(x.y-f.y),m=Math.abs(x.x-f.x),S=void 0,I=void 0,B=void 0,E=[];if(this.bB={h:0,w:0,x:0,y:0},M>m)if(f.x>0){this.bB.x=Math.min(f.x,x.x)+this.rx,this.bB.y=Math.min(f.y,x.y)+this.ry,this.bB.w=Math.max(Math.max(f.x,x.x),this.LINE_RADIUS)+this.rx-this.bB.x+1,this.bB.h=-this.bB.y+Math.max(Math.max(f.y,x.y))+this.ry+1,this.constrainBB(o);var P=this.bB&&o.getImageData(this.bB.x,this.bB.y,this.bB.w,this.bB.h),_=this.bB&&h.getImageData(this.bB.x,this.bB.y,this.bB.w,this.bB.h);if(P)for(var R=0;R<P.height;R++){var L=this.LINE_RADIUS*this.LINE_RADIUS-(R+this.bB.y-this.ry)*(R+this.bB.y-this.ry),O=4*((A=Math.round(Math.sqrt(L)-(this.bB.x-this.rx)))+R*P.width);if((N=(w=this.getPixelData(_,O,P,S)).redPix)!==(S=w.redPixOld)){var D=Math.atan2(R+this.bB.y-this.ry,A+this.bB.x-this.rx);if(void 0===I)I=(D-g)/(v-g)-.5;else if(void 0===B){b.call(this,I,B=(D-g)/(v-g)-.5,E);break}void 0!==I&&E.push(w.pixColor)}S=N}}else{this.bB.y=Math.min(f.y,x.y)+this.ry-1,this.bB.x=Math.min(Math.min(f.x,x.x),-this.LINE_RADIUS)+this.rx-1,this.bB.w=Math.max(f.x,x.x)+this.rx-this.bB.x,this.bB.h=-this.bB.y+Math.max(Math.max(f.y,x.y))+this.ry,this.constrainBB(o);P=this.bB&&o.getImageData(this.bB.x,this.bB.y,this.bB.w,this.bB.h),_=this.bB&&h.getImageData(this.bB.x,this.bB.y,this.bB.w,this.bB.h);if(P)for(R=P.height-1;R>0;R--){var A;L=this.LINE_RADIUS*this.LINE_RADIUS-(R+this.bB.y-this.ry)*(R+this.bB.y-this.ry),O=4*((A=Math.round(-Math.sqrt(L)-(this.bB.x-this.rx)))+R*P.width)-4;if((N=(w=this.getPixelData(_,O,P,S)).redPix)!==(S=w.redPixOld))if((D=Math.atan2(R+this.bB.y-this.ry,A+this.bB.x-this.rx))<=0&&(D+=2*Math.PI),g<=0&&(g+=2*Math.PI),v<=0&&(v+=2*Math.PI),null==I)I=(D-g)/(v-g)-.5;else if(null==B){b.call(this,I,B=(D-g)/(v-g)-.5,E);break}void 0!==I&&E.push(w.pixColor),S=N}}else if(f.y<0){this.bB.x=Math.min(Math.min(f.x,x.x),this.LINE_RADIUS)+this.rx,this.bB.w=Math.max(f.x,x.x)+this.rx-this.bB.x+1,this.bB.y=Math.min(Math.min(f.y,x.y),-this.LINE_RADIUS)+this.ry,this.bB.h=Math.max(f.y,x.y)+this.ry-this.bB.y+1,this.constrainBB(o);P=this.bB&&o.getImageData(this.bB.x,this.bB.y,this.bB.w+1,this.bB.h+1),_=this.bB&&h.getImageData(this.bB.x,this.bB.y,this.bB.w+1,this.bB.h+1);if(P)for(R=0;R<P.width-1;R++){L=this.LINE_RADIUS*this.LINE_RADIUS-(R+this.bB.x-this.rx)*(R+this.bB.x-this.rx),O=4*(R+(T=Math.round(-Math.sqrt(L)-this.bB.y+this.ry))*P.width);if((N=(w=this.getPixelData(_,O,P,S)).redPix)!==(S=w.redPixOld)){D=Math.atan2(T+this.bB.y-this.ry,R+this.bB.x-this.rx);if(null==I)I=-1*((D-v)/(g-v)-.5);else if(null==B){b.call(this,I,B=-1*((D-v)/(g-v)-.5),E);break}}void 0!==I&&E.push(w.pixColor),S=N}}else{this.bB.x=Math.min(Math.min(f.x,x.x),this.LINE_RADIUS)+this.rx,this.bB.w=Math.max(f.x,x.x)+this.rx-this.bB.x+1,this.bB.y=Math.min(f.y,x.y)+this.ry,this.bB.h=Math.max(Math.max(f.y,x.y),this.LINE_RADIUS)+this.ry-this.bB.y+1,this.constrainBB(o);P=this.bB&&o.getImageData(this.bB.x,this.bB.y,this.bB.w,this.bB.h),_=this.bB&&h.getImageData(this.bB.x,this.bB.y,this.bB.w,this.bB.h);if(P)for(R=P.width-1;R>0;R--){var T,w,N;L=this.LINE_RADIUS*this.LINE_RADIUS-(R+this.bB.x-this.rx)*(R+this.bB.x-this.rx),O=4*(R+(T=Math.round(Math.sqrt(L)-this.bB.y+this.ry)-1)*P.width)-4;if((N=(w=this.getPixelData(_,O,P,S)).redPix)!==(S=w.redPixOld)){D=Math.atan2(T+this.bB.y-this.ry,R+this.bB.x-this.rx);if(null==I)I=(D-g)/(v-g)-.5;else if(null==B){b.call(this,I,B=(D-g)/(v-g)-.5,E);break}}void 0!==I&&E.push(w.pixColor),S=N}}n[s.CAMERA][s.LINE]={},n[s.CAMERA][s.LINE][s.INFO]=[this.line,this.lineWidth],n[s.CAMERA][s.LINE][s.COLOR]=this.lineColor,n[s.CAMERA][s.LINE][s.NUMBER]=0===this.lineWidth?0:1}if(this.colorEnabled){this.color=[];var k=this.AOV*this.BLOBSIZE/100;c=(-k/2+2*Math.PI)%(2*Math.PI),y=(k/2+2*Math.PI)%(2*Math.PI);var C=this.LINE_RADIUS+(this.MAX_CAM_Y-this.LINE_RADIUS)*(100-this.BLOBSIZE)/200,U=C+(this.MAX_CAM_Y-this.LINE_RADIUS)*this.BLOBSIZE/100,G=(f={x:C*Math.cos(c),y:C*Math.sin(c)},x={x:C*Math.cos(y),y:C*Math.sin(y)},{x:U*Math.cos(c),y:U*Math.sin(c)}),F={x:U*Math.cos(y),y:U*Math.sin(y)};this.bB={h:0,w:0,x:0,y:0};var V={x:f.x,y:f.y,rx:0,ry:0};r.transform(u.pose,V),this.rect.p1=V,V={x:G.x,y:G.y,rx:0,ry:0},r.transform(u.pose,V),this.rect.p2=V,V={x:F.x,y:F.y,rx:0,ry:0},r.transform(u.pose,V),this.rect.p3=V,V={x:x.x,y:x.y,rx:0,ry:0},r.transform(u.pose,V),this.rect.p4=V,this.bB.x=Math.min(this.rect.p1.rx,this.rect.p2.rx,this.rect.p3.rx,this.rect.p4.rx),this.bB.y=Math.min(this.rect.p1.ry,this.rect.p2.ry,this.rect.p3.ry,this.rect.p4.ry),this.bB.w=Math.max(this.rect.p1.rx,this.rect.p2.rx,this.rect.p3.rx,this.rect.p4.rx)-this.bB.x,this.bB.h=Math.max(this.rect.p1.ry,this.rect.p2.ry,this.rect.p3.ry,this.rect.p4.ry)-this.bB.y,this.constrainBB(o);P=this.bB&&o.getImageData(this.bB.x,this.bB.y,this.bB.w,this.bB.h),_=this.bB&&h.getImageData(this.bB.x,this.bB.y,this.bB.w,this.bB.h);var H=$("#objectLayer")[0].getContext("2d",{willReadFrequently:!0});H.restore(),H.save();var X=p.SimulationRoberta.Instance.scale,K=void 0;try{K=this.bB&&H.getImageData(Math.round(this.bB.x*X),Math.round(this.bB.y*X),Math.round(this.bB.w*X),Math.round(this.bB.h*X))}catch(t){}var q=0,Y=0,W=0,j=K?K.data.length/P.data.length:0;if(P){for(R=0;R<P.data.length;R+=4){var Q=4*Math.floor(R*j/4);K&&255===K.data[Q+3]?(q+=K.data[Q],Y+=K.data[Q+1],W+=K.data[Q+2]):255===_.data[R+3]?(q+=_.data[R],Y+=_.data[R+1],W+=_.data[R+2]):(q+=P.data[R],Y+=P.data[R+1],W+=P.data[R+2])}var z=P.data.length/4;q/=z,Y/=z,W/=z,this.color=[Math.round(q),Math.round(Y),Math.round(W)],n[s.CAMERA][s.COLOR]=this.color}}},i.prototype.getLabel=function(){var t="";return this.lineEnabled&&(t+="<div><label>"+h.Msg.SENSOR_CAMERA+" "+h.Msg.MODE_LINE+"</label></div><div><label>&nbsp;-&nbsp;"+h.Msg.MODE_LINE+"</label><span>"+a.round(this.line,0)+"</span></div><div><label>&nbsp;-&nbsp;Breite</label><span>"+this.lineWidth+"</span></div><div><label>&nbsp;-&nbsp;"+h.Msg.MODE_COLOUR+'</label><span style="margin-left:6px; width: 20px; border-style:solid; border-width:thin; background-color:'+(this.lineColor.length>0?r.rgbToHex(this.lineColor[0],this.lineColor[1],this.lineColor[2]):"#fff")+'">&nbsp;</span></div><div><label>'+h.Msg.SENSOR_CAMERA+" "+h.Msg.MODE_COLOUR+'</label><span style="margin-left:6px; width: 20px; border-style:solid; border-width:thin; background-color:'+(this.color.length>0?r.rgbToHex(this.color[0],this.color[1],this.color[2]):"#fff")+'">&nbsp;</span></div>'),t},i.prototype.getPixelData=function(t,i,e,s){if(255===t.data[i+3])for(var r=i;r<i+3;r++)e.data[r]=t.data[r];var a=Array.prototype.slice.call(e.data.slice(i,i+3)),n=this.calculatePix(a);return null==s&&(s=n),{redPix:n,redPixOld:s,pixColor:a}},i}(z);i.Txt4CameraSensor=Z}));
//# sourceMappingURL=robot.sensors.js.map
//# sourceMappingURL=robot.sensors.js.map
