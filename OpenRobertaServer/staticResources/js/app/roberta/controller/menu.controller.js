define(["require","exports","message","comm","wrap","user.controller","notification.controller","guiState.controller","program.controller","progRun.controller","configuration.controller","import.controller","tour.controller","sourceCodeEditor.controller","progTutorial.controller","util.roberta","connection.controller","blockly"],(function(e,o,t,n,a,r,i,l,c,s,u,d,g,m,h,p,f,b){Object.defineProperty(o,"__esModule",{value:!0}),o.init=void 0;var v,w=0,k="?",P="&",S="=",y="forgotPassword",L="activateAccount",W="loadSystem",O="tutorial",R="gallery",_="tour",T="kiosk",I="exampleView",E="loadProgram",M="extensions";function C(e){var o,t=decodeURIComponent(document.location.toString()),n=t.indexOf("?"),a=t=t.substring(n+1),r=a.indexOf("<");r>=0&&(a=t.substring(0,r),o=t.substring(r));for(var i,l=a.split(P),c=0;c<l.length;c++)if((i=l[c].split(S))[0]===e)return void 0===i[1]?void 0:"loadProgram"===i[0]?o:i[1]}function A(){null!=f.getConnectionInstance()&&f.getConnectionInstance().terminate(),$(".fromRight.rightActive").length>0?$("#blocklyDiv").closeRightView((function(){return p.closeSimRobotWindow(),$("#tabStart").tabWrapShow()})):$("#tabStart").tabWrapShow()}o.init=function(e){e&&e instanceof Function?(v=e,function(){$(".navbar-collapse a:not(.dropdown-toggle)").onWrap("click",(function(){$(".dropdown-menu.show").collapse("hide"),$(".navbar-collapse.show").collapse("hide")})),navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i)||($('[rel="tooltip"]').not(".rightMenuButton").tooltip({container:"body",placement:"right",trigger:"hover"}),$('[rel="tooltip"].rightMenuButton').tooltip({container:"body",placement:"left",trigger:"hover"}));if(document.addEventListener("gesturestart",(function(e){e.preventDefault(),e.stopPropagation()})),$(".blocklyButtonBack, .blocklyWidgetDiv, #head-navigation, #main-section, #tutorial-navigation").on("mousedown touchstart keydown",(function(e){if($(e.target).not(".blocklyTreeLabel, .blocklytreerow, .toolboxicon, .goog-palette-colorswatch, .goog-menu-vertical, .goog-menuitem-checkbox, div.goog-menuitem-content, div.goog-menuitem, img").length>0){if($(e.target).filter(".blocklyHtmlInput").length>0&&!e.metaKey)return;b&&b.getMainWorkspace()&&b.hideChaff()}})),$(".modal").onWrap("shown.bs.modal",(function(){$(this).find("[autofocus]").trigger("focus")})),$(".navbar-collapse").on("click",".dropdown-menu a,.visible-xs",(function(){$("#navbarCollapse").collapse("hide")})),$("#head-navigation-gallery").on("click","a,.visible-xs",(function(){$("#navbarCollapse").collapse("hide")})),l.isPublicServerVersion()){var e='<div href="#" id="feedbackButton" class="rightMenuButton" rel="tooltip" data-bs-original-title="" title=""><span id="" class="feedbackButton typcn typcn-feedback"></span></div>';$("#rightMenuDiv").append(e),window.onmessage=function(e){if("closeFeedback"===e.data)$("#feedbackIframe").oneWrap("load",(function(){setTimeout((function(){$("#feedbackIframe").attr("src","about:blank"),$("#feedbackModal").modal("hide")}),1e3)}));else if(e.data.indexOf("feedbackHeight")>=0){var o=e.data.split(":")[1]||400;$("#feedbackIframe").height(o)}},$("#feedbackButton").on("click","",(function(){$("#feedbackModal").on("show.bs.modal",(function(){"de"===l.getLanguage().toLowerCase()?$("#feedbackIframe").attr("src","https://www.roberta-home.de/lab/feedback/"):$("#feedbackIframe").attr("src","https://www.roberta-home.de/en/lab/feedback/")})),$("#feedbackModal").modal("show")}))}$("#head-navigation-program-edit").on("click",".dropdown-menu li:not(.disabled) a",(function(e){var o=function(e){var o=e.target,t=e.currentTarget;switch(o.id||t.id){case"menuRunProg":s.runOnBrick();break;case"menuRunSim":$("#simButton").clickWrap();break;case"menuCheckProg":c.checkProgram();break;case"menuNewProg":c.newProgram();break;case"menuListProg":$("#tabProgList").data("type","Programs"),$("#tabProgList").tabWrapShow();break;case"menuListExamples":$("#tabProgList").data("type","Examples"),$("#tabProgList").tabWrapShow();break;case"menuSaveProg":c.saveToServer();break;case"menuSaveAsProg":c.showSaveAsModal();break;case"menuShowCode":$("#codeButton").clickWrap();break;case"menuSourceCodeEditor":m.clickSourceCodeEditor();break;case"menuExportProg":c.exportXml();break;case"menuExportAllProgs":c.exportAllXml();break;case"menuImportProg":d.importXml();break;case"menuLinkProg":c.linkProgram();break;case"menuToolboxBeginner":$('.levelTabs a[href="#beginner"]').tabWrapShow();break;case"menuToolboxExpert":$('.levelTabs a[href="#expert"]').tabWrapShow();break;case"menuDefaultFirmware":f.getConnectionInstance().reset2DefaultFirmware()}};a.wrapUI(o,"edit menu click")(e)})),$("#head-navigation-configuration-edit").onWrap("click",".dropdown-menu li:not(.disabled) a",(function(e){var o=e.target,n=e.currentTarget;switch($(".modal").modal("hide"),o.id||n.id){case"menuCheckConfig":t.displayMessage("MESSAGE_NOT_AVAILABLE","POPUP","",null,null);break;case"menuNewConfig":u.newConfiguration();break;case"menuListConfig":$("#tabConfList").tabWrapShow();break;case"menuSaveConfig":u.saveToServer();break;case"menuSaveAsConfig":u.showSaveAsModal()}})),$("#head-navigation-robot").onWrap("click",".dropdown-menu li:not(.disabled) a",(function(e){$(".modal").modal("hide");var o=e.currentTarget;"menuConnect"===o.id?f.getConnectionInstance().showConnectionModal():"menuRobotInfo"===o.id?f.getConnectionInstance().showRobotInfo():"menuWlan"===o.id?f.getConnectionInstance().showWlanModal():"menuRobotSwitch"===o.id&&A()})),$("#head-navigation-help").onWrap("click",".dropdown-menu li:not(.disabled) a",(function(e){$(".modal").modal("hide");var o=e.target;"menuAbout"===o.id?($("#version").text(l.getServerVersion()),$("#show-about").modal("show")):"menuLogging"===o.id&&$("#tabLogList").tabWrapShow()})),$(".menuGeneral").onWrap("click",(function(){window.open("https://jira.iais.fraunhofer.de/wiki/display/ORInfo")}),"head navigation menu item general clicked"),$(".menuFaq").onWrap("click",(function(){window.open("https://jira.iais.fraunhofer.de/wiki/display/ORInfo/FAQ")}),"head navigation menu item faq clicked"),$(".menuAboutProject").onWrap("click",(function(){"de"==l.getLanguage()?window.open("https://www.roberta-home.de/index.php?id=135"):window.open("https://www.roberta-home.de/index.php?id=135&L=1")}),"head navigation menu item about clicked"),$(".menuShowStart").onWrap("click",(function(){return A()})),$("#head-navigation-user").onWrap("click",".dropdown-menu li:not(.disabled) a",(function(e){var o=e.target;switch($(".modal").modal("hide"),o.id){case"menuUserGroupLogin":r.showUserGroupLoginForm();break;case"menuLogout":r.logout();break;case"menuGroupPanel":$("#tabUserGroupList").tabWrapShow();break;case"menuChangeUser":r.showUserDataForm();break;case"menuDeleteUser":r.showDeleteUserModal();break;case"menuStateInfo":r.showUserInfo();break;case"menuNotification":i.showNotificationModal()}return!1})),$(".menuLogin").onWrap("click",(function(){r.showLoginForm()}),"head navigation menu item login clicked"),$("#head-navigation-gallery").onWrap("click",(function(){return $("#tabGalleryList").tabWrapShow(),!1}),"gallery clicked"),$("#head-navigation-tutorial").onWrap("click",(function(){return $("#tabTutorialList").tabWrapShow(),!1}),"tutorial clicked"),$(".navbar-fixed-top").on("mouseleave",(function(){$(".navbar-fixed-top .dropdown").removeClass("open")})),$(".cancelPopup").onWrap("click",(function(){$(".ui-dialog-titlebar-close").clickWrap()}),"cancel popup clicked"),$("#about-join").onWrap("click",(function(){$("#show-about").modal("hide")}),"hide show about clicked"),$(window).on("beforeunload",(function(){return"ok"})),$("#navbarCollapse").on("shown.bs.collapse",(function(){var e=Math.min($(this).height(),Math.max($("#blocklyDiv").height(),$("#brickly").height(),$("#nn").height()));$(this).css("height",e)})),$(document).onWrap("keydown",(function(e){if("tabProgram"===l.getView()){if((e.metaKey||e.ctrlKey)&&50==e.which){e.preventDefault();var o=l.getBlocklyWorkspace().newBlock("robActions_debug");return o.initSvg(),o.render(),o.setInTask(!1),!1}if((e.metaKey||e.ctrlKey)&&51==e.which){e.preventDefault();var n=l.getBlocklyWorkspace().newBlock("robActions_assert");n.initSvg(),n.setInTask(!1),n.render();var a=l.getBlocklyWorkspace().newBlock("logic_compare");a.initSvg(),a.setMovable(!1),a.setInTask(!1),a.setDeletable(!1),a.render();var r=n.getInput("OUT").connection,i=a.outputConnection;return r.connect(i),!1}var g;if((e.metaKey||e.ctrlKey)&&52==e.which)return e.preventDefault(),(g=l.getBlocklyWorkspace().newBlock("robActions_eval_expr")).initSvg(),g.render(),g.setInTask(!1),!1;if((e.metaKey||e.ctrlKey)&&53==e.which)return e.preventDefault(),(g=l.getBlocklyWorkspace().newBlock("robActions_eval_stmt")).initSvg(),g.render(),g.setInTask(!1),!1;if((e.metaKey||e.ctrlKey)&&83==e.which&&(e.preventDefault(),l.isUserLoggedIn()?"NEPOprog"===l.getProgramName()||e.shiftKey?c.showSaveAsModal():l.isProgramSaved()||c.saveToServer():t.displayMessage("ORA_PROGRAM_GET_ONE_ERROR_NOT_LOGGED_IN","POPUP","",null,null)),(e.metaKey||e.ctrlKey)&&82==e.which&&(e.preventDefault(),l.isRunEnabled()&&s.runOnBrick()),(e.metaKey||e.ctrlKey)&&77==e.which&&(e.preventDefault(),l.isUserLoggedIn()?($("#progList").trigger("Programs"),$("#tabProgList").tabWrapShow()):t.displayMessage("ORA_PROGRAM_GET_ONE_ERROR_NOT_LOGGED_IN","POPUP","",null,null)),(e.metaKey||e.ctrlKey)&&73==e.which)return e.preventDefault(),d.importXml(),!1;if((e.metaKey||e.ctrlKey)&&69==e.which)return e.preventDefault(),c.exportXml(),!1}else"tabConfiguration"===l.getView()&&((e.metaKey||e.ctrlKey)&&83==e.which&&(e.preventDefault(),l.isUserLoggedIn()?l.isConfigurationStandard()||e.shiftKey?u.showSaveAsModal():l.isProgramSaved()||u.saveToServer():t.displayMessage("ORA_PROGRAM_GET_ONE_ERROR_NOT_LOGGED_IN","POPUP","",null,null)),(e.metaKey||e.ctrlKey)&&77==e.which&&(e.preventDefault(),l.isUserLoggedIn()?$("#tabConfList").tabWrapShow():t.displayMessage("ORA_PROGRAM_GET_ONE_ERROR_NOT_LOGGED_IN","POPUP","",null,null)))}))}(),function e(){setTimeout((function(){(w+=1e3)>=l.getPingTime()&&l.doPing()&&(n.ping((function(e){l.setState(e)})),w=0),e()}),1e3)}(),function(){var e=new URL(document.location.toString()),o=e.protocol+"//"+e.host,t=e.hash&&e.toString().indexOf("#")<=o.length+1||!1,n=""!==e.search||!1;if(t){var a=!0,i=void 0,s=decodeURI(document.location.hash).split("&&");"#overview"===s[0]?(l.setStartWithoutPopup(),v("ev3lejosv1",{},(function(){c.newProgram(!0),g.start("overview")})),i=o+k+"tour"+S+"overview"):"#loadProgram"===s[0]&&s.length>=4?(l.setStartWithoutPopup(),v&&v instanceof Function&&v(s[1],{},d.loadProgramFromXML,[s[2],s[3]]),i=o+k+"loadSystem"+S+s[1]+P+"loadProgram"+S+s[3]):"#loadSystem"===s[0]&&s.length>=2?(l.setStartWithoutPopup(),v&&v instanceof Function&&v(s[1],{}),i=o+k+"loadSystem"+S+s[1]):"#gallery"===s[0]?(a=!1,i=o+k+"loadSystem"+S+"<ROBOT_SYSTEM>"+P+R):"#tutorial"===s[0]&&(a=!1,i=o+k+"loadSystem"+S+"<ROBOT_SYSTEM>"+P+O,s.length>1&&(i+=S+s[1],s.length>2&&(i+=P+s[2])));var u=void 0;"de"===l.getLanguage()&&a?u="Die eingegebenen URL-Parameter sind in dieser Form veraltet und werden bald nicht mehr unterstützt.\nBitte verwende ab sofort nur noch folgende Schreibweise:\n":"en"===l.getLanguage()&&a?u="The URL parameters entered are outdated in this form and will soon no longer be supported.\nPlease use only the following spelling from now on:":"de"!==l.getLanguage()||a?"en"!==l.getLanguage()||a||(u="The URL parameters entered are outdated in this form and are no longer supported.\nPlease use only the following spelling from now on:"):u="Die eingegebenen URL-Parameter sind in dieser Form veraltet und werden nicht mehr unterstützt.\nBitte verwende ab sofort nur noch folgende Schreibweise:\n",u+=i,alert(u)}if(n){var m=C(y);m&&r.showResetPassword(m);var p=C(L);p&&r.activateAccount(p);var f=C(_);f&&(l.setStartWithoutPopup(),v("ev3lejosv1",{},(function(){c.newProgram(!0),g.start(f)})));var b=C(W);if(void 0!==b){l.setStartWithoutPopup();var w=void 0,A={},x=[],B=C(O),D=C(E),U=C(I),K=C(R),G=C(M);B?(C(T)&&l.setKioskMode(!0),w=function(e){h.loadFromTutorial(e)},x.push(B)):D?(w=d.loadProgramFromXML,x.push("NEPOprog"),x.push(D)):U?w=function(){$("#menuListExamples").clickWrap()}:K?w=function(){$("#tabGalleryList").tabWrapShow()}:G&&G.split(",").forEach((function(e){"calliope2017NoBlue"===b&&"blue"===e?b="calliope2017":A[e]=!0})),v&&v instanceof Function&&v(b,A,w,x)}}}(),p.cleanUri()):alert("Problem")}}));
//# sourceMappingURL=menu.controller.js.map
//# sourceMappingURL=menu.controller.js.map
