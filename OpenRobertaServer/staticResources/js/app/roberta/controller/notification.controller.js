var __extends=this&&this.__extends||function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","guiState.model","guiState.controller","notification.model","comm","jquery"],(function(t,e,i,n,o,r,s){Object.defineProperty(e,"__esModule",{value:!0}),e.showNotificationModal=e.reloadNotifications=e.init=e.getDeprecatedNotifications=void 0;var a=400,c=s("#releaseInfo"),f=c.children("#releaseInfoTitle"),u=c.children("#releaseInfoContent"),l=s("#notificationForm"),h=s("#notificationFileUpload"),d=s("#notificationFileDownload"),p=[],m=[];function v(){o.getNotifications((function(t){var e;t.notifications.notifications&&(e=t.notifications.notifications,p=e.map((function(t){return new T(t)}))),t.notifications.deprecated&&(m=t.notifications.deprecated)}))}function g(){p.forEach((function(t){t.removeTriggers(),t.hideNotification()})),p=[],v()}function y(t,e,i){i=i||6e3,s("#notification-modal-alert").html(e).removeClass().addClass("alert").addClass("alert-"+t).slideDown().delay(i).slideUp()}function w(t){var e="text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t,null,"\t"));d.attr("href","data:"+e)}e.getDeprecatedNotifications=function(t,e){var i=m.find((function(e){return void 0!==e[t]}));if(i)return i[t][e]},e.init=function(){l.onWrap("submit",(function(t){var e,i;t.preventDefault(),e=function(t){o.postNotifications(t,(function(e){"ok"===e.rc&&"ORA_NOTIFICATION_SUCCESS"===e.message?(l.trigger("reset"),y("success","The notifications were transmitted successfully"),w(JSON.parse(t))):y("danger",e.cause+(e.parameters&&e.parameters.MESSAGE?":"+e.parameters.MESSAGE:""),6e4)}))},(i=h.prop("files")).length>0&&function(t,e){var i=new FileReader;i.onload=function(){return e(i.result)},i.readAsText(t)}(i[0],e)})),v(),r.onNotificationsAvailableCallback(g)},e.reloadNotifications=g,e.showNotificationModal=function(){o.getNotifications((function(t){w(t.notifications),s("#modal-notifications").modal("show")}))};var _=function(){function t(t,e,i){this.selector=t,this.event=e,this.fn=i,this.$element=s(t),this.elementIsPresent=this.$element.length}return t.prototype.addTriggers=function(){this.elementIsPresent?this.$element.on(this.event,this.fn):s(document).on(this.event,this.selector,this.fn)},t.prototype.removeTriggers=function(){this.elementIsPresent?this.$element.off(this.event,this.fn):s(document).off(this.event,this.selector,this.fn)},t}(),T=function(){function t(t){this.activeEventHandler=[],this.notificationHandlers=[],this.specification=t,this.setupNotificationHandlers(),this.addTriggers()}return t.prototype.setupNotificationHandlers=function(){var t=this;this.specification.handlers.forEach((function(e){if(e.popupNotification){var i=new C(e.popupNotification);t.notificationHandlers.push(i)}if(e.elementMarker){var n=new A(e.elementMarker);t.notificationHandlers.push(n)}if(e.startScreen){var o=new E(e.startScreen);t.notificationHandlers.push(o)}}))},t.prototype.showNotification=function(){!0===this.specification.once&&this.removeTriggers(),this.notificationHandlers.forEach((function(t){return t.show()}))},t.prototype.hideNotification=function(){this.notificationHandlers.forEach((function(t){return t.hide()}))},t.prototype.evaluateConditionsAndShowNotification=function(e){var i=this.specification,n=i.condition,o=i.ignoreDate;t.evaluateCondition(e,o)&&t.evaluateCondition(n,o)&&this.showNotification()},t.evaluateCondition=function(t,e){return void 0===t||t.every((function(t){if(t.guiModel){var n=t.anyOf,o=t.equals,r=t.notEquals,a=i.gui[t.guiModel];if(n&&Array.isArray(n))return n.some((function(t){return a===t}));if(o)return a===o;if(r)return Array.isArray(r)?r.every((function(t){return a!==t})):a!==r}var c=S(t);if(t.hasClass&&c)return s(c).hasClass(t.hasClass);if(!e){if(t.endTime)return I(t.endTime)>=new Date;if(t.startTime)return I(t.startTime)<=new Date}return!0}))},t.prototype.addEventHandler=function(t,e,i){var n=new _(t,e,i);n.addTriggers(),this.activeEventHandler.push(n)},t.prototype.addTriggers=function(){var t=this;!this.specification.triggers||this.specification.triggers>0?this.evaluateConditionsAndShowNotification():this.specification.triggers.forEach((function(e){var i=e.event,n=e.addClass,o=e.removeClass,r=e.conditions,a=(e.deprecated,S(e));a&&(i&&t.addEventHandler(a,i,(function(){t.evaluateConditionsAndShowNotification(r)})),(n||o)&&t.addEventHandler(a,"classChange",(function(){n&&s(a).hasClass(n)&&t.evaluateConditionsAndShowNotification(r),o&&!s(a).hasClass(o)&&t.evaluateConditionsAndShowNotification(r)})))}))},t.prototype.removeTriggers=function(){this.activeEventHandler.forEach((function(t){return t.removeTriggers()})),this.activeEventHandler=[]},t}(),N=function(){function t(t){this.active=!1,this.time=t}return t.prototype.clearTimerIfExists=function(){this.timer&&clearTimeout(this.timer)},t.prototype.setOrResetTimer=function(){var t=this;this.time&&(this.clearTimerIfExists(),this.timer=setTimeout((function(){return t.hide()}),this.time))},t.prototype.show=function(){this.setOrResetTimer(),this.active||(this.showAction(),this.active=!0)},t.prototype.hide=function(){this.active&&(this.clearTimerIfExists(),this.hideAction(),this.active=!1)},t}(),C=function(t){function e(e){var i=t.call(this,e.time||2e4)||this;return i._title=b(e.title),i._content=b(e.content),i}return __extends(e,t),e.prototype.hideAction=function(){f.html()===this._title&&u.html()===this._content&&c.fadeOut(a)},e.prototype.showAction=function(){f.html(this._title),u.html(this._content),c.fadeIn(a)},e}(N),A=function(t){function e(e){var i=t.call(this,e.time||3e5)||this;return i._content=b(e.content),i.$element=s(S(e)),i.$badge=s("<span class='badge badge-primary' style='display:none;'>"+i._content+"</span>"),i}return __extends(e,t),e.prototype.hideAction=function(){this.$element.length&&this.$badge.fadeOut(a).queue((function(){s(this).remove()}))},e.prototype.showAction=function(){this.$element.length&&this.$badge.appendTo(this.$element).fadeIn(a)},e}(N),E=function(t){function e(e){var i=t.call(this,e.time||undefined)||this;return i.$startupMessage=s("#startup-message-statustext"),i.content=b(e.content),i.$element=s('<h4 style="display: none"><button aria-hidden="true" class="btn-close btn-close-white float-end" onclick="$(this).parent().slideUp(400)" type="button"></button>\n'+i.content+"</h4>"),i}return __extends(e,t),e.prototype.showAction=function(){this.$element.appendTo(this.$startupMessage).slideDown(a)},e.prototype.hideAction=function(){this.$element.slideUp(a).queue((function(){s(this).remove()}))},e}(N);function S(t){return t.htmlId?"#"+t.htmlId:t.htmlSelector?t.htmlSelector:void 0}function b(t){return t[n.getLanguage()]||t.en}function I(t){return new Date(t+" +0200")}}));
//# sourceMappingURL=notification.controller.js.map
//# sourceMappingURL=notification.controller.js.map
