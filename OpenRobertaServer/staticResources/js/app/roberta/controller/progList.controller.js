var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var a,t=1,r=arguments.length;t<r;t++)for(var s in a=arguments[t])Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s]);return e},__assign.apply(this,arguments)};define(["require","exports","log","util.roberta","message","progList.model","userGroup.model","program.model","configuration.controller","program.controller","guiState.controller","jquery","table","blockly","bootstrap-table"],(function(e,a,t,r,s,o,l,n,i,p,c,g,d,b){var m,h,u,f,T,y;function L(){f=g("#programNameTable");var e={locale:c.getLanguage(),theadClasses:"table-dark",pageList:"[ 10, 25, All ]",toolbar:"#progListToolbar",showRefresh:"true",showPaginationSwitch:"true",columns:[{title:"<span lkey='Blockly.Msg.DATATABLE_PROGRAM_NAME'>"+(b.Msg.DATATABLE_PROGRAM_NAME||"Name des Programms")+"</span>",sortable:!0},{title:"<span lkey='Blockly.Msg.DATATABLE_CREATED_BY'>"+(b.Msg.DATATABLE_CREATED_BY||"Erzeugt von")+"</span>",sortable:!0},{events:_,title:"<span class='typcn typcn-flow-merge'></span>",sortable:!0,sorter:R,formatter:v,align:"left",valign:"middle"},{visible:!1},{title:"<span lkey='Blockly.Msg.DATATABLE_CREATED_ON'>"+(b.Msg.DATATABLE_CREATED_ON||"Erzeugt am")+"</span>",sortable:!0,formatter:r.formatDate},{title:"<span lkey='Blockly.Msg.DATATABLE_ACTUALIZATION'>"+(b.Msg.DATATABLE_ACTUALIZATION||"Letzte Aktualisierung")+"</span>",sortable:!0,formatter:r.formatDate},{title:'<input name="btSelectAll" type="checkbox">',formatter:function(e,a,t){return c.isUserMemberOfUserGroup()&&a[1]===c.getUserUserGroupOwner()?'<input type="checkbox" name="btSelectItem" data-index="'+t+'" disabled>':'<input type="checkbox" name="btSelectItem" data-index="'+t+'">'},valign:"middle",halign:"center",align:"center"},{events:k,title:w,align:"left",valign:"top",formatter:S,width:"117px"}]},a=__assign(__assign({},d.CommonTable.options),e);f.bootstrapTable(a),f.bootstrapTable("togglePagination")}function P(){h===m.Programs?function(){g("#programNameTable").bootstrapTable("showLoading"),f.bootstrapTable("showColumn",[2,6]),f.bootstrapTable("refreshOptions",{sortName:4,sortOrder:"desc",search:!0,filterControl:!0});var e=g("<select class='form-select filter' id='progListScopeSelect'><option data-translation-targets='html' value='userProgram'>"+b.Msg.MENU_LIST_PROG+"</option><optGroup data-translation-targets='label' id='progListUserGroupScope' label="+b.Msg.DATATABLE_USERGROUPS+"></optGroup></select>");g("#progList .search").prepend(e),c.isUserMemberOfUserGroup()||l.loadUserGroupList((function(e){"ok"==e.rc&&e.userGroups.length>0&&e.userGroups.forEach((function(e){g("#progListUserGroupScope").append('<option value="'+e.name+'">'+e.name+"</option>")}))}));o.loadProgList(O)}():(g("#programNameTable").bootstrapTable("showLoading"),f.bootstrapTable("hideColumn",[2,6]),f.bootstrapTable("refreshOptions",{sortName:0,sortOrder:"asc",search:!1,filterControl:!1}),o.loadExampleList(A)),u=g("#progList"),T=g("#progListUserGroupScope"),y=T.closest("select"),u.find('button[name="refresh"]').onWrap("click",(function(){switch(h){case m.Programs:y.trigger("change");break;case m.Examples:default:g("#programNameTable").bootstrapTable("showLoading"),o.loadExampleList(A)}return!1}),"refresh prog list"),y.change((function(){if(h!=m.Examples){var e=y.val();g("#programNameTable").bootstrapTable("showLoading"),"userProgram"===e?o.loadProgList(O):o.loadProgListFromUserGroupMembers(e,O)}})),f.onWrap("click-row.bs.table",(function(e,a){M(a)}),"Load program from listing clicked"),f.onWrap("check-all.bs.table check.bs.table",(function(){g("#deleteSomeProgHeader").removeClass("disabled"),g("#deleteSomeProgHeader").tooltip({trigger:"hover"}),f.find("#shareSome").removeClass("disabled"),f.find(".delete, .share, .gallery, .load").addClass("disabled")}),"check all programs"),f.onWrap("uncheck-all.bs.table",(function(){g("#deleteSomeProgHeader").addClass("disabled"),f.find("#shareSome").addClass("disabled"),f.find(".delete, .share, .gallery, .load").filter(':not([data-status="disabled"])').removeClass("disabled")}),"uncheck all programs"),f.onWrap("uncheck.bs.table",(function(){var e=f.bootstrapTable("getSelections");e&&0!==e.length||(g("#deleteSomeProgHeader").addClass("disabled"),f.find("#shareSome").addClass("disabled"),f.find(".delete, .share, .gallery, .load").filter(':not([data-status="disabled"])').removeClass("disabled"))}),"uncheck one program"),f.on("shown.bs.collapse hidden.bs.collapse",(function(){f.bootstrapTable("resetWidth")})),g("#deleteSomeProgHeader").onWrap("click",(function(){for(var e=f.bootstrapTable("getSelections",{}),a="<br>",t=0;t<e.length;t++)a+=e[t][0],a+="<br>";g("#confirmDeleteProgramName").html(a);var r=g("#confirmDeleteProgram");return r.oneWrap("hide.bs.modal",(function(){g("#programNameTable").bootstrapTable("showLoading"),o.loadProgList(O)})),r.data("programs",e),r.modal("show"),!1}))}function E(){g("#progList>.bootstrap-table").find('button[name="paginationSwitch"]').attr("title","").attr("rel","tooltip").attr("data-bs-original-title",g("#programNameTable").bootstrapTable.locales[c.getLanguage()].formatPaginationSwitch()).tooltip({trigger:"hover"}),g("#progList>.bootstrap-table").find('button[name="refresh"]').attr("title","").attr("rel","tooltip").attr("data-bs-original-title",g("#programNameTable").bootstrapTable.locales[c.getLanguage()].formatRefresh()).tooltip({trigger:"hover"}),f.find('[rel="tooltip"]').tooltip({trigger:"hover"})}function O(e){r.response(e),"ok"===e.rc?(f.bootstrapTable("load",e.programNames),g("#progList .search").show()):"loadPN"===e.cmd&&g("#backProgList").clickWrap(),f.bootstrapTable("hideLoading"),g("#deleteSomeProgHeader").removeClass("invisible"),E()}function A(e){r.response(e),"ok"===e.rc?g("#programNameTable").bootstrapTable("load",e.programNames):"loadPN"===e.cmd&&g("#backProgList").clickWrap(),f.bootstrapTable("hideLoading"),g("#deleteSomeProgHeader").addClass("invisible"),E()}Object.defineProperty(a,"__esModule",{value:!0}),a.switchLanguage=a.init=void 0,function(e){e.Examples="Examples",e.Programs="Programs"}(m||(m={})),a.init=function(){L(),function(){var e=g("#tabProgList");function a(){f.bootstrapTable("resetView",{height:r.calcDataTableHeight()})}e.onWrap("show.bs.tab",(function(){c.setView("tabProgList"),h=m[e.data("type")],P()})),g("#backProgList").onWrap("click",(function(){return g("#tabProgram").tabWrapShow(),!1}),"back to program view"),f.onWrap("toggle-pagination.bs.table shown.bs.collapse",(function(){a()})),g(window).onWrap("resize",(function(){a()}))}()},a.switchLanguage=function(){g("#programNameTable").bootstrapTable("destroy"),L(),P()};var _={"click .showRelations":function(e,a,t,r){e.stopPropagation(),g(".relation"+r).collapse("toggle")}},k={"click .delete":function(e,a,t){e.stopPropagation();for(var r=[t],s="<br>",o=0;o<r.length;o++)s+=r[o][0],s+="<br>";g("#confirmDeleteProgramName").html(s);var l=g("#confirmDeleteProgram");return l.data("programs",r),l.oneWrap("hidden.bs.modal",(function(){})),l.modal("show"),!1},"click .share":function(e,a,t){return e.stopPropagation(),t[2].sharedFrom||g("#show-relations").trigger("updateAndShow",[t]),!1},"click .gallery":function(e,a,t){return e.stopPropagation(),t[2].sharedFrom||c.isUserMemberOfUserGroup()||g("#share-with-gallery").trigger("updateAndShow",[t]),!1},"click .load":function(e,a,t){e.stopPropagation(),M(t)}},v=function(e,a,t){if(g.isEmptyObject(e))return'<span class="typcn typcn-minus"></span>';if("READ"===e.sharedFrom)return'<span class="typcn typcn-eye"></span>';if("WRITE"===e.sharedFrom)return'<span class="typcn typcn-pencil"></span>';if("X_WRITE"===e.sharedFrom)return'<span class="typcn typcn-key"></span>';if(e.sharedWith&&1==e.sharedWith.length){var r="";return g.each(e.sharedWith,(function(e,a){r+="<span>","User"===a.type&&"Roberta"===a.label||("READ"===a.right?r+='<span class="typcn typcn-eye"></span>':"X_WRITE"===a.right?r+='<span class="typcn typcn-key"></span>':"WRITE"===a.right&&(r+='<span class="typcn typcn-pencil"></span>')),"User"===a.type?r+='&nbsp;<span class="typcn typcn-user"></span>':"UserGroup"===a.type&&(r+='&nbsp;<span class="typcn typcn-group"></span>'),r+="&nbsp;",r+='<span class="value">',r+=a.label,r+="</span>",r+="</span>"})),r}if(e.sharedWith&&Object.keys(e.sharedWith).length>1){var s=[];g.each(e.sharedWith,(function(e,a){var t="";"User"===a.type?t='&nbsp;<span class="typcn typcn-user"></span>':"UserGroup"===a.type&&(t='&nbsp;<span class="typcn typcn-group"></span>'),"User"===a.type&&"Roberta"===a.label||("READ"===a.right?s.push('<span class="typcn typcn-eye"></span>'+t+'&nbsp;<span class="value">'+a.label+"</span>"):"WRITE"===a.right&&s.push('<span class="typcn typcn-pencil"></span>'+t+'&nbsp;<span class="value">'+a.label+"</span>"))}));var o='<div style="white-space:nowrap;"><span style="float:left;">';o+=s[0],o+='</span><a class="collapsed showRelations" href="#" style=" float:right;" href="#" data-bs-toggle="collapse" data-bs-target=".relation'+t+'"></a></div>';for(var l=1;l<s.length;l++)o+='<div style="clear:both;" class="collapse relation'+t+'">',o+=s[l],o+="</div>";return o}},S=function(e,a){var t="";return h===m.Programs&&(c.isUserMemberOfUserGroup()&&c.getUserUserGroupOwner()===a[1]?t+='<a href="#" class="delete disabled" data-status="disabled"><span class="typcn typcn-delete"></span></a>':t+='<a href="#" class="delete" rel="tooltip" lkey="Blockly.Msg.PROGLIST_DELETE_TOOLTIP" data-bs-original-title="'+b.Msg.PROGLIST_DELETE_TOOLTIP+'" title=""><span class="typcn typcn-delete"></span></a>',a[2].sharedFrom?(t+='<a href="#" class="share disabled" data-status="disabled"><span class="typcn typcn-flow-merge"></span></a>',c.isUserMemberOfUserGroup()||(t+='<a href="#" class="gallery disabled" data-status="disabled"><span class="typcn typcn-th-large-outline"></span></a>')):(t+='<a href="#" class="share" rel="tooltip" lkey="Blockly.Msg.PROGLIST_SHARE_TOOLTIP" data-bs-original-title="'+b.Msg.PROGLIST_SHARE_TOOLTIP+'" title=""><span class="typcn typcn-flow-merge"></span></a>',c.isUserMemberOfUserGroup()||(t+='<a href="#" class="gallery" rel="tooltip" lkey="Blockly.Msg.PROGLIST_SHARE_WITH_GALLERY_TOOLTIP" data-bs-original-title="'+b.Msg.PROGLIST_SHARE_WITH_GALLERY_TOOLTIP+'" title=""><span class="typcn typcn-th-large-outline"></span></a>'))),t+='<a href="#" class="load" rel="tooltip" lkey="Blockly.Msg.PROGLIST_LOAD_TOOLTIP" data-bs-original-title="'+b.Msg.PROGLIST_LOAD_TOOLTIP+'" title=""><span class="typcn typcn-document"></span></a>'},R=function(e,a){if(g.isEmptyObject(e)&&g.isEmptyObject(a))return 0;if(e.sharedFrom&&a.sharedFrom)return"WRITE"===e.sharedFrom&&"WRITE"===a.sharedFrom?0:"WRITE"===e.sharedFrom?1:-1;if(e.sharedWith&&a.sharedWith){var t={a:e.sharedWith[0].right,b:a.sharedWith[0].right};return t.a===t.b?0:"WRITE"===t.a?1:-1}return g.isEmptyObject(e)?-1:g.isEmptyObject(a)||e.sharedWith?1:-1},w='<a href="#" id="deleteSomeProgHeader" class="deleteSomeProg disabled" rel="tooltip" lkey="Blockly.Msg.PROGLIST_DELETE_ALL_TOOLTIP" data-bs-original-title="'+b.Msg.PROGLIST_DELETE_ALL_TOOLTIP+'"title=""><span class="typcn typcn-delete"></span></a>';function M(e){t.info("loadFromList "+e[0]),n.loadProgramFromListing(e[0],e[1],e[3],(function(a){if("ok"===a.rc){a.programShared=!1;var t=e[1]===c.getUserAccountName()?null:e[1];t&&(a.programShared="READ"),e[2].sharedFrom&&(a.programShared=e[2].sharedFrom),a.name=e[0],c.setProgram(a,t),c.setProgramXML(a.progXML),void 0===a.configName?void 0===a.confXML?(c.setConfigurationNameDefault(),c.setConfigurationXML(c.getConfigurationConf())):(c.setConfigurationName(""),c.setConfigurationXML(a.confXML)):(c.setConfigurationName(a.configName),c.setConfigurationXML(a.confXML)),g("#tabProgram").oneWrap("shown.bs.tab",(function(){i.reloadConf(),p.reloadProgram()})),g("#tabProgram").tabWrapShow()}s.displayInformation(a,"",a.message,"","")}))}}));
//# sourceMappingURL=progList.controller.js.map
//# sourceMappingURL=progList.controller.js.map
