define(["require","exports","guiState.controller","jquery","program.model","program.controller","message","blockly","aceEditor"],(function(o,t,e,a,r,i,n,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;var c="",g=[];function d(o,t){if(l.wasEditedByUser()){c=l.getTextlyEditorCode();var d=e.getBlocklyWorkspace(),f=d.getTopBlocks(!0);g=[],f.forEach((function(o){g.push(o.getRelativeToSurfaceXY())}));var u=s.Xml.workspaceToDom(d),m=s.Xml.domToText(u),y=e.getConfigurationXML(),b=!e.isConfigurationStandard()&&!e.isConfigurationAnonymous()?e.getConfigurationName():void 0,T=e.getLanguage();r.setTextly(e.getProgramName(),b,m,y,c,i.getSSID(),i.getPassword(),T,(function(r){if("ok"!=r.rc)return a("#tabTextly").tabWrapShow(),a("#show-message-confirm").oneWrap("shown.bs.modal",(function(){a("#confirm").off(),a("#confirm").on("click",(function(o){o.preventDefault(),l.setTextlyEditorCode(c);var t=r.textlyErrors.map((function(o){var t=o.message,e=s.Msg[o.message];return void 0!==e&&""!==e||(e=t),{row:o.line-1,column:o.charPositionInLine,text:e,type:"error"}}));l.setTextlyAnnotations(t),a(".modal").modal("hide")})),a("#confirmCancel").off(),a("#confirmCancel").on("click",(function(o){o.preventDefault(),l.setWasEditedByUser(!1),a(t).tabWrapShow()}))})),n.displayMessage("TEXTLY_EDITOR_CLOSE_CONFIRMATION","TEXTLYPOPUP","",!0,!1),!1;o&&(i.reloadProgram(r),function(o){var t=o.getAllBlocks(!0);t.forEach((function(o,t){if(t<g.length){var e=g[t],a=o.getRelativeToSurfaceXY(),r=e.x-a.x,i=e.y-a.y;o.moveBy(r,i)}}))}(d),a(t).tabWrapShow()),e.setState(r),l.setTextlyEditorCode(r.programAsTextly),l.setWasEditedByUser(!1)}))}}t.init=function(){a("#tabTextly").onWrap("shown.bs.tab",(function(){var o,t,c,g,d,f,u;a("#textlyEditorPane").show(),a("#aceTextlyEditor").css("visibility","visible"),l.setTextlyEditable(!0),e.setView("tabTextly"),o=!0,t=e.getBlocklyWorkspace(),c=s.Xml.workspaceToDom(t),g=s.Xml.domToText(c),d=e.isConfigurationStandard()||e.isConfigurationAnonymous()?void 0:e.getConfigurationName(),f=e.isConfigurationAnonymous()?e.getConfigurationXML():void 0,u=e.getLanguage(),r.showTextly(e.getProgramName(),d,g,f,i.getSSID(),i.getPassword(),u,(function(t){i.reloadProgram(t),"ok"==t.rc?(o&&a("#tabTextly").tabWrapShow(),e.setState(t),l.setTextlyEditorCode(t.programAsTextly)):(a("#"+e.getPrevView()).tabWrapShow(),n.displayInformation(t,t.message,t.message,t.parameters),i.reloadProgram(t))}))}),"after show source code aceEditorController"),a("#tabProgram").onWrap("click",(function(o){d(o,"#tabProgram")}),"back to previous view"),a("#tabConfiguration").onWrap("click",(function(o){d(o,"#tabConfiguration")}),"back to previous view"),a("#tabTextly").onWrap("hide.bs.tab",(function(){a("#aceTextlyEditor").css("visibility","hidden"),l.setTextlyEditable(!1),a("#textlyEditorPane").hide()}),"hide tabTextly"),a("#tabNN").onWrap("shown.bs.tab",(function(o){d(o,"#tabNN")}),"show tabNN"),a("#tabNNlearn").onWrap("shown.bs.tab",(function(o){d(o,"#tabNN")}),"show tabNNLearn")}}));
//# sourceMappingURL=textly.controller.js.map
//# sourceMappingURL=textly.controller.js.map
