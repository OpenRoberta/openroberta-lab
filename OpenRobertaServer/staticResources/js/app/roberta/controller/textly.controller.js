define(["require","exports","guiState.controller","jquery","program.model","program.controller","message","blockly","aceEditor","util.roberta"],(function(t,e,o,a,r,i,n,s,l,c){Object.defineProperty(e,"__esModule",{value:!0}),e.extractNNstateAsJson=e.init=void 0;var g,d="",f=[];function u(t,e){if(l.wasEditedByUser()){d=l.getTextlyEditorCode();var u=o.getBlocklyWorkspace(),m=u.getTopBlocks(!0);f=[],m.forEach((function(t){f.push(t.getRelativeToSurfaceXY())}));var y=s.Xml.workspaceToDom(u),b=s.Xml.domToText(y),T=o.getConfigurationXML(),p=!o.isConfigurationStandard()&&!o.isConfigurationAnonymous()?o.getConfigurationName():void 0,x=o.getLanguage();r.setTextly(o.getProgramName(),p,b,T,d,i.getSSID(),i.getPassword(),x,(function(r){if("ok"!=r.rc)return a("#tabTextly").tabWrapShow(),a("#show-message-confirm").oneWrap("shown.bs.modal",(function(){a("#confirm").off(),a("#confirm").on("click",(function(t){t.preventDefault(),l.setTextlyEditorCode(d);var e=r.textlyErrors.map((function(t){var e=t.message,o=s.Msg[t.message];return void 0!==o&&""!==o||(o=e),{row:t.line-1,column:t.charPositionInLine,text:o,type:"error"}}));l.setTextlyAnnotations(e),a(".modal").modal("hide")})),a("#confirmCancel").off(),a("#confirmCancel").on("click",(function(t){t.preventDefault(),l.setWasEditedByUser(!1),a(e).tabWrapShow()}))})),n.displayMessage("TEXTLY_EDITOR_CLOSE_CONFIRMATION","TEXTLYPOPUP","",!0,!1),!1;t&&(i.reloadProgram(r),function(t){var e=t.getAllBlocks(!0);e.forEach((function(t,e){if(e<f.length){var o=f[e],a=t.getRelativeToSurfaceXY(),r=o.x-a.x,i=o.y-a.y;t.moveBy(r,i)}}))}(u),a(e).tabWrapShow()),o.setState(r),c.getTheStartBlock().data=JSON.stringify(g),l.setTextlyEditorCode(r.programAsTextly),l.setWasEditedByUser(!1)}))}}function m(){var t=c.getTheStartBlock();try{g=JSON.parse(t.data)}catch(t){}}e.init=function(){a("#tabTextly").onWrap("shown.bs.tab",(function(){var t,e,c,g,d,f,u;a("#textlyEditorPane").show(),a("#aceTextlyEditor").css("visibility","visible"),l.setTextlyEditable(!0),o.setView("tabTextly"),t=!0,e=o.getBlocklyWorkspace(),c=s.Xml.workspaceToDom(e),g=s.Xml.domToText(c),d=o.isConfigurationStandard()||o.isConfigurationAnonymous()?void 0:o.getConfigurationName(),f=o.isConfigurationAnonymous()?o.getConfigurationXML():void 0,u=o.getLanguage(),m(),r.showTextly(o.getProgramName(),d,g,f,i.getSSID(),i.getPassword(),u,(function(e){i.reloadProgram(e),"ok"==e.rc?(t&&a("#tabTextly").tabWrapShow(),o.setState(e),l.setTextlyEditorCode(e.programAsTextly)):(a("#"+o.getPrevView()).tabWrapShow(),n.displayInformation(e,e.message,e.message,e.parameters),i.reloadProgram(e))}))}),"after show source code aceEditorController"),a("#tabProgram").onWrap("click",(function(t){u(t,"#tabProgram")}),"back to previous view"),a("#tabConfiguration").onWrap("click",(function(t){u(t,"#tabConfiguration")}),"back to previous view"),a("#tabTextly").onWrap("hide.bs.tab",(function(){a("#aceTextlyEditor").css("visibility","hidden"),l.setTextlyEditable(!1),a("#textlyEditorPane").hide()}),"hide tabTextly"),a("#tabNN").onWrap("shown.bs.tab",(function(t){u(t,"#tabNN")}),"show tabNN"),a("#tabNNlearn").onWrap("shown.bs.tab",(function(t){u(t,"#tabNN")}),"show tabNNLearn")},e.extractNNstateAsJson=m}));
//# sourceMappingURL=textly.controller.js.map
//# sourceMappingURL=textly.controller.js.map
