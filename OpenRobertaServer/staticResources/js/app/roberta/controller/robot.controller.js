define(["require","exports","util.roberta","log","message","guiState.controller","robot.model","program.controller","configuration.controller","webview.controller","sourceCodeEditor.controller","progCode.controller","jquery","blockly","connection.controller","jquery-validate"],(function(e,o,t,n,a,i,r,s,l,d,c,g,m,f,u){var p,b,h;function w(e){b=e,m("#single-modal-list").modal("hide"),i.setRobotPort(e)}function v(e,o){return e<0?(n.info("The firmware version '"+o+"' on the server is newer than the firmware version '"+i.getRobotVersion()+"' on the robot"),m("#confirmUpdateFirmware").modal("show"),!0):e>0&&(n.info("The firmware version '"+o+"' on the server is older than the firmware version '"+i.getRobotVersion()+"' on the robot"),a.displayMessage("MESSAGE_FIRMWARE_ERROR","POPUP",""),!0)}function R(){r.updateFirmware((function(e){i.setState(e),"ok"===e.rc?a.displayMessage("MESSAGE_RESTART_ROBOT","POPUP",""):a.displayInformation(e,"",e.message,i.getRobotFWName())}))}Object.defineProperty(o,"__esModule",{value:!0}),o.switchRobot=o.updateFirmware=o.handleFirmwareConflict=o.showListModal=o.showScanModal=o.showSetTokenModal=o.getPort=o.setPort=o.init=void 0,o.init=function(e,o){var t=m.Deferred();return m.when(r.setRobot(e,o,(function(t){"ok"==t.rc&&(i.setExtensions(o),i.setRobot(e,t,!0))}))).then((function(){m("#iconDisplayRobotState").onWrap("click",(function(){h.showRobotInfo()}),"display robot state"),m("#wlan-form").removeData("validator"),m.validator.addMethod("wlanRegex",(function(e,o){return this.optional(o)||/^[a-zA-Z0-9$ *\(\)\{\}\[\]><~`\'\\\/|=+!?.,%#+&^@_\-äöüÄÖÜß]+$/gi.test(e)}),"This field contains nonvalid symbols."),m("#wlan-form").validate({rules:{wlanSsid:{required:!0,wlanRegex:!0},wlanPassword:{required:!0,wlanRegex:!0}},errorClass:"form-invalid",errorPlacement:function(e,o){e.insertBefore(o.parent())},messages:{wlanSsid:{required:f.Msg.VALIDATION_FIELD_REQUIRED,wlanRegex:f.Msg.VALIDATION_CONTAINS_SPECIAL_CHARACTERS},wlanPassword:{required:f.Msg.VALIDATION_FIELD_REQUIRED,wlanRegex:f.Msg.VALIDATION_CONTAINS_SPECIAL_CHARACTERS}}}),m("#setWlanCredentials").onWrap("click",(function(e){e.preventDefault(),m("#wlan-form").validate(),m("#wlan-form").valid()&&(s.setSSID(document.getElementById("wlanSsid").value),s.setPassword(document.getElementById("wlanPassword").value),m("#menu-wlan").modal("hide"))}),"wlan form submitted"),m("#doUpdateFirmware").onWrap("click",(function(){m("#set-token").modal("hide"),m("#confirmUpdateFirmware").modal("hide"),R()}),"update firmware of robot"),p=m("#single-modal-form"),m("#connectionsTable").bootstrapTable({formatNoMatches:function(){return'<div class="lds-ellipsis"></div>'},columns:[{title:"Name",field:"name"},{visible:!1,field:"id"}]}),m("#connectionsTable").onWrap("click-row.bs.table",(function(e,o){d.jsToAppInterface({target:i.getRobot(),type:"connect",robot:o.id})}),"connect to robot"),m("#show-available-connections").on("hidden.bs.modal",(function(e){d.jsToAppInterface({target:i.getRobot(),type:"stopScan"})})),m("#show-available-connections").onWrap("add",(function(e,o){m("#connectionsTable").bootstrapTable("insertRow",{index:999,row:{name:o.brickname,id:o.brickid}})}),"insert robot connections"),m("#show-available-connections").onWrap("connect",(function(e,o){var t={};t.robotName=o.brickname,t.robotState="wait",i.setState(t),m("#show-available-connections").modal("hide")}),"connect to a robot"),t.resolve()})),t.promise()},o.setPort=w,o.getPort=function(){return b},o.showSetTokenModal=function(){t.showSingleModal((function(){m("#singleModalInput").attr("type","text"),m("#single-modal h5").text(f.Msg.MENU_CONNECT),m("#single-modal label").text(f.Msg.POPUP_VALUE),m("#singleModalInput").addClass("capitalLetters"),m("#single-modal a[href]").text(f.Msg.POPUP_STARTUP_HELP),m("#single-modal a[href]").attr("href","http://wiki.open-roberta.org")}),(function(){var e;e=m("#singleModalInput").val().toUpperCase(),p.validate(),p.valid()&&r.setToken(e,(function(o){"ok"===o.rc?(i.setRobotToken(e),i.setState(o),a.displayInformation(o,"MESSAGE_ROBOT_CONNECTED",o.message,i.getRobotName()),v(o["robot.update"],o["robot.serverVersion"])):"ORA_TOKEN_SET_ERROR_WRONG_ROBOTTYPE"===o.message&&m(".modal").modal("hide"),t.response(o)}))}),(function(){m("#singleModalInput").removeClass("capitalLetters")}),{rules:{singleModalInput:{required:!0,minlength:8,maxlength:8}},errorClass:"form-invalid",errorPlacement:function(e,o){e.insertAfter(o)},messages:{singleModalInput:{required:f.Msg.VALIDATION_FIELD_REQUIRED,minlength:f.Msg.VALIDATION_TOKEN_LENGTH,maxlength:f.Msg.VALIDATION_TOKEN_LENGTH}}})},o.showScanModal=function(){m("#show-available-connections").is(":visible")||(m("#connectionsTable").bootstrapTable("removeAll"),d.jsToAppInterface({target:i.getRobot(),type:"startScan"}),m("#show-available-connections").modal("show"))},o.showListModal=function(){t.showSingleListModal((function(){m("#single-modal-list h3").text(f.Msg.MENU_CONNECT),m("#single-modal-list label").text(f.Msg.POPUP_VALUE),m("#single-modal-list a[href]").text(f.Msg.POPUP_STARTUP_HELP),m("#single-modal-list a[href]").attr("href","http://wiki.open-roberta.org")}),(function(){w(document.getElementById("singleModalListInput").value)}),(function(){}))},o.handleFirmwareConflict=v,o.updateFirmware=R,o.switchRobot=function e(o,t,n,d){var p;function b(e,o){if(i.findGroup(e)!=i.getRobotGroup())return!1;var t=i.getExtensions(),n=Object.keys(o),a=Object.keys(i.getExtensions());if(n.length!==a.length)return!1;for(var r=0,s=n;r<s.length;r++){var l=s[r];if(o[l]!==t[l])return!1}return!0}s.SSID=null,s.password=null,document.getElementById("wlanSsid").value="",document.getElementById("wlanPassword").value="";var h=b(o,t);if(!n&&h?p=!0:(p=n||!1,f.clipboardXml_=null),p||i.isProgramSaved()&&i.isConfigurationSaved()){if(o===i.getRobot()&&h)return void("function"==typeof d&&d());r.setRobot(o,t,(function(e){if("ok"===e.rc){m(".rightMenuButton.rightActive").length>0&&m(".rightMenuButton.rightActive").clickWrap();var n=b(o,t);i.setExtensions(t),i.setRobot(o,e),n||(l.resetView(),s.resetView()),u.switchConnection(o),l.changeRobotSvg(),"tabConfList"==i.getView()&&m("#confList>.bootstrap-table").find('button[name="refresh"]').clickWrap(),"tabProgList"==i.getView()&&m("#progList>.bootstrap-table").find('button[name="refresh"]').clickWrap(),g.setCodeLanguage(i.getSourceCodeFileExtension()),c.setCodeLanguage(i.getSourceCodeFileExtension()),c.resetScroll(),"function"==typeof d?d():a.displayInformation(e,e.message,e.message,i.getRobotRealName());var r=i.getRobotDeprecatedData(o);void 0!==r&&(m("#show-message>.modal-dialog").removeClass("modal-sm"),m("#show-message").on("hidden.bs.modal",(function(){m("#show-message>.modal-dialog").addClass("modal-sm")})),a.displayPopupMessage(i.getLanguage(),r,"OK",!1))}else a.displayInformation(e,e.message,e.message,i.getRobotRealName())}))}else m("#show-message-confirm").oneWrap("shown.bs.modal",(function(n){m("#confirm").off(),m("#confirm").onWrap("click",(function(n){n.preventDefault(),e(o,t,!0,d)}),"confirm modal"),m("#confirmCancel").off(),m("#confirmCancel").onWrap("click",(function(e){e.preventDefault(),m(".modal").modal("hide")}),"cancel modal")})),i.isUserLoggedIn()?a.displayMessage("POPUP_BEFOREUNLOAD_LOGGEDIN","POPUP","",!0):a.displayMessage("POPUP_BEFOREUNLOAD","POPUP","",!0)}}));
//# sourceMappingURL=robot.controller.js.map
//# sourceMappingURL=robot.controller.js.map
