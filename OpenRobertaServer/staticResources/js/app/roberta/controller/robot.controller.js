define(["require","exports","util.roberta","log","message","guiState.controller","robot.model","program.controller","configuration.controller","webview.controller","sourceCodeEditor.controller","progCode.controller","jquery","blockly","connection.controller","jquery-validate"],(function(e,o,t,n,a,i,r,s,l,d,c,m,g,f,u){var p,b,w;function h(e){b=e,g("#single-modal-list").modal("hide"),i.setRobotPort(e)}function R(e,o){return e<0?(n.info("The firmware version '"+o+"' on the server is newer than the firmware version '"+i.getRobotVersion()+"' on the robot"),g("#confirmUpdateFirmware").modal("show"),!0):e>0&&(n.info("The firmware version '"+o+"' on the server is older than the firmware version '"+i.getRobotVersion()+"' on the robot"),a.displayMessage("MESSAGE_FIRMWARE_ERROR","POPUP",""),!0)}function v(){r.updateFirmware((function(e){i.setState(e),"ok"===e.rc?a.displayMessage("MESSAGE_RESTART_ROBOT","POPUP",""):a.displayInformation(e,"",e.message,i.getRobotFWName())}))}Object.defineProperty(o,"__esModule",{value:!0}),o.switchRobot=o.updateFirmware=o.handleFirmwareConflict=o.showListModal=o.showScanModal=o.showSetTokenModal=o.getPort=o.setPort=o.init=void 0,o.init=function(e){var o=g.Deferred();return g.when(r.setRobot(e,(function(o){"ok"==o.rc&&i.setRobot(e,o,!0)}))).then((function(){g("#iconDisplayRobotState").onWrap("click",(function(){w.showRobotInfo()}),"display robot state"),g("#wlan-form").removeData("validator"),g.validator.addMethod("wlanRegex",(function(e,o){return this.optional(o)||/^[a-zA-Z0-9$ *\(\)\{\}\[\]><~`\'\\\/|=+!?.,%#+&^@_\-äöüÄÖÜß]+$/gi.test(e)}),"This field contains nonvalid symbols."),g("#wlan-form").validate({rules:{wlanSsid:{required:!0,wlanRegex:!0},wlanPassword:{required:!0,wlanRegex:!0}},errorClass:"form-invalid",errorPlacement:function(e,o){e.insertBefore(o.parent())},messages:{wlanSsid:{required:f.Msg.VALIDATION_FIELD_REQUIRED,wlanRegex:f.Msg.VALIDATION_CONTAINS_SPECIAL_CHARACTERS},wlanPassword:{required:f.Msg.VALIDATION_FIELD_REQUIRED,wlanRegex:f.Msg.VALIDATION_CONTAINS_SPECIAL_CHARACTERS}}}),g("#setWlanCredentials").onWrap("click",(function(e){e.preventDefault(),g("#wlan-form").validate(),g("#wlan-form").valid()&&(s.setSSID(document.getElementById("wlanSsid").value),s.setPassword(document.getElementById("wlanPassword").value),g("#menu-wlan").modal("hide"))}),"wlan form submitted"),g("#doUpdateFirmware").onWrap("click",(function(){g("#set-token").modal("hide"),g("#confirmUpdateFirmware").modal("hide"),v()}),"update firmware of robot"),p=g("#single-modal-form"),g("#connectionsTable").bootstrapTable({formatNoMatches:function(){return'<div class="lds-ellipsis"></div>'},columns:[{title:"Name",field:"name"},{visible:!1,field:"id"}]}),g("#connectionsTable").onWrap("click-row.bs.table",(function(e,o){d.jsToAppInterface({target:i.getRobot(),type:"connect",robot:o.id})}),"connect to robot"),g("#show-available-connections").on("hidden.bs.modal",(function(e){d.jsToAppInterface({target:i.getRobot(),type:"stopScan"})})),g("#show-available-connections").onWrap("add",(function(e,o){g("#connectionsTable").bootstrapTable("insertRow",{index:999,row:{name:o.brickname,id:o.brickid}})}),"insert robot connections"),g("#show-available-connections").onWrap("connect",(function(e,o){var t={};t["robot.name"]=o.brickname,t["robot.state"]="wait",i.setState(t),g("#show-available-connections").modal("hide")}),"connect to a robot"),o.resolve()})),o.promise()},o.setPort=h,o.getPort=function(){return b},o.showSetTokenModal=function(){t.showSingleModal((function(){g("#singleModalInput").attr("type","text"),g("#single-modal h5").text(f.Msg.MENU_CONNECT),g("#single-modal label").text(f.Msg.POPUP_VALUE),g("#singleModalInput").addClass("capitalLetters"),g("#single-modal a[href]").text(f.Msg.POPUP_STARTUP_HELP),g("#single-modal a[href]").attr("href","http://wiki.open-roberta.org")}),(function(){var e;e=g("#singleModalInput").val().toUpperCase(),p.validate(),p.valid()&&r.setToken(e,(function(o){"ok"===o.rc?(i.setRobotToken(e),i.setState(o),a.displayInformation(o,"MESSAGE_ROBOT_CONNECTED",o.message,i.getRobotName()),R(o["robot.update"],o["robot.serverVersion"])):"ORA_TOKEN_SET_ERROR_WRONG_ROBOTTYPE"===o.message&&g(".modal").modal("hide"),t.response(o)}))}),(function(){g("#singleModalInput").removeClass("capitalLetters")}),{rules:{singleModalInput:{required:!0,minlength:8,maxlength:8}},errorClass:"form-invalid",errorPlacement:function(e,o){e.insertAfter(o)},messages:{singleModalInput:{required:f.Msg.VALIDATION_FIELD_REQUIRED,minlength:f.Msg.VALIDATION_TOKEN_LENGTH,maxlength:f.Msg.VALIDATION_TOKEN_LENGTH}}})},o.showScanModal=function(){g("#show-available-connections").is(":visible")||(g("#connectionsTable").bootstrapTable("removeAll"),d.jsToAppInterface({target:i.getRobot(),type:"startScan"}),g("#show-available-connections").modal("show"))},o.showListModal=function(){t.showSingleListModal((function(){g("#single-modal-list h3").text(f.Msg.MENU_CONNECT),g("#single-modal-list label").text(f.Msg.POPUP_VALUE),g("#single-modal-list a[href]").text(f.Msg.POPUP_STARTUP_HELP),g("#single-modal-list a[href]").attr("href","http://wiki.open-roberta.org")}),(function(){h(document.getElementById("singleModalListInput").value)}),(function(){}))},o.handleFirmwareConflict=R,o.updateFirmware=v,o.switchRobot=function e(o,t,n){var d;if(s.SSID=null,s.password=null,document.getElementById("wlanSsid").value="",document.getElementById("wlanPassword").value="",void 0===t&&i.findGroup(o)==i.getRobotGroup()?d=!0:(d=t||!1,f.clipboardXml_=null),d||i.isProgramSaved()&&i.isConfigurationSaved()){if(o===i.getRobot())return void("function"==typeof n&&n());r.setRobot(o,(function(e){if("ok"===e.rc){g(".rightMenuButton.rightActive").length>0&&g(".rightMenuButton.rightActive").clickWrap(),i.findGroup(o)!=i.getRobotGroup()?(i.setRobot(o,e),l.resetView(),s.resetView()):i.setRobot(o,e),u.switchConnection(o),l.changeRobotSvg(),"tabConfList"==i.getView()&&g("#confList>.bootstrap-table").find('button[name="refresh"]').clickWrap(),"tabProgList"==i.getView()&&g("#progList>.bootstrap-table").find('button[name="refresh"]').clickWrap(),m.setCodeLanguage(i.getSourceCodeFileExtension()),c.setCodeLanguage(i.getSourceCodeFileExtension()),c.resetScroll(),"function"==typeof n?n():a.displayInformation(e,e.message,e.message,i.getRobotRealName());var t=i.getRobotDeprecatedData(o);void 0!==t&&(g("#show-message>.modal-dialog").removeClass("modal-sm"),g("#show-message").on("hidden.bs.modal",(function(){g("#show-message>.modal-dialog").addClass("modal-sm")})),a.displayPopupMessage(i.getLanguage(),t,"OK",!1))}else a.displayInformation(e,e.message,e.message,i.getRobotRealName())}))}else g("#show-message-confirm").oneWrap("shown.bs.modal",(function(t){g("#confirm").off(),g("#confirm").onWrap("click",(function(t){t.preventDefault(),e(o,!0,n)}),"confirm modal"),g("#confirmCancel").off(),g("#confirmCancel").onWrap("click",(function(e){e.preventDefault(),g(".modal").modal("hide")}),"cancel modal")})),i.isUserLoggedIn()?a.displayMessage("POPUP_BEFOREUNLOAD_LOGGEDIN","POPUP","",!0):a.displayMessage("POPUP_BEFOREUNLOAD","POPUP","",!0)}}));
//# sourceMappingURL=robot.controller.js.map
//# sourceMappingURL=robot.controller.js.map
