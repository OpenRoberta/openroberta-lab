var __extends=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),__awaiter=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function a(t){try{c(o.next(t))}catch(t){i(t)}}function s(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))},__generator=this&&this.__generator||function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,o=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};define(["require","exports","abstract.connections","jquery","guiState.controller","program.model","util.roberta","message","guiState.model","robot.controller","dapjs","blockly","thymio","program.controller","webview.controller","comm","log","socket.io","connection.controller"],(function(t,e,n,o,r,i,a,s,c,l,u,d,p,h,m,f,b,g,v){Object.defineProperty(e,"__esModule",{value:!0}),e.LocalConnection=e.WedoConnection=e.ThymioConnection=e.Txt4Connection=e.SpikeConnection=e.SpikePybricksConnection=e.RobotinoROSConnection=e.RobotinoConnection=e.NxtConnection=e.NaoConnection=e.Calliopev3Connection=e.Microbitv2Connection=e.MicrobitConnection=e.JoycarConnection=e.Calliope2017NoBlueConnection=e.Calliope2017Connection=e.Calliope2016Connection=e.XNNConnection=e.Ev3lejosv1Connection=e.Ev3lejosv0Connection=e.Ev3devConnection=e.Ev3c4ev3Connection=e.EdisonConnection=e.Mbot2Connection=e.Unowifirev2Connection=e.UnoConnection=e.SenseboxConnection=e.Rob3rtaConnection=e.Nano33bleConnection=e.NanoConnection=e.MegaConnection=e.MbotConnection=e.FestobionicConnection=e.FestobionicflowerConnection=e.BotnrollConnection=e.Bob3Connection=e.AudioConnection=void 0;var _=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.run=function(t){if("ok"!==t.rc)r.setConnectionState("wait"),s.displayInformation(t,t.message,t.message,r.getProgramName(),r.getRobot());else{var e,n=a.base64decode(t.compiledCode);if(o("#changedDownloadFolder").addClass("hidden"),window.msCrypto)this.createDownloadLink(r.getProgramName()+".wav",n);else{o("#OKButtonModalFooter").addClass("hidden");var i=new Blob([n],{type:"audio/wav"});e=new Audio(window.URL.createObjectURL(i)),this.createPlayButton(e)}var c=o("#popupDownloadHeader").text();o("#popupDownloadHeader").text(c.replace("$",o.trim(r.getRobotRealName())));for(var l=1;d.Msg["POPUP_DOWNLOAD_STEP_"+l];l++){var u=o('<li class="typcn typcn-roberta">'),p=d.Msg["POPUP_DOWNLOAD_STEP_"+l+"_"+r.getRobotGroup().toUpperCase()]||d.Msg["POPUP_DOWNLOAD_STEP_"+l]||"POPUP_DOWNLOAD_STEP_"+l;u.html('<span class="download-message">'+p+"</span>"),u.css("opacity","0"),o("#download-instructions").append(u)}o("#save-client-compiled-program").oneWrap("shown.bs.modal",(function(t){o("#download-instructions li").each((function(t){o(this).delay(750*t).animate({opacity:1},1e3)}))})),o("#save-client-compiled-program").oneWrap("hidden.bs.modal",(function(n){window.msCrypto||(e.pause(),e.load());var i=o("#popupDownloadHeader").text();o("#popupDownloadHeader").text(i.replace(o.trim(r.getRobotRealName()),"$")),o("#programLink").remove(),o("#download-instructions").empty(),r.setConnectionState("wait"),s.displayInformation(t,t.message,t.message,r.getProgramName(),r.getRobot()),o("#changedDownloadFolder").removeClass("hidden"),o("#OKButtonModalFooter").removeClass("hidden")})),o("#save-client-compiled-program").modal("show")}},e.prototype.terminate=function(){t.prototype.terminate.call(this),this.clearDownloadModal()},e.prototype.setState=function(){},e.prototype.createPlayButton=function(t){var e;if(o("#trA").removeClass("hidden"),"Blob"in window){(e=document.createElement("button")).setAttribute("type","button"),e.setAttribute("class","btn btn-primary");var n=!1;e.onclick=function(){0==n?(t.play(),r.setAttribute("class","typcn typcn-media-stop"),n=!0,t.addEventListener("ended",(function(){o("#save-client-compiled-program").modal("hide")}))):(r.setAttribute("class","typcn typcn-media-play"),t.pause(),t.load(),n=!1)};var r=document.createElement("span");r.setAttribute("class","typcn typcn-media-play"),r.setAttribute("style","color : black"),e.appendChild(r)}if(e){var i=document.createElement("div");i.setAttribute("id","programLink"),i.setAttribute("style","text-align: center;"),i.appendChild(document.createElement("br")),i.appendChild(e),e.setAttribute("style","font-size:36px"),o("#downloadLink").append(i)}},e}(n.AbstractPromptConnection);e.AudioConnection=_;var C,y,w,R=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selectedNode=void 0,e.startTime=void 0,e.terminated=!1,e}return __extends(e,t),e.prototype.runOnBrick=function(t,e,n){var o=this;i.showSourceProgram(r.getProgramName(),t,e,n,h.getSSID(),h.getPassword(),r.getLanguage(),(function(t){o.run(t),h.reloadProgram(t)}))},e.prototype.init=function(){r.setPing(!0),r.setPingTime(r.SHORT),r.getBlocklyWorkspace().robControls.showStopProgram(),this.initNode()},e.prototype.initNode=function(){var t=this;this.terminated?this.terminate():this.selectedNode?this.selectedNode.status==p.NodeStatus.ready&&this.publishConnected():(this.client=p.createClient(e.URL),this.client.onClose=function(e){t.selectedNode=void 0,t.publishDisonnected(),setTimeout((function(){t.initNode()}),1e3)},this.client.onNodesChanged=function(e){return __awaiter(t,void 0,void 0,(function(){var t,n,o,i;return __generator(this,(function(a){switch(a.label){case 0:a.trys.push([0,8,,9]),t=0,n=e,a.label=1;case 1:if(!(t<n.length))return[3,7];if(o=n[t],this.selectedNode&&this.selectedNode.id!=o.id)return[3,6];if(this.selectedNode&&(this.selectedNode.status==p.NodeStatus.ready||o.status!=p.NodeStatus.available))return[3,5];a.label=2;case 2:return a.trys.push([2,4,,5]),[4,o.lock()];case 3:return a.sent(),this.selectedNode=o,this.publishConnected(),[3,5];case 4:return a.sent(),console.log("Unable To Lock ".concat(o.id," (").concat(o.name,")")),[3,5];case 5:if(!this.selectedNode)return[3,6];this.selectedNode.status==p.NodeStatus.disconnected&&(this.selectedNode=void 0,r.updateMenuStatus(0),this.initNode()),a.label=6;case 6:return t++,[3,1];case 7:return[3,9];case 8:return i=a.sent(),console.log(i),[3,9];case 9:return[2]}}))}))})},e.prototype.isRobotConnected=function(){return null!=this.selectedNode||!1},e.prototype.run=function(t){o("#menuRunProg").parent().addClass("disabled"),r.setConnectionState("busy"),c.robot.state="busy",r.setState(t),"ok"==t.rc?(this.uploadProgram(t.sourceCode).then((function(e){"done"==e&&s.displayInformation(t,"MESSAGE_EDIT_START",t.message,r.getProgramName(),r.getRobot())}),(function(t){s.displayInformation({rc:"error"},null,t,r.getProgramName(),r.getRobot())})),setTimeout((function(){r.setConnectionState("wait"),c.robot.state="wait"}),1e3)):(r.setConnectionState("wait"),c.robot.state="wait",s.displayInformation(t,t.message,t.message,r.getProgramName(),r.getRobot()))},e.prototype.setState=function(){v.getIsAgent()||(o("#menuConnect").parent().removeClass("disabled"),"wait"===c.robot.state?(o("#head-navi-icon-robot").removeClass("error"),o("#head-navi-icon-robot").removeClass("busy"),o("#head-navi-icon-robot").addClass("wait"),r.setRunEnabled(!0),o("#runSourceCodeEditor").removeClass("disabled")):"busy"===c.robot.state?(o("#head-navi-icon-robot").removeClass("wait"),o("#head-navi-icon-robot").removeClass("error"),o("#head-navi-icon-robot").addClass("busy"),r.setRunEnabled(!1),o("#runSourceCodeEditor").addClass("disabled")):(o("#head-navi-icon-robot").removeClass("busy"),o("#head-navi-icon-robot").removeClass("wait"),o("#head-navi-icon-robot").addClass("error"),r.setRunEnabled(!1),o("#runSourceCodeEditor").addClass("disabled")))},e.prototype.terminate=function(){t.prototype.terminate.call(this),this.terminated=!0,this.selectedNode=void 0,this.publishDisonnected(),c.gui.blocklyWorkspace.robControls.hideStopProgram()},e.prototype.publishConnected=function(){this.startTime=Date.now(),c.robot.fWName=r.getRobotRealName(),c.robot.time=0,c.robot.battery="-",c.robot.name=this.selectedNode.name,c.robot.state="wait",r.updateMenuStatus(1)},e.prototype.publishDisonnected=function(){c.robot.fWName="",c.robot.time=-1,c.robot.battery="-",c.robot.name="",c.robot.state="error",r.updateMenuStatus(0)},e.prototype.uploadProgram=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(c.robot.time=this.startTime-Date.now(),!this.selectedNode||this.selectedNode.status!==p.NodeStatus.ready)return[3,8];e.label=1;case 1:return e.trys.push([1,6,,7]),[4,this.selectedNode.lock()];case 2:return e.sent(),[4,this.selectedNode.sendAsebaProgram(t)];case 3:return e.sent(),[4,this.selectedNode.runProgram()];case 4:return e.sent(),[4,this.selectedNode.unlock()];case 5:return e.sent(),[2,"done"];case 6:throw e.sent();case 7:return[3,9];case 8:throw new Error("Exception on upload program");case 9:return[2]}}))}))},e.prototype.stopProgram=function(){this.uploadProgram(e.STOP_PROGRAM).then((function(t){"done"==t&&s.displayInformation({rc:"ok"},"MESSAGE_EDIT_START",null,r.getProgramName(),r.getRobot())}),(function(t){s.displayInformation({rc:"error"},null,t,r.getProgramName(),r.getRobot())}))},e.URL="ws://localhost:8597",e.STOP_PROGRAM="motor.left.target = 0\nmotor.right.target = 0\ncall sound.system(-1)\ncall leds.circle(32,32,32,32,32,32,32,32)\ntimer.period[0] = 100\nonevent timer0\ncall leds.circle(0,0,0,0,0,0,0,0)\n",e}(n.AbstractConnection);!function(t){t[t.DEVICE_INFORMATION_SERVICE_UUID=6154]="DEVICE_INFORMATION_SERVICE_UUID",t.NORDIC_UART_SERVICE_UUID="6e400001-b5a3-f393-e0a9-e50e24dcca9e",t.PYBRICKS_SERVICE_UUID="c5f50001-8280-46da-89f4-6d8051e4aeef",t.PYBRICKS_COMMAND_EVENT_UUID="c5f50002-8280-46da-89f4-6d8051e4aeef",t.PYBRICKS_HUB_CAPABILITIES_CHARACTERISTIC_UUID="c5f50003-8280-46da-89f4-6d8051e4aeef"}(C||(C={})),function(t){t[t.STOP_USER_PROGRAM=0]="STOP_USER_PROGRAM",t[t.START_USER_PROGRAM=1]="START_USER_PROGRAM",t[t.START_REPL=2]="START_REPL",t[t.WRITE_USER_PROGRAM_META=3]="WRITE_USER_PROGRAM_META",t[t.COMMAND_WRITE_USER_RAM=4]="COMMAND_WRITE_USER_RAM",t[t.PBIO_PYBRICKS_COMMAND_REBOOT_TO_UPDATE_MODE=5]="PBIO_PYBRICKS_COMMAND_REBOOT_TO_UPDATE_MODE",t[t.WRITE_STDIN=6]="WRITE_STDIN"}(y||(y={})),function(t){t[t.PASS=0]="PASS",t[t.INFORMATION=1]="INFORMATION",t[t.ALERT=2]="ALERT"}(w||(w={}));var P=function(t){function e(n,o,r){var i=t.call(this," ")||this;return i.blocklyMessage="",i.alertType=w.PASS,void 0!==n&&null!=n&&(i.message=n.message),i.blocklyMessage=o,i.alertType=r,i.name=e.NAME,i}return __extends(e,t),e.NAME="BleError",e}(Error),S=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.gattServer=null,e.bleDevice=null,e.downloadInProgress=!1,e.oldProgram="",e.ping=!1,e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),r.getBlocklyWorkspace().robControls.showStopProgram(),o("#stopProgram").addClass("disabled")},e.prototype.terminate=function(){t.prototype.terminate.call(this),o("#stopProgram").addClass("disabled"),r.getBlocklyWorkspace().robControls.hideStopProgram(),this.disconnect()},e.prototype.run=function(t){return __awaiter(this,void 0,void 0,(function(){var e,n=this;return __generator(this,(function(i){switch(i.label){case 0:if("ok"!=t.rc)return[3,5];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.connect().then((function(){return __awaiter(n,void 0,void 0,(function(){var e=this;return __generator(this,(function(n){switch(n.label){case 0:return this.showProgressBarModal(),this.setResetModalListener(),[4,this.downloadProgram(t.compiledCode,this.setTransferProgress).then((function(){return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(t){return setTimeout((function(){o("#save-client-compiled-program").modal("hide")}),500),[2]}))}))})).finally((function(){e.downloadInProgress||e.startPingDevice()}))];case 1:return n.sent(),[2]}}))}))}))];case 2:return i.sent(),[3,4];case 3:return e=i.sent(),console.log(e),e.name===P.NAME&&(console.log(e.blocklyMessage),e.alertType===w.ALERT&&("BLE_ERROR_COMMUNICATION"==e.blocklyMessage&&o("#save-client-compiled-program").modal("hide"),s.displayInformation({rc:"error"},null,e.blocklyMessage))),[3,4];case 4:return[3,6];case 5:s.displayInformation(t,t.message,t.message,r.getProgramName(),r.getRobot()),i.label=6;case 6:return o("#head-navi-icon-robot").removeClass("error"),o("#head-navi-icon-robot").removeClass("busy"),o("#head-navi-icon-robot").addClass("wait"),r.setRunEnabled(!0),o("#stopProgram").addClass("disabled"),[2]}}))}))},e.prototype.stopProgram=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.writeGatt(C.PYBRICKS_COMMAND_EVENT_UUID,new Uint8Array([y.STOP_USER_PROGRAM]))];case 1:return e.sent(),[3,3];case 2:throw t=e.sent(),new P(t,"BLE_ERROR_STOP",w.INFORMATION);case 3:return[2]}}))}))},e.prototype.setState=function(){},e.prototype.showRobotInfo=function(){t.prototype.showRobotInfo.call(this)},e.prototype.stopPingDevice=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return this.ping=!1,[4,new Promise((function(t){return setTimeout(t,500)}))];case 1:return t.sent(),[2]}}))}))},e.prototype.startPingDevice=function(){this.ping=!0,this.pingDevice()},e.prototype.pingDevice=function(){return __awaiter(this,void 0,void 0,(function(){var t=this;return __generator(this,(function(e){return this.ping&&this.isConnected()?(o("#stopProgram").removeClass("disabled"),setTimeout((function(){o("#stopProgram").removeClass("disabled"),t.pingDevice()}),250)):o("#stopProgram").addClass("disabled"),[2]}))}))},e.prototype.connect=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.stopPingDevice()];case 1:return t.sent(),this.isConnected()?[2]:[4,this.assertWebBleAvailability()];case 2:return t.sent(),[4,this.requestDevice()];case 3:return t.sent(),[4,this.connectToGattServer()];case 4:return t.sent(),[4,this.getHubCapabilities()];case 5:return t.sent(),[2]}}))}))},e.prototype.downloadProgram=function(t,n){return __awaiter(this,void 0,void 0,(function(){var o,r,i;return __generator(this,(function(a){switch(a.label){case 0:if(o=e.encodeProgram(t),r=this.maxWriteSize-e.HEADER_SIZE,this.downloadInProgress)throw new P(null,"BLE_DOWNLOAD_IN_PROGRESS",w.INFORMATION);if(o.size>this.maxProgramSize)throw new P(null,"BLE_ERROR_PROGRAM_SIZE",w.ALERT);return this.downloadInProgress||this.oldProgram!=t?[3,3]:(n(1),[4,this.stopProgram()]);case 1:return a.sent(),[4,this.startProgram()];case 2:return[2,a.sent()];case 3:return a.trys.push([3,9,10,11]),this.downloadInProgress=!0,[4,this.stopProgram()];case 4:return a.sent(),[4,this.invalidateProgram()];case 5:return a.sent(),[4,this.transferProgramAsChunks(o,r,n)];case 6:return a.sent(),[4,this.updateProgramSize(o.size)];case 7:return a.sent(),this.oldProgram=t,[4,this.startProgram()];case 8:return a.sent(),[3,11];case 9:throw i=a.sent(),this.oldProgram="",new P(i,"BLE_ERROR_COMMUNICATION",w.ALERT);case 10:return this.downloadInProgress=!1,[7];case 11:return[2]}}))}))},e.prototype.disconnect=function(){null!=this.gattServer&&this.gattServer.disconnect(),this.gattServer=null,this.bleDevice=null},e.prototype.isConnected=function(){return null!==this.gattServer&&this.gattServer.connected},e.prototype.assertWebBleAvailability=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:if(!a.isWebBleSupported())throw new P(null,"BLE_NOT_SUPPORTED",w.ALERT);if(void 0===navigator.bluetooth)throw new P(null,"BLE_FEATURE_DISABLED",w.ALERT);return[4,navigator.bluetooth.getAvailability()];case 1:if(!t.sent())throw new P(null,"BLE_ADAPTER_DISABLED",w.ALERT);return[2]}}))}))},e.prototype.requestDevice=function(){return __awaiter(this,void 0,void 0,(function(){var t,e;return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=this,[4,navigator.bluetooth.requestDevice({filters:[{services:[C.PYBRICKS_SERVICE_UUID]}],optionalServices:[C.PYBRICKS_SERVICE_UUID,C.DEVICE_INFORMATION_SERVICE_UUID,C.NORDIC_UART_SERVICE_UUID]})];case 1:return t.bleDevice=n.sent(),[3,3];case 2:throw e=n.sent(),new P(e,"BLE_NO_DEVICE_SELECTED",w.ALERT);case 3:return[2]}}))}))},e.prototype.connectToGattServer=function(){return __awaiter(this,void 0,void 0,(function(){var t,e=this;return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.bleDevice.gatt.connect().then((function(t){return e.gattServer=t}))];case 1:return n.sent(),[3,3];case 2:throw t=n.sent(),new P(t,"BLE_ERROR_DEVICE_BUSY",w.ALERT);case 3:return[2]}}))}))},e.prototype.getHubCapabilities=function(){return __awaiter(this,void 0,void 0,(function(){var t,e=this;return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.gattServer.getPrimaryService(C.PYBRICKS_SERVICE_UUID).then((function(t){return __awaiter(e,void 0,void 0,(function(){var e=this;return __generator(this,(function(n){switch(n.label){case 0:return[4,t.getCharacteristic(C.PYBRICKS_HUB_CAPABILITIES_CHARACTERISTIC_UUID).then((function(t){return __awaiter(e,void 0,void 0,(function(){var e;return __generator(this,(function(n){switch(n.label){case 0:return[4,t.readValue()];case 1:return e=n.sent(),this.maxWriteSize=e.getUint16(0,!0),this.maxProgramSize=e.getUint32(6,!0),[2]}}))}))}))];case 1:return n.sent(),[2]}}))}))}))];case 1:return n.sent(),[3,3];case 2:throw t=n.sent(),new P(t,"BLE_ERROR_CAPABILITIES",w.ALERT);case 3:return[2]}}))}))},e.prototype.transferProgramAsChunks=function(t,e,n){return __awaiter(this,void 0,void 0,(function(){var o,r,i;return __generator(this,(function(a){switch(a.label){case 0:o=t.size>e?e:t.size,r=0,a.label=1;case 1:return r<t.size?[4,t.slice(r,r+o).arrayBuffer()]:[3,5];case 2:return i=a.sent(),[4,this.writeToUserRam(r,i)];case 3:a.sent(),null!==n&&n((r+i.byteLength)/t.size),a.label=4;case 4:return r+=o,[3,1];case 5:return[2]}}))}))},e.prototype.writeGatt=function(t,e){return __awaiter(this,void 0,void 0,(function(){var n=this;return __generator(this,(function(o){switch(o.label){case 0:return[4,this.gattServer.getPrimaryService(C.PYBRICKS_SERVICE_UUID).then((function(o){return __awaiter(n,void 0,void 0,(function(){var n=this;return __generator(this,(function(r){switch(r.label){case 0:return[4,o.getCharacteristic(t).then((function(t){return __awaiter(n,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,t.writeValueWithResponse(e)];case 1:return n.sent(),[2]}}))}))}))];case 1:return r.sent(),[2]}}))}))}))];case 1:return o.sent(),[2]}}))}))},e.prototype.startProgram=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.writeGatt(C.PYBRICKS_COMMAND_EVENT_UUID,new Uint8Array([y.START_USER_PROGRAM]))];case 1:return t.sent(),[2]}}))}))},e.prototype.writeToUserRam=function(t,n){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(o){switch(o.label){case 0:return[4,this.writeGatt(C.PYBRICKS_COMMAND_EVENT_UUID,e.createWriteUserRamCommand(t,n))];case 1:return o.sent(),[2]}}))}))},e.prototype.updateProgramSize=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this.writeGatt(C.PYBRICKS_COMMAND_EVENT_UUID,e.createWriteUserProgramMetaCommand(t))];case 1:return n.sent(),[2]}}))}))},e.prototype.invalidateProgram=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.updateProgramSize(0)];case 1:return t.sent(),[2]}}))}))},e.encodeProgram=function(t){var n=e.encodeMpyBinary(t),o=[];return o.push(e.encodeProgramLength(n.length)),o.push(e.encodeProgramName("__main__")),o.push(n),new Blob(o)},e.encodeMpyBinary=function(t){for(var e=t.split(","),n=new Uint8Array(e.length),o=0;o<e.length;o++)n[o]=Number(e[o]);return n},e.encodeProgramLength=function(t){var e=new ArrayBuffer(4);return new DataView(e).setUint32(0,t,!0),e},e.encodeProgramName=function(t){return(new TextEncoder).encode(t+"\0")},e.createWriteUserRamCommand=function(t,n){var o=new Uint8Array(e.HEADER_SIZE+n.byteLength),r=new DataView(o.buffer);return r.setUint8(0,y.COMMAND_WRITE_USER_RAM),r.setUint32(1,t,!0),o.set(new Uint8Array(n),e.HEADER_SIZE),o},e.createWriteUserProgramMetaCommand=function(t){var n=new Uint8Array(e.HEADER_SIZE),o=new DataView(n.buffer);return o.setUint8(0,y.WRITE_USER_PROGRAM_META),o.setUint32(1,t,!0),n},e.HEADER_SIZE=5,e}(n.AbstractPromptConnection),E=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.isSelected=!1,this.shortFormForDownloadPopup=r.getRobotGroup().toUpperCase()},e.prototype.run=function(t){var e=this;if(r.setState(t),"ok"==t.rc){var n=!1;if(a.isWebUsbSupported()&&r.getVendor()&&"na"!==r.getVendor()){n=!0;var i=o("#popupDownloadHeader").text();o("#popupDownloadHeader").text(i.replace("$",o.trim(r.getRobotRealName()))),o("#programHint").addClass("hidden"),o("#changedDownloadFolder").addClass("hidden"),o("#OKButtonModalFooter").addClass("hidden"),this.isWebUsbSelected()?this.runWebUsbConnection(t):(o("#downloadType").removeClass("hidden"),o("#webUsb").oneWrap("click",(function(n){e.setIsWebUsbSelected(!0),e.runWebUsbConnection(t)})),o("#fileDownload").oneWrap("click",(function(n){o("#downloadType").addClass("hidden"),o("#programHint").removeClass("hidden"),o("#changedDownloadFolder").removeClass("hidden"),o("#OKButtonModalFooter").removeClass("hidden"),e.runFileDownload(t,e.shortFormForDownloadPopup,e.skipDownloadPopup)})))}else this.runFileDownload(t,this.shortFormForDownloadPopup,this.skipDownloadPopup);if(n=n||!(this.skipDownloadPopup||null!==navigator.userAgent.toLowerCase().match(/iPad|iPhone|android/i))){i=o("#popupDownloadHeader").text();o("#popupDownloadHeader").text(i.replace("$",o.trim(r.getRobotRealName()))),o("#save-client-compiled-program").oneWrap("hidden.bs.modal",(function(t){var n=o("#popupDownloadHeader").text();o("#popupDownloadHeader").text(n.replace(o.trim(r.getRobotRealName()),"$")),o("#label-checkbox").is(":checked")&&e.setSkipDownloadPopup(!0),o("#programLink").remove(),o("#download-instructions").empty(),o("#programHint").removeClass("hidden"),o("#changedDownloadFolder").removeClass("hidden"),o("#OKButtonModalFooter").removeClass("hidden"),o("#downloadType").addClass("hidden"),o("#status").addClass("hidden"),o("#progressBar").width("0%"),o("#transfer").text("0%"),o("#webUsb").off("click"),o("#fileDownload").off("click"),r.setConnectionState("wait")})),o("#save-client-compiled-program").modal("show")}}else r.setConnectionState("wait"),s.displayInformation(t,t.message,t.message,r.getProgramName(),r.getRobot())},e.prototype.terminate=function(){t.prototype.terminate.call(this),this.clearDownloadModal(),this.isConnected()&&this.removeDevice()},e.prototype.runWebUsbConnection=function(t){var e=this;o("#downloadType").addClass("hidden"),o("#status").removeClass("hidden"),this.connect(r.getVendor(),t.compiledCode).then((function(n){"done"==n?s.displayInformation(t,"MESSAGE_EDIT_START",t.message,r.getProgramName(),r.getRobot()):"disconnected"==n?setTimeout((function(){e.runWebUsbConnection(t)}),100):"flashing"==n||o("#save-client-compiled-program").modal("hide"),r.setConnectionState("wait"),c.robot.state="wait"}))},e.prototype.setState=function(){},e.prototype.connect=function(t,e){return __awaiter(this,void 0,void 0,(function(){var n,o;return __generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),void 0!==this.device?[3,2]:(n=this,[4,navigator.usb.requestDevice({filters:this.deviceFilters(t)})]);case 1:n.device=i.sent(),i.label=2;case 2:return[4,this.upload(e)];case 3:return[2,i.sent()];case 4:return(o=i.sent()).message&&-1===o.message.indexOf("selected")&&s.displayInformation({rc:"error"},null,o.message,r.getProgramName(),r.getRobot()),[3,5];case 5:return[2]}}))}))},e.prototype.upload=function(t){return __awaiter(this,void 0,void 0,(function(){var e,n,o,i=this;return __generator(this,(function(a){switch(a.label){case 0:return a.trys.push([0,6,,7]),void 0!==this.target&&this.target.connected?[3,4]:(e=new u.WebUSB(this.device),this.target=new u.DAPLink(e),n=this.stringToArrayBuffer(t),this.target.on(u.DAPLink.EVENT_PROGRESS,(function(t){i.setTransferProgress(t)})),[4,this.target.connect()]);case 1:return a.sent(),[4,this.target.flash(n)];case 2:return a.sent(),[4,this.target.disconnect()];case 3:return a.sent(),[3,5];case 4:return[2,"flashing"];case 5:return[3,7];case 6:return o=a.sent(),this.removeDevice(),o.message&&-1!==o.message.indexOf("disconnected")?[2,"disconnected"]:(s.displayInformation({rc:"error"},null,o.message,r.getProgramName(),r.getRobot()),[2,"error"]);case 7:return[2,"done"]}}))}))},e.prototype.deviceFilters=function(t){for(var e=new Array,n=0,o=t.split(",");n<o.length;n++){var r=o[n];e.push({vendorId:+r})}return e},e.prototype.stringToArrayBuffer=function(t){return(new TextEncoder).encode(t)},e.prototype.removeDevice=function(){this.target=void 0,this.device=void 0},e.prototype.isConnected=function(){return void 0!==this.device},e.prototype.isWebUsbSelected=function(){return this.isSelected},e.prototype.setIsWebUsbSelected=function(t){this.isSelected=t},e}(n.AbstractPromptConnection),A=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){o("#head-navi-icon-robot").removeClass("error"),o("#head-navi-icon-robot").removeClass("busy"),o("#head-navi-icon-robot").removeClass("wait"),r.setRunEnabled(!1),o("#runSourceCodeEditor").addClass("disabled"),o("#menuConnect").parent().removeClass("disabled"),r.setPingTime(r.SHORT),r.setPing(!0)},e.prototype.setState=function(){o("#menuConnect").parent().removeClass("disabled"),"wait"===c.robot.state?(o("#head-navi-icon-robot").removeClass("error"),o("#head-navi-icon-robot").removeClass("busy"),o("#head-navi-icon-robot").addClass("wait"),r.setRunEnabled(!0),o("#runSourceCodeEditor").removeClass("disabled")):"busy"===c.robot.state?(o("#head-navi-icon-robot").removeClass("wait"),o("#head-navi-icon-robot").removeClass("error"),o("#head-navi-icon-robot").addClass("busy"),r.setRunEnabled(!1),o("#runSourceCodeEditor").addClass("disabled")):(o("#head-navi-icon-robot").removeClass("busy"),o("#head-navi-icon-robot").removeClass("wait"),o("#head-navi-icon-robot").addClass("error"),r.setRunEnabled(!1),o("#runSourceCodeEditor").addClass("disabled"))},e.prototype.isRobotConnected=function(){return c.robot.time>0},e.prototype.run=function(t){r.setState(t),s.displayInformation(t,t.message,t.message,t.programName||r.getProgramName(),r.getRobot()),"ok"==t.rc?d.Msg["MENU_ROBOT_STOP_HINT_"+r.getRobotGroup().toUpperCase()]&&s.displayMessage("MENU_ROBOT_STOP_HINT_"+r.getRobotGroup().toUpperCase(),"TOAST"):r.setConnectionState("error")},e.prototype.showConnectionModal=function(){o("#buttonCancelFirmwareUpdate").css("display","inline"),o("#buttonCancelFirmwareUpdateAndRun").css("display","none"),l.showSetTokenModal(8,8)},e.prototype.stopProgram=function(){i.stopProgram((function(){}))},e}(n.AbstractConnection);function I(t){t=t.toLowerCase();for(var e=0,n=r.getVendor().split(",");e<n.length;e++){if(n[e]===t)return!0}return!1}var T=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.portList=[],e.vendorList=[],e.productList=[],e.robotList=[],e.agentPortList='[{"Name":"none","IdVendor":"none","IdProduct":"none"}]',e}return __extends(e,t),e.prototype.init=function(){var e=this;t.prototype.init.call(this);var n=v.getSocket();null!=n&&0!=v.getIsAgent()||(n=g("ws://127.0.0.1:8991/"),v.setSocket(n),v.setIsAgent(!0),o("#menuConnect").parent().addClass("disabled"),n.on("connect_error",(function(t){v.setIsAgent(!1)})),n.on("connect",(function(){n.emit("command","log on"),v.setIsAgent(!0),window.setInterval((function(){e.portList=[],e.vendorList=[],e.productList=[],e.robotList=[],n.emit("command","list")}),3e3)})),n.on("message",(function(t){if(t.includes('"Network": false'))(i=JSON.parse(t)).Ports.forEach((function(t){I(t.VendorID)&&(e.portList.push(t.Name),e.vendorList.push(t.VendorID),e.productList.push(t.ProductID),e.robotList.push(r.getRobotRealName()))})),v.setIsAgent(!0),n.on("connect_error",(function(t){v.setIsAgent(!1),o("#menuConnect").parent().removeClass("disabled")})),e.portList.indexOf(r.getRobotPort())<0&&(r.getRobotPort(),r.setRobotPort("")),1==e.portList.length&&l.setPort(e.portList[0]),r.updateMenuStatus(e.getPortList().length);else if(t.includes("OS")){var i=JSON.parse(t);e.system=i.OS}})),n.on("disconnect",(function(){})),n.on("error",(function(t){}))),this.listRobotStart()},e.prototype.isRobotConnected=function(){return!0},e.prototype.terminate=function(){this.listRobotStop(),this.closeConnection(),t.prototype.terminate.call(this)},e.prototype.showConnectionModal=function(){if(1==v.getIsAgent()){var e=this.getPortList(),n=this.getRobotList();o("#singleModalListInput").empty();var r=0;e.forEach((function(t){o("#singleModalListInput").append('<option value="'+t+'" selected>'+n[r]+" "+t+"</option>"),r++})),l.showListModal()}else t.prototype.showConnectionModal.call(this)},e.prototype.run=function(t){o("#menuRunProg").parent().addClass("disabled"),o("#head-navi-icon-robot").addClass("busy"),r.setState(t),"ok"==t.rc?(this.uploadProgram(t.compiledCode,r.getRobotPort()),setTimeout((function(){r.setConnectionState("error")}),5e3)):r.setConnectionState("error"),s.displayInformation(t,t.message,t.message,r.getProgramName())},e.prototype.setState=function(){!0!==v.getIsAgent()&&(o("#menuConnect").parent().removeClass("disabled"),"wait"===c.robot.state?(o("#head-navi-icon-robot").removeClass("error"),o("#head-navi-icon-robot").removeClass("busy"),o("#head-navi-icon-robot").addClass("wait"),r.setRunEnabled(!0),o("#runSourceCodeEditor").removeClass("disabled")):"busy"===c.robot.state?(o("#head-navi-icon-robot").removeClass("wait"),o("#head-navi-icon-robot").removeClass("error"),o("#head-navi-icon-robot").addClass("busy"),r.setRunEnabled(!1),o("#runSourceCodeEditor").addClass("disabled")):(o("#head-navi-icon-robot").removeClass("busy"),o("#head-navi-icon-robot").removeClass("wait"),o("#head-navi-icon-robot").addClass("error"),r.setRunEnabled(!1),o("#runSourceCodeEditor").addClass("disabled")))},e.prototype.updateMenuStatus=function(t){switch(t){case 0:v.setIsAgent(!1);break;case 1:v.setIsAgent(!0),o("#head-navi-icon-robot").removeClass("error"),o("#head-navi-icon-robot").removeClass("busy"),o("#head-navi-icon-robot").addClass("wait"),r.setRunEnabled(!0),o("#runSourceCodeEditor").removeClass("disabled"),o("#menuConnect").parent().addClass("disabled");break;default:v.setIsAgent(!0),o("#menuConnect").parent().removeClass("disabled"),""==r.getRobotPort()?(o("#head-navi-icon-robot").removeClass("error"),o("#head-navi-icon-robot").removeClass("busy"),o("#head-navi-icon-robot").removeClass("wait"),r.setRunEnabled(!1)):(o("#head-navi-icon-robot").removeClass("error"),o("#head-navi-icon-robot").removeClass("busy"),o("#head-navi-icon-robot").addClass("wait"),r.setRunEnabled(!0),o("#runSourceCodeEditor").removeClass("disabled"))}},e.prototype.makeRequest=function(){var t=this;this.portList=[],this.vendorList=[],this.productList=[],this.robotList=[],f.listRobotsFromAgent((function(t){}),(function(e){t.agentPortList=e.responseText}),(function(){}));try{JSON.parse(this.agentPortList).forEach((function(e){I(e.IdVendor)&&(t.portList.push(e.Name),t.vendorList.push(e.IdVendor),t.productList.push(e.IdProduct),t.robotList.push(r.getRobotRealName()))}))}catch(t){r.setRobotPort("")}this.portList.indexOf(r.getRobotPort())<0&&r.setRobotPort(""),1==this.portList.length&&l.setPort(this.portList[0]),r.updateMenuStatus(this.getPortList().length)},e.prototype.listRobotStart=function(){var t=this;o("#menuConnect").parent().addClass("disabled"),this.makeRequest(),this.timerId=window.setInterval((function(){t.makeRequest()}),3e3)},e.prototype.listRobotStop=function(){o("#menuConnect").parent().addClass("disabled"),window.clearInterval(this.timerId)},e.prototype.closeConnection=function(){var t=v.getSocket();null!=t&&(t.disconnect(),v.setSocket(null))},e.prototype.getPortList=function(){return this.portList},e.prototype.getRobotList=function(){return this.robotList},e.prototype.uploadProgram=function(t,e){f.sendProgramHexToAgent(t,e,r.getProgramName(),r.getSignature(),r.getCommandLine(),(function(){b.text("Create agent upload success"),o("#menuRunProg").parent().removeClass("disabled"),o("#runOnBrick").parent().removeClass("disabled")}))},e}(A),N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.reset=!1,o("#head-navi-icon-robot").removeClass("error"),o("#head-navi-icon-robot").removeClass("busy"),o("#head-navi-icon-robot").removeClass("wait"),r.setRunEnabled(!1),o("#menuConnect").parent().removeClass("disabled"),r.inWebview()?o("#robotConnect").removeClass("disabled"):o("#robotConnect").addClass("disabled"),o("#runSourceCodeEditor").addClass("disabled"),r.setPingTime(r.LONG)},e.prototype.isRobotConnected=function(){return m.isRobotConnected()},e.prototype.run=function(t){if(s.displayInformation(t,t.message,t.message,r.getProgramName()),"ok"===t.rc){var e=t.compiledCode,n=JSON.parse(e);if(this.interpreter=m.getInterpreter(n),null!==this.interpreter){r.setConnectionState("busy"),r.getBlocklyWorkspace().robControls.switchToStop();try{this.runStepInterpreter()}catch(t){this.interpreter.terminate(),this.interpreter=null,alert(t)}}}},e.prototype.runStepInterpreter=function(){if(!this.interpreter.isTerminated()&&!this.reset){var t=(new Date).getTime()+100,e=Math.max(100,this.interpreter.run(t));this.timeout(this.runStepInterpreter,e)}},e.prototype.timeout=function(t,e){e>100?(e-=100,setTimeout(this.timeout,100,(function(){t()}),e)):setTimeout((function(){t()}),e)},e.prototype.setState=function(){},e.prototype.stopProgram=function(){null!==this.interpreter&&this.interpreter.terminate()},e.prototype.showConnectionModal=function(){l.showScanModal()},e}(n.AbstractConnection),O=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.shortFormForDownloadPopup="MINI"},e}(E),D=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(T);e.Bob3Connection=D;var M=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(T);e.BotnrollConnection=M;var U=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(A);e.FestobionicflowerConnection=U;var L=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(A);e.FestobionicConnection=L;var x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(A);e.MbotConnection=x;var k=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(A);e.MegaConnection=k;var B=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(A);e.NanoConnection=B;var W=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(A);e.Nano33bleConnection=W;var F=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(T);e.Rob3rtaConnection=F;var G=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),o("#robotWlan").removeClass("hidden")},e.prototype.terminate=function(){t.prototype.terminate.call(this),o("#robotWlan").addClass("hidden")},e}(E);e.SenseboxConnection=G;var V=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(A);e.UnoConnection=V;var H=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(A);e.Unowifirev2Connection=H;var K=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(A);e.Mbot2Connection=K;var z=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.switchedOnce=!1,n.shortLong="long",n.urlAPI=e.API_URL+e.API_LONG,n}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),(a.isChromeOS()||a.isWindowsOS())&&(this.urlAPI=e.API_URL+e.API_SHORT,this.shortLong="short")},e.prototype.run=function(t){if("ok"!==t.rc)r.setConnectionState("wait"),s.displayInformation(t,t.message,t.message,r.getProgramName(),r.getRobot());else{o("#changedDownloadFolder").addClass("hidden"),o("#OKButtonModalFooter").addClass("hidden");var n,a=o("#popupDownloadHeader").text();o("#popupDownloadHeader").text(a.replace("$",r.getRobotRealName().trim()));for(var c=1;d.Msg["POPUP_DOWNLOAD_STEP_"+c];c++){var l=o('<li class="typcn typcn-roberta">'),u=d.Msg["POPUP_DOWNLOAD_STEP_"+c+"_"+r.getRobotGroup().toUpperCase()]||d.Msg["POPUP_DOWNLOAD_STEP_"+c]||"POPUP_DOWNLOAD_STEP_"+c;l.html('<span class="download-message">'+u+"</span>"),o("#download-instructions").append(l)}o("#save-client-compiled-program").oneWrap("hidden.bs.modal",(function(t){r.setConnectionState("wait"),n&&!window.msCrypto&&(n.pause(),n.load()),p.clearDownloadModal()})),o("body>.pace").fadeIn();var p=this,h=function(t){r.setConnectionState("wait"),p.clearDownloadModal(),o("body>.pace").fadeOut(400,(function(){s.displayPopupMessage("ORA_PROGRAM_SAVE_AS_ERROR_PROGRAM_EXISTS",t,"OK")}))},m=function(r){try{if("true"==r.compile){var a=r.wav;n=new Audio(a),p.createPlayButton(n),o("body>.pace").fadeOut(400,(function(){o("#save-client-compiled-program").modal("show")}))}else{r.message.toLowerCase().indexOf("permission denied")>=0&&!p.switchedOnce?(p.switchedOnce=!0,"long"===p.shortLong?p.urlAPI=e.API_URL+e.API_SHORT:p.urlAPI=e.API_URL+e.API_LONG,i.externAPIRequest(p.urlAPI,t.compiledCode,m,f)):h("Compiler Error:<br>"+r.message)}}catch(t){h("API "+p.urlAPI+" usage error")}},f=function(t){h("Compiler "+p.urlAPI+" not available, please try it again later!")};i.externAPIRequest(this.urlAPI,t.compiledCode,m,f)}},e.prototype.createPlayButton=function(t){var e;if("Blob"in window){(e=document.createElement("button")).setAttribute("type","button"),e.setAttribute("class","btn btn-primary");var n=!1;e.onclick=function(){0==n?(t.play(),r.setAttribute("class","typcn typcn-media-stop"),n=!0,t.addEventListener("ended",(function(){o("#save-client-compiled-program").modal("hide")}))):(r.setAttribute("class","typcn typcn-media-play"),t.pause(),t.load(),n=!1)};var r=document.createElement("span");r.setAttribute("class","typcn typcn-media-play"),r.setAttribute("style","color : #333333"),e.appendChild(r)}if(e){var i=document.createElement("div");i.setAttribute("id","programLink"),i.setAttribute("style","text-align: center;"),i.appendChild(document.createElement("br")),i.appendChild(e),e.setAttribute("style","font-size:36px"),o(i).appendTo("#downloadLink")}},e.prototype.setState=function(){},e.prototype.terminate=function(){t.prototype.terminate.call(this),this.clearDownloadModal()},e.API_URL="https://api.edisonrobotics.net/",e.API_LONG="ep/wav/long",e.API_SHORT="ep/wav/short",e}(n.AbstractPromptConnection);e.EdisonConnection=z;var Y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(E);e.Ev3c4ev3Connection=Y;var j=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(A);e.Ev3devConnection=j;var q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(A);e.Ev3lejosv0Connection=q;var J=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(A);e.Ev3lejosv1Connection=J;var Z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(A);e.XNNConnection=Z;var $=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(O);e.Calliope2016Connection=$;var X=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(O);e.Calliope2017Connection=X;var Q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(O);e.Calliope2017NoBlueConnection=Q;var tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(E);e.JoycarConnection=tt;var et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(E);e.MicrobitConnection=et;var nt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(E);e.Microbitv2Connection=nt;var ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(E);e.Calliopev3Connection=ot;var rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(A);e.NaoConnection=rt;var it=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(A);e.NxtConnection=it;var at=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),o("#robotWlan").removeClass("hidden"),c.gui.blocklyWorkspace&&c.gui.blocklyWorkspace.robControls.showStopProgram()},e.prototype.terminate=function(){t.prototype.terminate.call(this),o("#robotWlan").addClass("hidden"),c.gui.blocklyWorkspace&&c.gui.blocklyWorkspace.robControls.hideStopProgram()},e}(A);e.RobotinoConnection=at;var st=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),o("#robotWlan").removeClass("hidden")},e.prototype.terminate=function(){t.prototype.terminate.call(this),o("#robotWlan").addClass("hidden")},e}(A);e.RobotinoROSConnection=st;var ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(S);e.SpikePybricksConnection=ct;var lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(A);e.SpikeConnection=lt;var ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.showConnectionModal=function(){o("#buttonCancelFirmwareUpdate").css("display","inline"),o("#buttonCancelFirmwareUpdateAndRun").css("display","none"),l.showSetTokenModal(6,8)},e.prototype.init=function(){t.prototype.init.call(this),r.getBlocklyWorkspace().robControls.showStopProgram(),o("#stopProgram").addClass("disabled")},e.prototype.terminate=function(){t.prototype.terminate.call(this),o("#stopProgram").addClass("disabled"),r.getBlocklyWorkspace().robControls.hideStopProgram(),r.setRobotToken("")},e}(A);e.Txt4Connection=ut;var dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(R);e.ThymioConnection=dt;var pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(N);e.WedoConnection=pt;var ht=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){r.setConnectionState("wait"),o("#runSourceCodeEditor").removeClass("disabled"),o("#menuConnect").parent().addClass("disabled"),r.setPing(!1)},e.prototype.isRobotConnected=function(){return!0},e.prototype.run=function(t){var e=(t.programName||r.getProgramName())+"."+r.getBinaryFileExtension();"bin"!==r.getBinaryFileExtension()&&"uf2"!==r.getBinaryFileExtension()||(t.compiledCode=a.base64decode(t.compiledCode)),a.download(e,t.compiledCode),setTimeout((function(){r.setConnectionState("wait")}),5e3),s.displayInformation(t,t.message,t.message,r.getProgramName(),r.getRobot())},e.prototype.setState=function(){},e}(n.AbstractConnection);e.LocalConnection=ht}));
//# sourceMappingURL=connections.js.map
//# sourceMappingURL=connections.js.map
