define(["require","exports","message","log","util.roberta","guiState.controller","program.controller","nn.controller","configuration.controller","program.model","blockly","jquery","jquery-validate"],(function(o,e,r,t,a,i,n,l,c,m,p,g){function f(o,e){g("#fileSelector").val(null),g("#fileSelector").off(),g("#fileSelector").onWrap("change",(function(r){var t=r.target.files[0],i=new FileReader;return i.onload=function(r){var i=a.getBasename(t.name);o&&"function"==typeof o&&o(i,r.target.result,e)},i.readAsText(t),!1}),"import clicked")}function s(o,e,t){var n=e.indexOf('robottype="');n+=11;var l,c=e.indexOf('"',n),m=e.substring(n,c);m.indexOf("calliope")>=0&&(l="calliope2017NoBlue");for(var g=0,f=Object.entries(i.getRobots());g<f.length;g++){var s=f[g],d=(s[0],s[1]);d.name===m&&(l=d.group)}l?t&&"function"==typeof t&&t(l,{},u,[o,e]):r.displayInformation({rx:"error"},"",p.Msg.PROGRAM_IMPORT_ERROR_MISSING_ROBOT_TYPE,a.getRobotGroupsPrettyPrint(m))}function u(o,e){-1===e.search("<export")&&(e='<export xmlns="http://de.fhg.iais.roberta.blockly"><program>'+e+"</program><config>"+i.getConfigurationXML()+"</config></export>"),m.loadProgramFromXML(o,e,(function(e){if("ok"==e.rc){l.programWasReplaced();var a=p.Xml.workspaceToDom(i.getBlocklyWorkspace()),m=p.Xml.domToText(a);i.setProgramXML(m),a=p.Xml.workspaceToDom(i.getBricklyWorkspace());var g=p.Xml.domToText(a);i.setConfigurationXML(g),e.programSaved=!1,e.name="NEPOprog",e.programShared=!1,e.programTimestamp="";var f=i.getConfigurationName();try{c.configurationToBricklyWorkspace(e.confXML),i.setConfigurationXML(e.confXML),n.programToBlocklyWorkspace(e.progXML),i.setProgram(e),i.setProgramXML(e.progXML),i.setConfigurationName(""),t.info("show program "+i.getProgramName())}catch(a){t.error(a.message),i.setProgramXML(m),i.setConfigurationXML(g),i.setConfigurationName(f),c.reloadConf(),n.reloadProgram(),e.rc="error",r.displayInformation(e,"",p.Msg.ORA_PROGRAM_IMPORT_ERROR,o)}}else"ORA_PROGRAM_IMPORT_ERROR_WRONG_ROBOT_TYPE"===e.message?r.displayInformation(e,"",e.message,e.robotTypes):r.displayInformation(e,"",e.message,o)}))}function d(o,e){m.compileN(o,e,i.getLanguage(),(function(o){var e=o.rc;void 0!==o.parameters&&(e+="\nMessage is:\n"+o.parameters.MESSAGE),alert(e)}))}function S(o,e){m.compileP(o,e,i.getLanguage(),(function(o){alert(o.rc)}))}Object.defineProperty(e,"__esModule",{value:!0}),e.importNepoCodeToCompile=e.importSourceCodeToCompile=e.loadProgramFromXML=e.importSourceCode=e.importXml=e.init=e.importXmlFromStart=void 0,e.init=f,e.importXml=function(){f(u),g("#fileSelector").attr("accept",".xml"),g("#fileSelector").clickWrap()},e.importXmlFromStart=function(o){f(s,o),g("#fileSelector").attr("accept",".xml"),g("#fileSelector").clickWrap()},e.importSourceCode=function(o){f(o),g("#fileSelector").attr("accept","."+i.getSourceCodeFileExtension()),g("#fileSelector").clickWrap()},e.loadProgramFromXML=u,e.importSourceCodeToCompile=function(){f(d),g("#fileSelector").attr("accept","."+i.getSourceCodeFileExtension()),g("#fileSelector").clickWrap()},e.importNepoCodeToCompile=function(){f(S),g("#fileSelector").attr("accept",".xml"),g("#fileSelector").clickWrap()}}));
//# sourceMappingURL=import.controller.js.map
//# sourceMappingURL=import.controller.js.map
