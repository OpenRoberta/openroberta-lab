var __extends=this&&this.__extends||function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();define(["require","exports","./interpreter.aRobotBehaviour","./interpreter.constants","./interpreter.util"],(function(t,e,o,r,n){Object.defineProperty(e,"__esModule",{value:!0}),e.RobotWeDoBehaviour=void 0;var i=function(t){function e(e,o){var r=t.call(this)||this;return r.wedo={},r.tiltMode={UP:"3.0",DOWN:"9.0",BACK:"5.0",FRONT:"7.0",NO:"0.0"},r.btInterfaceFct=e,r.toDisplayFct=o,r.timers={},r.timers.start=Date.now(),n.loggingEnabled(!0,!0),r}return __extends(e,t),e.prototype.odometryReset=function(t){throw new Error("Method not implemented.")},e.prototype.temperatureLedAction=function(t,e){throw new Error("Method not implemented.")},e.prototype.soundLedAction=function(t){throw new Error("Method not implemented.")},e.prototype.update=function(t){if(n.info("update type:"+t.type+" state:"+t.state+" sensor:"+t.sensor+" actor:"+t.actuator),"wedo"===t.target){switch(t.type){case"connect":"connected"==t.state?(this.wedo[t.brickid]={},this.wedo[t.brickid].brickname=t.brickname.replace(/\s/g,"").toUpperCase(),this.wedo[t.brickid].button="false"):"disconnected"==t.state&&delete this.wedo[t.brickid];break;case"didAddService":var e=this.wedo[t.brickid];"connected"==t.state&&(t.id&&t.sensor?(e[t.id]={},e[t.id][this.finalName(t.sensor)]=""):t.id&&t.actuator?(e[t.id]={},e[t.id][this.finalName(t.actuator)]=""):t.sensor?e[this.finalName(t.sensor)]="":e[this.finalName(t.actuator)]="");break;case"didRemoveService":t.id?delete this.wedo[t.brickid][t.id]:t.sensor?delete this.wedo[t.brickid][this.finalName(t.sensor)]:delete this.wedo[t.brickid][this.finalName(t.actuator)];break;case"update":var o=this.wedo[t.brickid];t.id?(void 0===o[t.id]&&(o[t.id]={}),o[t.id][this.finalName(t.sensor)]=t.state):o[this.finalName(t.sensor)]=t.state}n.info(this.wedo)}},e.prototype.getConnectedBricks=function(){var t=[];for(var e in this.wedo)this.wedo.hasOwnProperty(e)&&t.push(e);return t},e.prototype.getBrickIdByName=function(t){for(var e in this.wedo)if(this.wedo.hasOwnProperty(e)&&this.wedo[e].brickname===t.toUpperCase())return e;return null},e.prototype.getBrickById=function(t){return this.wedo[t]},e.prototype.clearDisplay=function(){n.debug("clear display"),this.toDisplayFct({clear:!0})},e.prototype.getSample=function(t,e,o,i,c){var p,d="robot: "+e+", port: "+i;switch(n.info(d+" getsample called for "+o),o){case"infrared":p="motionsensor";break;case"gyro":p="tiltsensor";break;case"buttons":p="button";break;case r.TIMER:return void t.push(this.timerGet(i));default:throw"invalid get sample for "+e+" - "+i+" - "+o+" - "+c}var s=this.getBrickIdByName(e);t.push(this.getSensorValue(s,i,p,c))},e.prototype.getSensorValue=function(t,e,o,r){var i=this.wedo[t],c=i[e];void 0===c&&(c=void 0!==i[1]?i[1]:i[2]);var p=void 0===c?"undefined":c[o];switch(n.info("sensor object "+(void 0===p?"undefined":p.toString())),o){case"tiltsensor":return"ANY"===r?parseInt(p)!==parseInt(this.tiltMode.NO):parseInt(p)===parseInt(this.tiltMode[r]);case"motionsensor":return parseInt(p);case"button":return"true"===i.button}},e.prototype.finalName=function(t){return void 0!==t?t.replace(/\s/g,"").toLowerCase():(n.info("sensor name undefined"),"undefined")},e.prototype.timerReset=function(t){this.timers[t]=Date.now(),n.debug("timerReset for "+t)},e.prototype.timerGet=function(t){var e=Date.now(),o=this.timers[t];void 0===o&&(o=this.timers.start);var r=e-o;return n.debug("timerGet for "+t+" returned "+r),r},e.prototype.ledOnAction=function(t,e,o){var r=this.getBrickIdByName(t),i="robot: "+t+", port: "+e;n.debug(i+" led on color "+o);var c={target:"wedo",type:"command",actuator:"light",brickid:r,color:o};this.btInterfaceFct(c)},e.prototype.ledOffAction=function(t,e){var o=this.getBrickIdByName(t),r="robot: "+t+", port: "+e;n.debug(r+" led off");var i={target:"wedo",type:"command",actuator:"light",brickid:o,color:0};this.btInterfaceFct(i)},e.prototype.toneAction=function(t,e,o){var r=this.getBrickIdByName(t),i="robot: "+t;n.debug(i+" piezo: , frequency: "+e+", duration: "+o);var c={target:"wedo",type:"command",actuator:"piezo",brickid:r,frequency:Math.floor(e),duration:Math.floor(o)};return this.btInterfaceFct(c),o},e.prototype.motorOnAction=function(t,e,o,r,i,c){var p=this.getBrickIdByName(t),d="robot: "+t+", port: "+e,s=void 0===r?" w.o. duration":" for "+r+" msec";n.debug(d+" motor speed "+i+s);var a={target:"wedo",type:"command",actuator:"motor",brickid:p,action:"on",id:e,direction:i<0?1:0,power:Math.abs(i)};return this.btInterfaceFct(a),0},e.prototype.motorStopAction=function(t,e){var o=this.getBrickIdByName(t),r="robot: "+t+", port: "+e;n.debug(r+" motor stop");var i={target:"wedo",type:"command",actuator:"motor",brickid:o,action:"stop",id:e};this.btInterfaceFct(i)},e.prototype.showTextAction=function(t,e){var o=""+t;return n.debug('***** show "'+o+'" *****'),this.toDisplayFct({show:o}),0},e.prototype.showImageAction=function(t,e){return n.debug("***** show image not supported by WeDo *****"),0},e.prototype.displaySetBrightnessAction=function(t){return 0},e.prototype.displaySetPixelAction=function(t,e,o){return 0},e.prototype.writePinAction=function(t,e,o){},e.prototype.close=function(){var t=this.getConnectedBricks();for(var e in t)if(t.hasOwnProperty(e)){var o=this.getBrickById(t[e]).brickname;this.motorStopAction(o,1),this.motorStopAction(o,2),this.ledOnAction(o,99,3)}},e.prototype.encoderReset=function(t){throw new Error("Method not implemented.")},e.prototype.gyroReset=function(t){throw new Error("Method not implemented.")},e.prototype.lightAction=function(t,e,o){throw new Error("Method not implemented.")},e.prototype.playFileAction=function(t){throw new Error("Method not implemented.")},e.prototype._setVolumeAction=function(t){throw new Error("Method not implemented.")},e.prototype._getVolumeAction=function(t){throw new Error("Method not implemented.")},e.prototype.setLanguage=function(t){throw new Error("Method not implemented.")},e.prototype.sayTextAction=function(t,e,o){throw new Error("Method not implemented.")},e.prototype.getMotorSpeed=function(t,e,o){throw new Error("Method not implemented.")},e.prototype.setMotorSpeed=function(t,e,o){throw new Error("Method not implemented.")},e.prototype.driveStop=function(t){throw new Error("Method not implemented.")},e.prototype.driveAction=function(t,e,o,r){throw new Error("Method not implemented.")},e.prototype.curveAction=function(t,e,o,r,n){throw new Error("Method not implemented.")},e.prototype.turnAction=function(t,e,o,r){throw new Error("Method not implemented.")},e.prototype.showTextActionPosition=function(t,e,o){throw new Error("Method not implemented.")},e.prototype.displaySetPixelBrightnessAction=function(t,e,o){throw new Error("Method not implemented.")},e.prototype.displayGetPixelBrightnessAction=function(t,e,o){throw new Error("Method not implemented.")},e.prototype.setVolumeAction=function(t){throw new Error("Method not implemented.")},e.prototype.getVolumeAction=function(t){throw new Error("Method not implemented.")},e.prototype.remember=function(t){throw new Error("Method not implemented.")},e.prototype.recall=function(t){throw new Error("Method not implemented.")},e.prototype.debugAction=function(t){this.showTextAction("> "+t,void 0)},e.prototype.assertAction=function(t,e,o,r,n){n||this.showTextAction("> Assertion failed: "+t+" "+e+" "+o+" "+r,void 0)},e.prototype.circleLedAction=function(t){throw new Error("Method not implemented.")},e.prototype.buttonLedAction=function(t){throw new Error("Method not implemented.")},e.prototype.proxHLedAction=function(t){},e.prototype.omniDriveAction=function(t,e,o){throw new Error("Method not implemented.")},e.prototype.omniDriveDistAction=function(t,e,o){throw new Error("Method not implemented.")},e.prototype.omniStopDriveAction=function(){throw new Error("Method not implemented.")},e.prototype.omniDriveTurnAction=function(t,e,o){return 0},e.prototype.omniDrivePositionAction=function(t,e,o){return 0},e}(o.ARobotBehaviour);e.RobotWeDoBehaviour=i}));
//# sourceMappingURL=interpreter.robotWeDoBehaviour.js.map
//# sourceMappingURL=interpreter.robotWeDoBehaviour.js.map
