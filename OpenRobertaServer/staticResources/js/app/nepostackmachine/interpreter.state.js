var __spreadArray=this&&this.__spreadArray||function(t,e,i){if(i||2===arguments.length)for(var n,o=0,r=e.length;o<r;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))};define(["require","exports","./interpreter.constants","./interpreter.util","blockly"],(function(t,e,i,n,o){Object.defineProperty(e,"__esModule",{value:!0}),e.State=void 0;var r=function(){function t(t){this.operations=t;for(var e={},n=0;n<t.length;n++){var o=(r=t[n])[i.LABEL];void 0!==r[i.LABEL]&&(e[o]=n)}for(n=0;n<t.length;n++){var r;if((r=t[n])[i.OPCODE]===i.JUMP||r[i.OPCODE]===i.CALL||r[i.OPCODE]===i.RETURN_ADDRESS){if(void 0===e[r[i.TARGET]])throw"invalid label "+r[i.TARGET]+" encountered";r[i.TARGET]=e[r[i.TARGET]]}}this.pc=0,this.bindings={},this.stack=[],this.currentBlocks=[],this.debugMode=!1}return t.prototype.incrementProgramCounter=function(){this.pc++},t.prototype.getDebugMode=function(){return this.debugMode},t.prototype.setDebugMode=function(t){this.debugMode=t},t.prototype.bindVar=function(t,e){this.checkValidName(t),this.checkValidValue(e);var i=this.bindings[t];null==i||i<1?(this.bindings[t]=[e],n.debug("bind new "+t+" with "+e+" of type "+typeof e)):(i.unshift(e),n.debug("bind&hide "+t+" with "+e+" of type "+typeof e))},t.prototype.unbindVar=function(t){this.checkValidName(t);var e=this.bindings[t];e.length<1&&n.dbcException("unbind failed for: "+t),e.shift(),n.debug("unbind "+t+" remaining bindings are "+e.length)},t.prototype.getVar=function(t){this.checkValidName(t);var e=this.bindings[t];return(null==e||e.length<1)&&n.dbcException("getVar failed for: "+t),e[0]},t.prototype.getVariables=function(){return this.bindings},t.prototype.setVar=function(t,e){this.checkValidName(t),this.checkValidValue(e),null==e&&n.dbcException("setVar value invalid");var i=this.bindings[t];(null==i||i.length<1)&&n.dbcException("setVar failed for: "+t),i[0]=e},t.prototype.push=function(t){this.checkValidValue(t),this.stack.push(t),n.debug("push "+t+" of type "+typeof t)},t.prototype.pop=function(){return this.stack.length<1&&n.dbcException("pop failed with empty stack"),this.stack.pop()},t.prototype.get0=function(){return this.get(0)},t.prototype.get1=function(){return this.get(1)},t.prototype.get2=function(){return this.get(2)},t.prototype.get=function(t){return 0===this.stack.length&&n.dbcException("get failed with empty stack"),this.stack[this.stack.length-1-t]},t.prototype.checkValidName=function(t){null==t&&n.dbcException("invalid name")},t.prototype.checkValidValue=function(t){void 0===t?n.dbcException("variable value invalid"):null===t&&n.warn('variable value "null" received...')},t.prototype.getOp=function(){return this.operations[this.pc]},t.prototype.opLog=function(t){n.opLog(t,this.operations,this.pc)},t.prototype.evalHighlightings=function(t,e){var n;if(this.debugMode){var o=(null==t?void 0:t[i.HIGHTLIGHT_PLUS])||[],r=null===(n=null==e?void 0:e[i.HIGHTLIGHT_MINUS])||void 0===n?void 0:n.filter((function(t){return o.indexOf(t)<0}));this.evalTerminations(r),this.evalInitiations(o)}},t.prototype.evalInitiations=function(t){var e=this;t.map((function(t){return o.getMainWorkspace().getBlockById(t)})).forEach((function(t){$(null==t?void 0:t.svgPath_).hasClass("breakpoint")&&$(null==t?void 0:t.svgPath_).removeClass("breakpoint").addClass("selectedBreakpoint"),e.highlightBlock(t),e.addToCurrentBlock(t.id)}))},t.prototype.evalTerminations=function(t){var e=this;null==t||t.map((function(t){return o.getMainWorkspace().getBlockById(t)})).forEach((function(t){$(null==t?void 0:t.svgPath_).hasClass("selectedBreakpoint")&&$(null==t?void 0:t.svgPath_).removeClass("selectedBreakpoint").addClass("breakpoint"),e.removeBlockHighlight(t),e.removeFromCurrentBlock(t.id)}))},t.prototype.beingExecuted=function(t){var e=t[i.HIGHTLIGHT_PLUS].slice(-1).pop();return e&&this.isInCurrentBlock(e)},t.prototype.highlightBlock=function(t){$(t.svgPath_).stop(!0,!0).animate({"fill-opacity":"1"},0)},t.prototype.removeBlockHighlight=function(t){$(t.svgPath_).stop(!0,!0).animate({"fill-opacity":"0.3"},50)},t.prototype.addHighlights=function(t){var e=this;__spreadArray([],this.currentBlocks,!0).map((function(t){return o.getMainWorkspace().getBlockById(t)})).forEach((function(t){return e.highlightBlock(t)})),t.forEach((function(t){var i=o.getMainWorkspace().getBlockById(t);null!==i&&(e.currentBlocks.hasOwnProperty(t)?$(i.svgPath_).addClass("selectedBreakpoint"):$(i.svgPath_).addClass("breakpoint"))}))},t.prototype.removeHighlights=function(t){var e=this;__spreadArray([],this.currentBlocks,!0).map((function(t){return o.getMainWorkspace().getBlockById(t)})).forEach((function(t){var i=$(t);i.hasClass("selectedBreakpoint")&&i.removeClass("selectedBreakpoint").addClass("breakpoint"),e.removeBlockHighlight(t)})),t.map((function(t){return o.getMainWorkspace().getBlockById(t)})).forEach((function(t){null!==t&&$(t.svgPath_).removeClass("breakpoint").removeClass("selectedBreakpoint")}))},t.prototype.addToCurrentBlock=function(t){this.currentBlocks.indexOf(t,0)>-1||this.currentBlocks.push(t)},t.prototype.removeFromCurrentBlock=function(t){var e=this.currentBlocks.indexOf(t,0);e>-1&&this.currentBlocks.splice(e,1)},t.prototype.isInCurrentBlock=function(t){return this.currentBlocks.indexOf(t,0)>-1},t}();e.State=r}));
//# sourceMappingURL=interpreter.state.js.map
//# sourceMappingURL=interpreter.state.js.map
