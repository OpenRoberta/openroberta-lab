define(["require","exports","jquery","wrap","log"],(function(e,r,o,n,t){Object.defineProperty(r,"__esModule",{value:!0}),r.externPost=r.sendProgramHexToAgent=r.listRobotsFromAgent=r.ping=r.xml=r.download=r.json=r.get=r.setErrorFn=r.setInitToken=r.setErrorNum=r.errorNum=r.onNotificationsAvailableCallback=void 0;var a,s="/rest",i=void 0,u=!0;r.onNotificationsAvailableCallback=function(e){a=e},r.errorNum=0,r.setErrorNum=function(e){r.errorNum=e};var c=function(e){alert("The COMM (default) errorfn is called."),t.info("The COMM (default) errorfn is called. Data follows"),t.error(e),l()};function d(e,r,a,d){var l={log:t.reportToComm(),data:r,initToken:i};return o.ajax(s+e,{url:s+e,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(l),success:n.wrapREST((function(e){e&&e.message&&"ORA_INIT_FAIL_INVALID_INIT_TOKEN"===e.message?(u=!1,function(e){var r;switch(e+=navigator.language.indexOf("de")>-1?"_DE":"_EN"){case"INIT_TOKEN_DE":r="Dieser Browsertab ist nicht mehr gültig, weil Deine Browser-Session abgelaufen ist oder der Openroberta-Server neu gestartet wurde.\n\nDu kannst dein Programm zwar noch verändern oder exportieren, aber nicht mehr übersetzen oder auf dein Gerät übertragen. Bitte lade diese Seite neu indem du auf »Aktualisieren« ↻ klickst!";break;case"INIT_TOKEN_EN":r="This browser tab is not valid anymore, because your browser session expired or the openroberta server was restarted.\n\nYou may edit or export your program, but it is impossible to compile or send it to your device. Please click on the »Refresh« ↻ button!";break;case"CONNECTION_DE":r="Deine Verbindung zum Open Roberta Server ist langsam oder unterbrochen. Du kannst dein Programm exportieren, um es zu sichern.";break;case"CONNECTION_EN":r="Your connection to the Open Roberta Server is slow or broken. To avoid data loss you may export your program.";break;case"FRONTEND_DE":r="Dein Browser hat ein ungültiges Kommando geschickt. Eventuell ist auch der Openroberta-Server neu gestartet worden. \n\nDu kannst dein Programm zwar noch verändern oder exportieren, aber nicht mehr übersetzen oder auf dein Gerät übertragen.\n\nBitte lösche vorsichtshalber den Browser-Cache!";break;case"FRONTEND_EN":r="Your browser has sent an invalid command. Maybe that the openroberta server was restarted.\n\nYou may edit or export your program, but it is impossible to compile or send it to your device.\n\nAs a precaution please clear your browser cache!";break;default:r="Connection error! Please clear your browser cache!"}alert(r)}("INIT_TOKEN")):a(e)}),d),error:n.wrapErrorFn(c)})}function l(e){if(u){return d("/ping",{},(function(r){r&&"error"===r.rc&&"ORA_INIT_FAIL_PING_ERROR"===r.cause&&"invalid-token"===r.initToken&&(u=!1),e&&(e(r),a&&r.notificationsAvailable&&a())}),"")}}r.setInitToken=function(e){void 0===i||void 0===e?i=e:window.close()},r.setErrorFn=function(e){c=e},r.get=function(e,r,t,a){return o.ajax(s+e,{url:s+e,type:"GET",dataType:"json",data:r,success:n.wrapREST(t,a),error:n.wrapErrorFn(c)})},r.json=d,r.download=function(e){var r=s+e+"?initToken="+i;window.open(r,"_blank")},r.xml=function(e,r,t,a){return o.ajax(s+e,{url:s+e,type:"POST",contentType:"text/plain; charset=utf-8",dataType:"json",data:r,success:n.wrapREST(t,a),error:n.wrapErrorFn(c)})},r.ping=l,r.listRobotsFromAgent=function(e,r,n){var t="http://127.0.0.1:8991/listrobots";return o.ajax(t,{type:"GET",url:t,error:n,complete:r})},r.sendProgramHexToAgent=function(e,r,t,a,i,u){var d={board:"arduino:avr:uno",port:r,commandline:i,signature:a,hex:e,filename:t+".hex",extra:{auth:{password:null}},wait_for_upload_port:!0,use_1200bps_touch:!0,network:!1,params_verbose:"-v",params_quiet:"-q -q",verbose:!0},l=JSON.stringify(d);return o.ajax(s+"http://127.0.0.1:8991/upload",{type:"POST",data:l,contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"json",statusCode:{200:function(){n.wrapREST(u,"Upload success")},202:function(){n.wrapREST(u,"Upload success")},400:n.wrapErrorFn(c),403:n.wrapErrorFn(c),404:n.wrapErrorFn(c)},error:function(e){}})},r.externPost=function(e,r,t,a){return o.post({url:e,data:r,error:n.wrapREST(a),success:n.wrapREST(t)})}}));
//# sourceMappingURL=comm.js.map
//# sourceMappingURL=comm.js.map
