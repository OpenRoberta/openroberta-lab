define(["require","exports","message","log","jquery","blockly","interpreter.util","guiState.controller","jquery-validate","bootstrap"],(function(e,t,i,n,o,r,a,s){Object.defineProperty(t,"__esModule",{value:!0}),t.toFixedPrecision=t.closeSimRobotWindow=t.openSimRobotWindow=t.removeLinks=t.annotateBlocks=t.clearAnnotations=t.clearTabAlert=t.alertTab=t.isLocalStorageAvailable=t.countBlocks=t.getHashFrom=t.download=t.getBasename=t.sgn=t.roundUltraSound=t.round=t.response=t.showMsgOnTop=t.showSingleListModal=t.showSingleModal=t.setFocusOnElement=t.checkVisibility=t.calcDataTableHeight=t.formatResultLog=t.parseDate=t.formatDate=t.setObjectProperty=t.getPropertyFromObject=t.isEmpty=t.clone=t.base64decode=t.renameNeuron=t.getAllBlocks=t.getTheStartBlock=t.getRobotGroupsPrettyPrint=t.cleanUri=t.RGBAToHexA=t.addVariableValue=t.extendMouseEvent=t.getWebAudio=t.initMicrophone=t.isWebBleSupported=t.isWebUsbSupported=t.isChromium=t.isEdge=t.isIE=t.checkInCircle=t.isMobile=t.arrayToCsv=t.csvToArray=t.activationDisplayName=t.getLinesFromRectangle=void 0;var l=750;function d(){return r.Workspace.getByContainer("blocklyDiv").getAllBlocks()}t.getLinesFromRectangle=function(e){return[{x1:e.x,x2:e.x,y1:e.y,y2:e.y+e.h},{x1:e.x,x2:e.x+e.w,y1:e.y,y2:e.y},{x1:e.x+e.w,x2:e.x,y1:e.y+e.h,y2:e.y+e.h},{x1:e.x+e.w,x2:e.x+e.w,y1:e.y+e.h,y2:e.y}]},t.getTheStartBlock=function(){for(var e=0,t=r.Workspace.getByContainer("blocklyDiv").getTopBlocks();e<t.length;e++){var i=t[e];if(!i.isDeletable())return i}throw"start block not found. That is impossible."},t.getAllBlocks=d,t.renameNeuron=function(e,t){for(var i=d(),n=0;n<i.length;n++){var o=i[n];if(o.dependNeuron){var a=("function"==typeof o.dependNeuron?o.dependNeuron():o.dependNeuron).dropDown;Array.isArray(a)||(a=[a]);for(var s=0;s<a.length;s++){for(var l=-1,c=0;c<a[s].menuGenerator_.length;c++)if(a[s].menuGenerator_[c][1]===e){l=c;break}l>=0?(a[s].menuGenerator_[l][0]=t,a[s].menuGenerator_[l][1]=t,a[s].value_===e&&a[s].setValue(t)):(a[s].menuGenerator_.push([t,t]),a[s].arrow_&&a[s].arrow_.replaceChild(document.createTextNode(a[s].sourceBlock_.RTL?r.FieldDropdown.ARROW_CHAR+" ":" "+r.FieldDropdown.ARROW_CHAR),a[s].arrow_.childNodes[0]),a[s].render_())}o.render()}}},t.activationDisplayName={linear:"Linear",relu:"ReLU",tanh:"Tanh",sigmoid:"Sigmoid",bool:"Bool(0,1)"};t.csvToArray=function(e,t,i){return void 0===t&&(t=";"),void 0===i&&(i=!1),e.slice(i?e.indexOf("\n")+1:0).split("\n").filter((function(e){return 0!==e.length})).map((function(e){return e.split(t)}))};t.arrayToCsv=function(e,t){return void 0===t&&(t=";"),e.map((function(e){return e.join(t)})).join("\n")};var c=1,u=[];function g(e){var t="{",i=!1;for(var n in e)i?t+=",":i=!0,t+='"'+n+'":',e.hasOwnProperty(n)&&(e[n].length>100?t+='"'+JSON.stringify(e[n]).substring(1,100)+' ..."':t+=JSON.stringify(e[n]));return t+="}"}function h(e){setTimeout((function(){1==e.is(":visible")&&e.focus()}),800)}function f(e,t){return parseFloat(e.toFixed(t))}function v(e){document.body.removeChild(e.target)}function m(e){o("#"+e).children().remove(".typcn"),o("#"+e).removeClass("blinking")}t.base64decode=function(e){for(var t=atob(e),i=new Array(t.length),n=0;n<t.length;n++)i[n]=t.charCodeAt(n);return new Uint8Array(i)},t.clone=function e(t){var i;if(null==t||"object"!=typeof t)return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array){i=[];for(var n=0,o=t.length;n<o;n++)i[n]=e(t[n]);return i}if(t instanceof Object){for(var r in i={},t)t.hasOwnProperty(r)&&(i[r]=e(t[r]));return i}throw new Error("Unable to copy obj! Its type isn't supported.")},t.isEmpty=function(e){return 0===Object.keys(e).length&&e.constructor===Object},t.isMobile=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},t.getPropertyFromObject=function e(t,i,n){if(void 0===t)return!1;var o=i.indexOf(".");return o>-1?e(t[i.substring(0,o)],i.substr(o+1),n):null!=n?t[i][n]:t[i]},t.setObjectProperty=function e(t,i,n,o){if(void 0===t)return!1;var r=i.indexOf(".");return r>-1?e(t[i.substring(0,r)],i.substr(r+1),n,o):null!=o?t[i][o]=n:void(t[i]=n)},t.formatDate=function(e){if(e){var t=new Date(e);return("0"+t.getDate()).slice(-2)+"."+("0"+(t.getMonth()+1)).slice(-2)+"."+t.getFullYear()+", "+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)}return""},t.parseDate=function(e){if(e){var t=e.split(", ")[0],i=e.split(", ")[1],n=t.split(".")[0],o=t.split(".")[1]-1,r=t.split(".")[2],a=i.split(":")[0],s=i.split(":")[1],l=i.split(":")[2],d=i.split(".")[1];return new Date(r,o,n,a,s,l,d).getTime()}return 0},t.formatResultLog=g,t.calcDataTableHeight=function(){return Math.round(o(window).height()-100)},t.checkVisibility=function(){var e,t,i={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(e in i)if(e in document){t=i[e];break}return function(i){return i&&document.addEventListener(t,i),!document[e]}},t.setFocusOnElement=h,t.showSingleModal=function(e,t,i,n){e(),o("#single-modal-form").onWrap("submit",(function(e){e.preventDefault(),t()}),"sim start clicked"),o("#single-modal").onWrap("hidden.bs.modal",(function(){o("#single-modal-form").off("submit"),o("#singleModalInput").val(""),o("#single-modal-form").validate().resetForm(),i()}),"sim start clicked"),o("#single-modal-form").removeData("validator"),o("#single-modal-form").validate(n),h(o("#singleModalInput")),o("#single-modal").modal("show")},t.showSingleListModal=function(e,t,i,n){o("#single-modal-list-form").onWrap("submit",(function(e){e.preventDefault(),t()}),"sim start clicked"),o("#single-modal-list").onWrap("hidden.bs.modal",(function(){o("#single-modal-list-form").unbind("submit"),i()}),"sim start clicked"),h(o("#singleModalListInput")),o("#single-modal-list").modal("show")},t.showMsgOnTop=function(e){o("#show-message").find("button").removeAttr("data-bs-dismiss"),o("#show-message").find("button").oneWrap("click",(function(e){o("#show-message").modal("hide"),o("#show-message").find("button").attr("data-bs-dismiss","modal")})),i.displayInformation({rc:"not ok"},"",e)},t.response=function(e){n.info("result from server: "+g(e)),"ok"!=e.rc&&i.displayMessage(e.message,"POPUP","")},t.round=f,t.roundUltraSound=function(e,t){var i=f(e,t);return i>255&&(i=255),i},t.sgn=function(e){return(e>0)-(e<0)},t.getBasename=function(e){var t=String(e).substring(e.lastIndexOf("/")+1);return-1!=t.lastIndexOf(".")&&(t=t.substring(0,t.lastIndexOf("."))),t},t.download=function(e,t){if("Blob"in window&&null==navigator.userAgent.toLowerCase().match(/iPad|iPhone|Android/i)){var i=new Blob([t],{type:"application/octet-stream"});if("msSaveOrOpenBlob"in navigator)navigator.msSaveOrOpenBlob(i,e);else(n=document.createElement("a")).download=e,n.innerHTML="Download File",n.href=window.URL.createObjectURL(i),n.onclick=v,n.style.display="none",document.body.appendChild(n),setTimeout((function(){n.click()}),0)}else{var n;(n=document.createElement("a")).setAttribute("href","data:text/"+e.substring(e.indexOf(".")+1)+";charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.onclick=v,setTimeout((function(){n.click()}),0)}},t.getHashFrom=function(e){for(var t=0,i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i++);return t<0?-1*t+4294967295:t},t.countBlocks=function(e){for(var t=0,i=0;-1!=(i=e.indexOf("<block",i));)t++,i+=6;return t-1},t.isLocalStorageAvailable=function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(e){return!1}},t.alertTab=function(e){m(e),o("#"+e).width(),o("#"+e).prepend('<span class="typcn typcn-warning-outline"></span>'),o("#"+e).addClass("blinking")},t.clearTabAlert=m;var p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};String.prototype.escapeHTML=function(){return String(this).replace(/[&<>"'\/]/g,(function(e){return p[e]}))},o.fn.draggable=function(e){e=o.extend({handle:"",cursor:"move",draggableClass:"draggable",activeHandleClass:"active-handle"},e);var t=null;return(""===e.handle?this:this.find(e.handle)).css("cursor",e.cursor).on("mousedown touchstart",(function(i){var n=i.pageX||i.originalEvent.touches[0].pageX,r=i.pageY||i.originalEvent.touches[0].pageY;""===e.handle?(t=o(this)).addClass(e.draggableClass):(t=o(this).parent()).addClass(e.draggableClass).find(e.handle).addClass(e.activeHandleClass);var a=t.outerHeight(),s=t.outerWidth(),l=t.offset().top+a-r,d=t.offset().left+s-n;o(document).on("mousemove touchmove",(function(i){var n=i.pageX||i.originalEvent.touches[0].pageX,r=i.pageY||i.originalEvent.touches[0].pageY,u=n+d-s,g=r+l-a;if("window"==e.constraint){u>=o(window).width()-19?u=o(window).width()-20:u<=19-t.width()&&(u=18-t.width());g>=o(window).height()-19?g=o(window).height()-20:g<=19-t.height()+92&&(g=18-t.height()+92)}if("x"==e.axis){var h=n+d-s;h=Math.min(h,o("#main-section").width()-24),h=Math.max(h,42);t.offset({top:0,left:h}),o("#blocklyDiv").outerWidth(h),o(".fromRight").css({width:o("#main-section").width()-o("#blocklyDiv").outerWidth()}),c=o("#blocklyDiv").outerWidth()/o("#main-section").width(),o(window).trigger("resize")}else t.offset({top:g,left:u});t.css({right:"auto"})})).on("mouseup touchend",(function(){o(document).off("mousemove touchmove"),null!==t&&(t.removeClass(e.draggableClass),t=null)}))})).on("mouseup touchend",(function(){t&&(""===e.handle?t.removeClass(e.draggableClass):t.removeClass(e.draggableClass).find(e.handle).removeClass(e.activeHandleClass)),t=null})),this};var w=o.fn.addClass;o.fn.addClass=function(){var e=w.apply(this,arguments);return o(this).trigger("classChange"),e};var b,y=o.fn.removeClass;function k(){for(var e=o(".simWindow:visible"),t=0,i=e;t<i.length;t++){var n,r=i[t];n=0!==o(window).width()?Math.abs(r.offsetLeft/o(window).width()%1):0,u[r.id]=n}e.addClass("simWindow-openedButHidden").animate({opacity:"hide",left:""+o(window).width()},l)}function A(){return window.navigator.userAgent.indexOf("Edge")>-1}function C(){return window.navigator.userAgent.indexOf("Chrome")>-1}o.fn.removeClass=function(){var e=y.apply(this,arguments);return o(this).trigger("classChange"),e},o.fn.toggleSimPopup=function(e){o(this).is(":hidden")&&o(this).css({top:e.top+o("#header").height()+12,left:e.left}),o(this).animate({opacity:"toggle",top:"toggle"},300),o(this).draggable({constraint:"window"})},o.fn.closeRightView=function(e){if(!o(".fromRight.rightActive").hasClass("shifting")){o(".fromRight.rightActive").addClass("shifting"),o(".blocklyToolboxDiv").css("display","inherit");var t=this;o(".fromRight.rightActive").animate({width:0},{duration:l,start:function(){o(".modal").modal("hide"),o(".rightMenuButton.rightActive").removeClass("rightActive")},step:function(e){o(window).trigger("resize"),t.width(o("#main-section").width()-Math.ceil(e)),c=o("#blocklyDiv").outerWidth()/o("#main-section").outerWidth()},done:function(){t.width(o("#main-section").outerWidth()),c=1,o(".fromRight").width(0),t.removeClass("rightActive"),o(".fromRight.rightActive").removeClass("rightActive"),o("#sliderDiv").hide(),o(window).trigger("resize"),"function"==typeof e&&e(),o(".fromRight").trigger("closed")},always:function(){o(".fromRight.shifting").removeClass("shifting")}})}},o.fn.openRightView=function(e,t,i){if(!o(".fromRight.rightActive").hasClass("shifting")){var n,r,a=o("#blocklyDiv");if(o(window).width()<768?(r=!0,n=a.outerWidth()-52):(r=!1,n=a.outerWidth()*t),a.hasClass("rightActive"))return o(".fromRight.rightActive").removeClass("rightActive"),o(".rightMenuButton.rightActive").removeClass("rightActive"),e.addClass("rightActive"),o(this).addClass("rightActive"),o(window).trigger("resize"),r&&o(".blocklyToolboxDiv").css("display","none"),"function"==typeof i&&i(),o(this).attr("id").startsWith("sim")||k(),void o(".fromRight").trigger("closed");a.addClass("rightActive"),e.addClass("shifting rightActive"),o(this).addClass("rightActive"),o(".fromRight.rightActive").animate({width:n},{duration:l,step:function(e,t){a.outerWidth(o("#main-section").width()-e),c=o("#blocklyDiv").outerWidth()/o("#main-section").width(),o(window).trigger("resize")},done:function(){o("#sliderDiv").show(),a.outerWidth(o("#main-section").width()-o(".fromRight.rightActive").width()),c=o("#blocklyDiv").outerWidth()/o("#main-section").width(),o(window).trigger("resize"),r&&o(".blocklyToolboxDiv").css("display","none"),o("#sliderDiv").css({left:a.outerWidth()}),"function"==typeof i&&i()},always:function(){e.removeClass("shifting")}})}},o(window).on("resize",(function(){var e=o("#main-section").width(),t=e,i=o("#main-section").height(),n=(1-c)*t,a=c*t;!o(".fromRight.rightActive.shifting").length>0?(o(".fromRight.rightActive").length>0&&(o(".fromRight.rightActive").width(n),o("#sliderDiv").css("left",a)),o("#blocklyDiv").outerWidth(a)):a=o("#blocklyDiv").outerWidth(),o("#blocklyDiv")&&(o("#blocklyDiv").outerWidth(a),o("#blocklyDiv").height(i)),o("#bricklyDiv")&&(o("#bricklyDiv").width(t),o("#bricklyDiv").height(i));for(var s=0,l=o(".simWindow:visible");s<l.length;s++){var d=l[s];d.offsetLeft>=o(window).width()-20&&o("#"+d.id).css({left:""+o(window).width()-20}),d.offsetTop>=o(window).height()-20&&o("#"+d.id).css({top:""+o(window).height()-20})}var u=e-o("#blocklyDiv").outerWidth()-n;0!=u&&o("#blocklyDiv").outerWidth(a+u);var g=r.getMainWorkspace();g&&r.svgResize(g)})),t.clearAnnotations=function(e){if(e&&e instanceof r.Workspace)for(var t=e.getAllBlocks(),i=0;i<t.length;i++)for(var n=t[i].getIcons(),o=0;o<n.length;o++){var a=n[o].block_;a.error?(a.error.dispose(),a.render()):a.warning&&(a.warning.dispose(),a.render())}},t.annotateBlocks=function(e,t){for(var i in t){var n=e.getBlockById(i);if(n){var o=t[i];for(var a in o){var s=r.Msg[o[a]]||o[a]||"unknown error";switch(a){case"ERROR":n.setErrorText(s),n.error.setVisible(!0);break;case"WARNING":n.setWarningText(s),n.warning.setVisible(!0);break;default:console.warn("Unsupported annotation: "+a)}}}}},t.removeLinks=function(e){e.filter((function(){return o(this).attr("href")&&(0===o(this).attr("href").indexOf("http")||0===o(this).attr("href").indexOf("javascript:linkTo"))})).each((function(){o(this).removeAttr("href")}))},t.checkInCircle=function(e,t,i,n,o){return(e-i)*(e-i)+(t-n)*(t-n)<=o*o},t.openSimRobotWindow=function(){for(var e=0,t=o(".simWindow-openedButHidden");e<t.length;e++){var i=t[e],n=o(window).width()*u[i.id];o("#"+i.id).animate({opacity:"show",left:""+n},l)}o(".simWindow").removeClass("simWindow-openedButHidden")},t.closeSimRobotWindow=k,t.isIE=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),i=e.indexOf("Trident/");return t>-1||i>-1},t.isEdge=A,t.isChromium=C,t.isWebUsbSupported=function(){return C()&&null!==navigator.userAgent.toLowerCase().match(/iPad|iPhone/i)},t.isWebBleSupported=function(){return C()||A()},t.initMicrophone=function(e){navigator.mediaDevices.getUserMedia=navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;try{navigator.mediaDevices.getUserMedia({audio:{mandatory:{googEchoCancellation:"false",googAutoGainControl:"false",googNoiseSuppression:"false",googHighpassFilter:"false"},optional:[]}}).then((function(t){var i=e.webAudio.context.createMediaStreamSource(t);e.sound=Volume.createAudioMeter(e.webAudio.context),i.connect(e.sound)}),(function(){console.log("Sorry, but there is no microphone available on your system")}))}catch(e){console.log("Sorry, but there is no microphone available on your system")}},t.getWebAudio=function(){if(!b){b={};var e=window.AudioContext||window.webkitAudioContext||!1;e?b.context=new e:(b.context=null,b.oscillator=null,console.log("Sorry, but the Web Audio API is not supported by your browser. Please, consider upgrading to the latest version or downloading Google Chrome or Mozilla Firefox"))}return b},t.extendMouseEvent=function(e,t,i){var n=e.clientX||e.originalEvent.touches[0].pageX,o=e.clientY||e.originalEvent.touches[0].pageY,r=i.offset().top,a=i.offset().left;e.startX=(n-a)/t,e.startY=(o-r)/t},t.toFixedPrecision=function(e,t){var i=Math.pow(10,t||0);return String(Math.round(e*i)/i)},t.addVariableValue=function e(t,i,n){if(void 0!==n)switch(typeof n){case"number":t.append("<div><label>"+i+" :  </label><span> "+f(n,2)+"</span></div>");break;case"string":case"boolean":t.append("<div><label>"+i+" :  </label><span> "+n+"</span></div>");break;case"object":if(null===n)t.append("<div><label>"+i+" :  </label><span> null </span></div>");else for(var o=0;o<n.length;o++)e(t,i+" ["+String(o)+"]",n[o]);break;default:a.warn("unexpected variable type received")}},t.RGBAToHexA=function(e){var t=(+e[0]).toString(16),i=(+e[1]).toString(16),n=(+e[2]).toString(16),o=(+e[3]).toString(16);return 1==t.length&&(t="0"+t),1==i.length&&(i="0"+i),1==n.length&&(n="0"+n),1==o.length&&(o="0"+o),"#"+t+i+n+o},t.cleanUri=function(){var e=new URL(document.location),t=e.protocol+"//"+e.host;window.history.replaceState({},document.title,t)},t.getRobotGroupsPrettyPrint=function(e){var t=s.getRobots(),i={},n=function(e,t){return"arduino"===t?"Nepo4Arduino":"ev3"===t?"Ev3":s.getMenuRobotRealName(e)};if(e)return n(e,e);for(var o in t){var r=t[o].group,a=t[o].name;r&&!i[r]&&(i[r]=n(a,r))}return i}}));
//# sourceMappingURL=util.js.map
//# sourceMappingURL=util.js.map
